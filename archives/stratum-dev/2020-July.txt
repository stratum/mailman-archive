From yi at opennetworking.org  Wed Jul  1 23:23:17 2020
From: yi at opennetworking.org (yi at opennetworking.org)
Date: Wed, 01 Jul 2020 23:23:17 +0000
Subject: [stratum-dev] Updated invitation: Stratum TST Meeting @ Thu Jul 2,
 2020 12:30pm - 1pm (PDT) (stratum-dev@lists.stratumproject.org)
Message-ID: <000000000000a9ac0405a96993eb@google.com>

This event has been changed.

Title: Stratum TST Meeting
Stratum Technical Steering Team MeetingAgenda and Meeting  
Noteshttps://docs.google.com/document/d/1ret8Vbnl-xbLgNsnDEH-jWP2_WwDYym4zDn6me3tiTA/editThe  
plan is to reserve the 1st and 3rd Thursdays of each month for  
presentations and community updates. If you can only attend some of these  
meetings, those will be more interesting. The other meetings will be more  
informal&nbsp;sync ups to discuss current issues, progress, and status. You  
can see what presentations are planned by checking the agenda  
above.Supporting Slides and Previous  
Recordingshttps://drive.google.com/drive/folders/1ZeYp6RwIGYi9VnIctvnKF1c1NxiAXeOT----------------------------------------------------------------Join  
Zoom Meetinghttps://zoom.us/j/787501745Meeting ID: 787 501 745One tap  
mobile+16699006833,,787501745# US (San Jose)+19292056099,,787501745# US  
(New York)Dial by your location&nbsp; &nbsp; &nbsp; &nbsp; +1 669 900 6833  
US (San Jose)&nbsp; &nbsp; &nbsp; &nbsp; +1 929 205 6099 US (New  
York)&nbsp; &nbsp; &nbsp; &nbsp; 888 788 0099 US Toll-free&nbsp; &nbsp;  
&nbsp; &nbsp; 877 853 5247 US Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +61 3  
7018 2005 Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 8 7150 1149  
Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 2 8015 6011 Australia&nbsp; &nbsp;  
&nbsp; &nbsp; 1800 945 157 Australia Toll-free&nbsp; &nbsp; &nbsp; &nbsp;  
1800 893 423 Australia Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +81 524 564 439  
Japan&nbsp; &nbsp; &nbsp; &nbsp; +81 3 4578 1488 Japan&nbsp; &nbsp; &nbsp;  
&nbsp; 0 800 100 5040 Japan Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 00 663 381  
4092 Japan Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +49 695 050 2596  
Germany&nbsp; &nbsp; &nbsp; &nbsp; +49 69 7104 9922 Germany&nbsp; &nbsp;  
&nbsp; &nbsp; +49 30 5679 5800 Germany&nbsp; &nbsp; &nbsp; &nbsp; 0 800  
1800 150 Germany Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 0 800 000 6954  
Germany Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +886 (2) 7741 7473  
Taiwan&nbsp; &nbsp; &nbsp; &nbsp; 08 0909 9864 Taiwan Toll-free&nbsp;  
&nbsp; &nbsp; &nbsp; +48 22 398 7356 Poland&nbsp; &nbsp; &nbsp; &nbsp; +48  
22 307 3488 Poland&nbsp; &nbsp; &nbsp; &nbsp; 00 800 321 1464 Poland  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 00 800 112 5171 Poland Toll-free&nbsp;  
&nbsp; &nbsp; &nbsp; +44 203 481 5240 United Kingdom&nbsp; &nbsp; &nbsp;  
&nbsp; +44 131 460 1196 United Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203  
051 2874 United Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203 481 5237 United  
Kingdom&nbsp; &nbsp; &nbsp; &nbsp; 0 800 260 5801 United Kingdom  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 0 800 031 5717 United Kingdom  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +353 1 653 3895 Ireland&nbsp; &nbsp;  
&nbsp; &nbsp; +353 6 163 9031 Ireland&nbsp; &nbsp; &nbsp; &nbsp; +353 1 536  
9320 Ireland&nbsp; &nbsp; &nbsp; &nbsp; 1800 949 238 Ireland  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 1800 901 561 Ireland Toll-freeMeeting  
ID: 787 501 745Find your local number:  
https://zoom.us/u/adqQM87Zrg----------------------------------------------------------------If  
you would like to get added to the calendar invite, please ask Brian.
When: Thu Jul 2, 2020 12:30pm – 1pm Pacific Time - Los Angeles
Where: (Online conference room)-Zoom-3 (changed)
Calendar: stratum-dev at lists.stratumproject.org
Who:
     * bocon at opennetworking.org - creator
     * max at opennetworking.org
     * bill at opennetworking.org
     * mohammed.habeeb at inventec.com
     * yi at opennetworking.org
     * carmelo at opennetworking.org
     * xiao.david at inventec.com
     * Rich Renner
     * Devjit Gopalpur
     * Alireza Ghaffarkhah
     * Leonid Khedyk
     * niloofar at opennetworking.org
     * hsuanchung.lee at qct.io
     * Arkadiy Shapiro
     * you at opennetworking.org
     * abhilash at opennetworking.org
     * stratum-dev at lists.stratumproject.org
     * maksym.kovaliov at plvision.eu
     * craig.stevens at dell.com
     * maksym.tropets at plvision.eu
     * jeff_catlin at edge-core.com
     * chris.sommers at keysight.com

Event details:  
https://www.google.com/calendar/event?action=VIEW&eid=MTVxdHRrZTdoOGNrZG9ycHYzaDJoZ3VvZGpfMjAyMDA3MDJUMTkzMDAwWiBzdHJhdHVtLWRldkBsaXN0cy5zdHJhdHVtcHJvamVjdC5vcmc&tok=NzEjb3Blbm5ldHdvcmtpbmcub3JnX3Z2M2xmdDg5ZTc5NGI0amxtcjNqOXAxcGVzQGdyb3VwLmNhbGVuZGFyLmdvb2dsZS5jb21iMWExZGM1ODA1Y2U0MDYyMzJjNjZlODFkNGVjNTNiMDNkMzg1NDc1&ctz=America%2FLos_Angeles&hl=en&es=0

Invitation from Google Calendar: https://www.google.com/calendar/

You are receiving this courtesy email at the account  
stratum-dev at lists.stratumproject.org because you are an attendee of this  
event.

To stop receiving future updates for this event, decline this event.  
Alternatively you can sign up for a Google account at  
https://www.google.com/calendar/ and control your notification settings for  
your entire calendar.

Forwarding this invitation could allow any recipient to send a response to  
the organizer and be added to the guest list, or invite others regardless  
of their own invitation status, or to modify your RSVP. Learn more at  
https://support.google.com/calendar/answer/37135#forwarding
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200701/7b0371c8/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/calendar
Size: 9447 bytes
Desc: not available
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200701/7b0371c8/attachment-0001.ics>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: invite.ics
Type: application/ics
Size: 9609 bytes
Desc: not available
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200701/7b0371c8/attachment-0001.bin>

From yi at opennetworking.org  Wed Jul  1 23:36:45 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Wed, 1 Jul 2020 16:36:45 -0700
Subject: [stratum-dev] Stratum TST meeting canceled this week (Jul 2)
Message-ID: <CAOyFVR1rdSgh8C5=15iU9fNQo6_bXm2WvvichJqXBw4zFv7_8g@mail.gmail.com>

Hi everyone.

Sorry for the late notice.

This week's meeting (Jul 2) is canceled due to the holiday weekend.

-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200701/81c1eee6/attachment.html>

From d.lake at surrey.ac.uk  Sun Jul 12 13:08:51 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Sun, 12 Jul 2020 13:08:51 +0000
Subject: [stratum-dev] Confused about how to run Stratum
Message-ID: <VI1PR06MB5214C9DD92630F93DC88F785B5630@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hello

I have a Wedge 100BF-32x switch running 4.14.151-OpenNetworkLinux.

I have BF SDE 9.1.0 installed.

I have successfully built the SDE using the stratum_profile.yaml.

The instructions for Stratum say to pull a docker container but:


  1.  Docker is not installed on the switch.
  2.  When I do install docker-ce and try to pull there is no image available.

I then tried to follow the instructions to build Stratum to install via dpkg:

bazel build //stratum/hal/bin/barefoot:stratum_bf_deb [--define phal_with_onlp=false] [--define sde_ver=9.2.0]

But bazel is not installed on the switch?

How can I run Stratum on this device please?

Thanks

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200712/36221bf5/attachment.html>

From d.lake at surrey.ac.uk  Sun Jul 12 23:03:18 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Sun, 12 Jul 2020 23:03:18 +0000
Subject: [stratum-dev] Issue with start-stratum-container
Message-ID: <VI1PR06MB5214B7FF262834047142169CB5630@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hello

I've pulled a Docker container for SDE 9.0.0 ONL 4.14.49 to my switch but when I try to start it, I see an issue:

/usr/bin/stratum_bf: symbol lookup error: /usr/bin/stratum_bf: undefined symbol: onlp_sw_init

The switch is an EdgeCore Wedge 100bf-32x.

I've also tried to build my own container which was successful and has the same issue.]

This is the output.

Thank you

David

ject/stratum-bf:9.0.0-4.14.49-OpenNetworkLinuxoot/docker# docker pull stratumproj
9.0.0-4.14.49-OpenNetworkLinux: Pulling from stratumproject/stratum-bf
3401a574d84f: Pull complete
8e538a274d7e: Pull complete
6e29648faf2e: Pull complete
Digest: sha256:e4c13610e57c74f27637f3f05b761f1fc06deca02237aae0d888a595aacaa08b
Status: Downloaded newer image for stratumproject/stratum-bf:9.0.0-4.14.49-OpenNetworkLinux
root at localhost:~/stratum/stratum/hal/bin/barefoot/docker# docker images
REPOSITORY                          TAG                              IMAGE ID            CREATED             SIZE
<none>                              <none>                           0377d3d6348f        18 minutes ago      11.3GB
<none>                              <none>                           112f2bec5523        37 minutes ago      169MB
<none>                              <none>                           166fec8f7382        38 minutes ago      11.3GB
stratumproject/stratum-bf-builder   bf-sde-9.0.0                     65c7afacc50f        About an hour ago   7.81GB
stratumproject/stratum-bf           9.0.0-4.14.49-OpenNetworkLinux   d7fae5ae92af        5 days ago          169MB
stratumproject/build                build                            7e76dd7129df        6 days ago          2.02GB
bitnami/minideb                     stretch                          5b33a3f54fe6        8 weeks ago         53.7MB
ner.sh calhost:~/stratum/stratum/hal/bin/barefoot/docker# ./start-stratum-contain
+ [[ -z '' ]]
+ [[ -f /etc/onl/platform ]]
++ cat /etc/onl/platform
+ PLATFORM=x86-64-accton-wedge100bf-32x-r0
+ '[' -d /etc/onl ']'
++ awk '{print "-v " $1 ":" $1 " " }'
++ ls /lib/x86_64-linux-gnu/libonlp-platform-defaults.so /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1 /lib/x86_64-linux-gnu/libonlp-platform.so /lib/x86_64-linux-gnu/libonlp-platform.so.1 /lib/x86_64-linux-gnu/libonlp.so /lib/x86_64-linux-gnu/libonlp.so.1 /lib/x86_64-linux-gnu/libonlp-x86-64-accton-wedge100bf-32x.so.1
+ ONLP_MOUNT='-v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so
-v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
-v /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so
-v /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1
-v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so
-v /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1
-v /lib/x86_64-linux-gnu/libo4-accton-wedge100bf-32x.so.1:/li[ 6679.377329] docker0: port 1(veth743a200) entered blocking state
[ 6679.390612] docker0: port 1(veth743a200) entered disabled state
b/x86_64-linux-g[ 6679.402526] device veth743a200 entered promiscuous mode
nu/libonlp-x86-6[ 6679.415826] IPv6: ADDRCONF(NETDEV_UP): veth743a200: link is not ready
4-accton-wedge100bf-32x.so.1 '
+ ONLP_MOUNT='-v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so
-v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
-v /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so
-v /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1
-v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so
-v /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1
-v /lib/x86_64-linux-gnu/libonlp-x86-64-accton-wedge100bf-32x.so.1:/lib/x86_64-linux-gnu/libonlp-x86-64-accton-wedge100bf-32x.so.1                -v /lib/platform-config:/lib/platform-config               -v /etc/onl:/etc/onl'
+ '[' -n '' ']'
+ '[' -n '' ']'
+ LOG_DIR=/var/log
+ SDE_VERSION=9.0.0
++ uname -r
+ KERNEL_VERSION=4.14.49-OpenNetworkLinux
+ DOCKER_IMAGE=stratumproject/stratum-bf
+ DOCKER_IMAGE_TAG=9.0.0-4.14.49-OpenNetworkLinux
++ uname -r
++ uname -r
+ docker run -it --rm --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux --env PLATFORM=x86-64-accton-wedge100bf-32x-r0 -v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so -v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1 -v /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so -v /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1 -v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so -v /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1 -v /lib/x86_64-linux-gnu/libonlp-x86-64-accton-wedge100bf-32x.so.1:/lib/x86_64-linux-gnu/libonlp-x86-64-accton-wedge100bf-32x.so.1 -v /lib/platform-config:/lib/platform-config -v /etc/onl:/etc/onl -p 28000:28000 -p 9339:9339 -v /var/log:/var/log/stratum stratumproject/stratum-bf:9.0.0-4.14.49-OpenNetworkLinux
[ 6680.224703] eth0: renamed from vetha27ed66
[ 6680.272671] IPv6: ADDRCONF(NETDEV_CHANGE): veth743a200: link becomes ready
[ 6680.286500] docker0: port 1(veth743a200) entered blocking state
[ 6680.298360] docker0: port 1(veth743a200) entered forwarding state
bf_kdrv_mod found! Unloading first...
loading bf_kdrv_[ 6680.434958] Use MSI interrupt
mod...
[ 6680.442117] BF allocating legacy int vector 11
[ 6680.451998] bf 0000:05:00.0: bf device 0 registered with irq 11
[ 6680.463842] bf probe ok
/usr/bin/stratum_bf: symbol lookup error: /usr/bin/stratum_bf: undefined symbol: onlp_sw_init
[ 6680.702096] docker0: port 1(veth743a200) entered disabled state
[ 6680.714056] vetha27ed66: renamed from eth0
[ 6680.845051] docker0: port 1(veth743a200) entered disabled state
[ 6680.857394] device veth743a200 left promiscuous mode
[ 6680.867363] docker0: port 1(veth743a200) entered disabled state
root at localhost:~/stratum/stratum/hal/bin/barefoot/docker#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200712/8546715b/attachment-0001.html>

From davidgengenbach at gmx.de  Mon Jul 13 00:00:32 2020
From: davidgengenbach at gmx.de (David Gengenbach)
Date: Mon, 13 Jul 2020 02:00:32 +0200
Subject: [stratum-dev] Confused about how to run Stratum
Message-ID: <7f137b2a-012e-3d32-047c-30cb016899b4@gmx.de>

I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280


From aghaffar at google.com  Mon Jul 13 06:01:01 2020
From: aghaffar at google.com (Alireza Ghaffarkhah)
Date: Sun, 12 Jul 2020 23:01:01 -0700
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
Message-ID: <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>

+Brian O'Connor <brian at opennetworking.org> +Yi Tseng <yi at opennetworking.org>
 +Maximilian Pudelko <max at opennetworking.org> in case they can provide more
input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <
stratum-dev at lists.stratumproject.org> wrote:

> I created a setup guide for this exact use-case. The PR for it has not
> been merged but should work: https://github.com/stratum/stratum/pull/280
>
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200712/8015bb4e/attachment.html>

From d.lake at surrey.ac.uk  Mon Jul 13 07:41:51 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Mon, 13 Jul 2020 07:41:51 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <7f137b2a-012e-3d32-047c-30cb016899b4@gmx.de>
References: <7f137b2a-012e-3d32-047c-30cb016899b4@gmx.de>
Message-ID: <VI1PR06MB5214968E99E876C9FA1FDE76B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hi

Thanks - but that gives me a 500 error?

Also, I have now been able to build a container but when I try and run it I get this message;

/usr/local/bin/stratum_bf: symbol lookup error: /usr/local/bin/stratum_bf: undefined symbol: onlp_sw_init

Thanks  

David

-----Original Message-----
From: David Gengenbach <davidgengenbach at gmx.de> 
Sent: 13 July 2020 01:01
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum

I created a setup guide for this exact use-case. The PR for it has not been merged but should work: https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&amp;data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cf8ea7df12de84243f84908d826bfc413%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637301952363140710&amp;sdata=YU5WPowl1zO1ZpXfLLGFKPE85nI0ppwjLQXsEwPecBc%3D&amp;reserved=0


From d.lake at surrey.ac.uk  Mon Jul 13 21:20:52 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Mon, 13 Jul 2020 21:20:52 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
Message-ID: <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>

OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C4f4583ab6704455b169c08d826f2263a%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302168754861486&sdata=lOeajVrVj9WuLmwrXJxoY79aJVD7amgmxaFeZ5SPQSU%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C4f4583ab6704455b169c08d826f2263a%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302168754861486&sdata=48TwOOswQ5trT99bjjnm30vSYpid0ObqjsxDOhjPPRk%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/d794dbff/attachment.html>

From davidgengenbach at gmx.de  Mon Jul 13 21:42:05 2020
From: davidgengenbach at gmx.de (David Gengenbach)
Date: Mon, 13 Jul 2020 23:42:05 +0200
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
Message-ID: <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>

It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino"
section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino.
They provide compiled switch binaries. If you follow their guide, these
are automatically cleaned (= deleted) before they are compiled again -
so all subsequent commands will not work unless you are able to compile
them yourself (which is only needed if you want to change the underlying
P4 program, I guess). So I would suggest starting with a fresh copy of
fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS
via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)


https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino

On 7/13/20 11:20 PM, David Lake wrote:
>
> OK – I followed the instructions from David Gengenbach (thank you) and
> I now have a Stratum agent running on the switch.
>
> I then built the pipeline in ONOS and loaded it:
>
> 2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net
> - 2.2.3 | Application org.opencord.fabric-tofino has been activated
>
> root at ONOS:~/fabric-tofino#
>
> But when I add the netfcfg, I see this message in the ONOS log:
>
> 2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       |
> DeviceTaskExecutor               | 225 -
> org.onosproject.onos-providers-general-device - 2.2.3 | Unable to
> complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf
> org.opencord.fabric.tofino.montara_sde_9_0_0 not registered
>
> My switch is a Montara but I don’t see where the pipeconf is built?
>
> On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not
> built anything with the bf-sde.
>
> Do I need to run p4studio_build in the BF-SDE first?
>
> Thanks
>
>
> David
>
> *From:*Alireza Ghaffarkhah <aghaffar at google.com>
> *Sent:* 13 July 2020 07:01
> *To:* David Gengenbach <davidgengenbach at gmx.de>; Brian O'Connor
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>;
> Maximilian Pudelko <max at opennetworking.org>
> *Cc:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>;
> stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
> +Brian O'Connor <mailto:brian at opennetworking.org> +Yi Tseng
> <mailto:yi at opennetworking.org> +Maximilian Pudelko
> <mailto:max at opennetworking.org> in case they can provide more input.
>
> On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev
> <stratum-dev at lists.stratumproject.org
> <mailto:stratum-dev at lists.stratumproject.org>> wrote:
>
>     I created a setup guide for this exact use-case. The PR for it has not
>     been merged but should work:
>     https://github.com/stratum/stratum/pull/280
>     <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C4f4583ab6704455b169c08d826f2263a%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302168754861486&sdata=lOeajVrVj9WuLmwrXJxoY79aJVD7amgmxaFeZ5SPQSU%3D&reserved=0>
>
>     _______________________________________________
>     stratum-dev mailing list
>     stratum-dev at lists.stratumproject.org
>     <mailto:stratum-dev at lists.stratumproject.org>
>     https://lists.stratumproject.org/listinfo/stratum-dev
>     <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C4f4583ab6704455b169c08d826f2263a%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302168754861486&sdata=48TwOOswQ5trT99bjjnm30vSYpid0ObqjsxDOhjPPRk%3D&reserved=0>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/159a7ab8/attachment-0001.html>

From d.lake at surrey.ac.uk  Mon Jul 13 21:46:17 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Mon, 13 Jul 2020 21:46:17 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
Message-ID: <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>

I did follow this step and was able to register the application and pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?

David

root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
*** Installing and activating pipeconf app in ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -HContent-Type:ap                                                                                                                                                             plication/octet-stream \
        'http://localhost:8181/onos/v1/applications?activate=true' \
        --data-binary @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN                                                                                                                                                             APSHOT.oar
{"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego                                                                                                                                                             ry":"Pipeline","description":"Provides pipeconfs based on fabric.","readme":"Pro                                                                                                                                                             vides pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n            To                                                                                                                                                             fino-based devices.","origin":"http://www.opencord.org","url":"http://www.openco                                                                                                                                                             rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur                                                                                                                                                             es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps                                                                                                                                                             ":["org.onosproject.pipelines.fabric"]}
root at ONOS:~/fabric-tofino#
root at ONOS:~/fabric-tofino#





root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int (fingerprint=cf:0e:30:28:dc:5f:97:4c)
2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 | PipeconfLoader                   | 237 - org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

From: David Gengenbach <davidgengenbach at gmx.de>
Sent: 13 July 2020 22:42
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum


It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino" section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino. They provide compiled switch binaries. If you follow their guide, these are automatically cleaned (= deleted) before they are compiled again - so all subsequent commands will not work unless you are able to compile them yourself (which is only needed if you want to change the underlying P4 program, I guess). So I would suggest starting with a fresh copy of fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)


https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cfe209a4d53fb42f6ee9b08d827759897%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302733323245533&sdata=Ktr2VtAp05dZNWoEgFkfH8KEAg7Q4i0hy8p4rlTgYfk%3D&reserved=0>
On 7/13/20 11:20 PM, David Lake wrote:
OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cfe209a4d53fb42f6ee9b08d827759897%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302733323255530&sdata=94scdPXRGyf%2BEj%2BfmYBzHIwx3vY0RD9XcYl%2FX57m1sM%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cfe209a4d53fb42f6ee9b08d827759897%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302733323265533&sdata=4gS0cZGnWSQFtvrk36IPprPkz37GMX1rRuVq78%2BExzg%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/8e5b18a2/attachment-0001.html>

From davidgengenbach at gmx.de  Mon Jul 13 21:50:15 2020
From: davidgengenbach at gmx.de (David Gengenbach)
Date: Mon, 13 Jul 2020 23:50:15 +0200
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
Message-ID: <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>

Unfortunately, I do not have access to the Tofino switch now, so I can
not confirm your logs.
Can you please also provide the output of running "pipeconf | grep
tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).

Did you start with an empty fabric-tofino repo and executed the commands?

Especially this log entry is strange (but again, I can not verify
whether this is normal):
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
FabricPipeconfLoader             | 236 -
org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build
pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is
missing: spectrum.bin


On 7/13/20 11:46 PM, David Lake wrote:
>
> I did follow this step and was able to register the application and
> pipeline but I don’t see
> “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?
>
> David
>
> root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
>
> *** Installing and activating pipeconf app in ONOS at localhost...
>
> curl --fail -sSL --user onos:rocks --noproxy localhost -X POST
> -HContent-Type:ap       plication/octet-stream \
>
> 'http://localhost:8181/onos/v1/applications?activate=true' \
>
> --data-binary
> @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN
>                                                                                  APSHOT.oar
>
> {"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego
>                                                                          ry":"Pipeline","description":"Provides
> pipeconfs based on fabric.","readme":"Pro
>                                                       vides pipeconfs
> based on fabric.p4 to use Trellis with Barefoot\\n To
>                                    fino-based
> devices.","origin":"http://www.opencord.org","url":"http://www.openco
>                 rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur
> es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps
> ":["org.onosproject.pipelines.fabric"]}
>
> root at ONOS:~/fabric-tofino#
>
> root at ONOS:~/fabric-tofino#
>
> root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
>
> 2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 |   Region: root
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | org.onosproject.onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic
> (fingerprint=1f:03:c5:4d:32:19:e4:f4)
>
> 2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int
> (fingerprint=cf:0e:30:28:dc:5f:97:4c)
>
> 2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Done.
>
> 2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net
> - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
>
> 2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
>
> 2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl       | 11 - org.apache.karaf.features.core -
> 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 |   Region: root
>
> 2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | org.onosproject.onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | org.onosproject.onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build
> pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is
> missing: spectrum.bin
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered:
> org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered:
> org.onosproject.pipelines.fabric-full
> (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered:
> org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered:
> org.onosproject.pipelines.fabric-spgw-int
> (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered:
> org.onosproject.pipelines.fabric-spgw
> (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net
> - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric
> (fingerprint=33:a1:c2:36:82:04:f5:0c)
>
> 2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
> 2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
> 2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Done.
>
> 2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net
> - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
>
> 2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
>
> 2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 |   Region: root
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
> 2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
> 2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | org.opencord.fabric-tofino/1.1.1.SNAPSHOT
>
> 2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 |
> PipeconfLoader                   | 237 - org.opencord.fabric-tofino -
> 1.1.1.SNAPSHOT | Started
>
> 2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core
> - 4.2.8 | Done.
>
> 2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net
> - 2.2.3 | Application org.opencord.fabric-tofino has been activated
>
> root at ONOS:~/fabric-tofino#
>
> *From:*David Gengenbach <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 22:42
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>;
> Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>;
> Maximilian Pudelko <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
> It seems like you did not install/activate the fabric-tofino library?
>
> Did you follow the steps in the guide? The "Compile fabric-tofino"
> section should install the pipeconfs.
>
> Important: you do NOT have to follow the whole guide of fabric-tofino.
> They provide compiled switch binaries. If you follow their guide,
> these are automatically cleaned (= deleted) before they are compiled
> again - so all subsequent commands will not work unless you are able
> to compile them yourself (which is only needed if you want to change
> the underlying P4 program, I guess). So I would suggest starting with
> a fresh copy of fabric-tofino in case you changed to much.
>
> For troubleshooting: as described in the guide, you can connect to
> ONOS via the CLI and look for the pipeconf by executing:
> `onos onos at localhost` (or wherever ONOS is hosted)
>
> https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cfe209a4d53fb42f6ee9b08d827759897%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302733323245533&sdata=Ktr2VtAp05dZNWoEgFkfH8KEAg7Q4i0hy8p4rlTgYfk%3D&reserved=0>
>
> On 7/13/20 11:20 PM, David Lake wrote:
>
>     OK – I followed the instructions from David Gengenbach (thank you)
>     and I now have a Stratum agent running on the switch.
>
>     I then built the pipeline in ONOS and loaded it:
>
>     2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
>     ApplicationManager               | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | Application
>     org.opencord.fabric-tofino has been activated
>
>     root at ONOS:~/fabric-tofino#
>
>     But when I add the netfcfg, I see this message in the ONOS log:
>
>     2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       |
>     DeviceTaskExecutor               | 225 -
>     org.onosproject.onos-providers-general-device - 2.2.3 | Unable to
>     complete task CONNECTION_SETUP for device:my-tofino-switch:
>     pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered
>
>     My switch is a Montara but I don’t see where the pipeconf is built?
>
>     On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not
>     built anything with the bf-sde.
>
>     Do I need to run p4studio_build in the BF-SDE first?
>
>     Thanks
>
>
>     David
>
>     *From:*Alireza Ghaffarkhah <aghaffar at google.com>
>     <mailto:aghaffar at google.com>
>     *Sent:* 13 July 2020 07:01
>     *To:* David Gengenbach <davidgengenbach at gmx.de>
>     <mailto:davidgengenbach at gmx.de>; Brian O'Connor
>     <brian at opennetworking.org> <mailto:brian at opennetworking.org>; Yi
>     Tseng <yi at opennetworking.org> <mailto:yi at opennetworking.org>;
>     Maximilian Pudelko <max at opennetworking.org>
>     <mailto:max at opennetworking.org>
>     *Cc:* Lake, David (PG/R - Elec Electronic Eng)
>     <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>;
>     stratum-dev at lists.stratumproject.org
>     <mailto:stratum-dev at lists.stratumproject.org>
>     *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>     +Brian O'Connor <mailto:brian at opennetworking.org> +Yi Tseng
>     <mailto:yi at opennetworking.org> +Maximilian Pudelko
>     <mailto:max at opennetworking.org> in case they can provide more input.
>
>     On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev
>     <stratum-dev at lists.stratumproject.org
>     <mailto:stratum-dev at lists.stratumproject.org>> wrote:
>
>         I created a setup guide for this exact use-case. The PR for it
>         has not
>         been merged but should work:
>         https://github.com/stratum/stratum/pull/280
>         <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cfe209a4d53fb42f6ee9b08d827759897%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302733323255530&sdata=94scdPXRGyf%2BEj%2BfmYBzHIwx3vY0RD9XcYl%2FX57m1sM%3D&reserved=0>
>
>         _______________________________________________
>         stratum-dev mailing list
>         stratum-dev at lists.stratumproject.org
>         <mailto:stratum-dev at lists.stratumproject.org>
>         https://lists.stratumproject.org/listinfo/stratum-dev
>         <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cfe209a4d53fb42f6ee9b08d827759897%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302733323265533&sdata=4gS0cZGnWSQFtvrk36IPprPkz37GMX1rRuVq78%2BExzg%3D&reserved=0>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/e250cc94/attachment-0001.html>

From d.lake at surrey.ac.uk  Mon Jul 13 22:01:02 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Mon, 13 Jul 2020 22:01:02 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
Message-ID: <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>

AHA!   Perfect – thank you.   It seems that the fabric-tofino was not empty.   I deleted and recompiled and now I see my switch!

Thank you so much for your help.

Kind regards

David

From: David Gengenbach <davidgengenbach at gmx.de>
Sent: 13 July 2020 22:50
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum


Unfortunately, I do not have access to the Tofino switch now, so I can not confirm your logs.
Can you please also provide the output of running "pipeconf | grep tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).

Did you start with an empty fabric-tofino repo and executed the commands?

Especially this log entry is strange (but again, I can not verify whether this is normal):
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin


On 7/13/20 11:46 PM, David Lake wrote:
I did follow this step and was able to register the application and pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?

David

root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
*** Installing and activating pipeconf app in ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -HContent-Type:ap                                                                                                                                                             plication/octet-stream \
        'http://localhost:8181/onos/v1/applications?activate=true' \
        --data-binary @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN                                                                                                                                                             APSHOT.oar
{"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego                                                                                                                                                             ry":"Pipeline","description":"Provides pipeconfs based on fabric.","readme":"Pro                                                                                                                                                             vides pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n            To                                                                                                                                                             fino-based devices.","origin":"http://www.opencord.org"<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229917886&sdata=P15eHZ7XSBVdmsPCC%2B50YAAnRSycjkw65hEjnjeGYok%3D&reserved=0>,"url":"http://www.openco<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229927876&sdata=H3R2PcRjr0rwMJWowO57TION6WNm89ruFKxLAbbL%2FPA%3D&reserved=0>                                                                                                                                                             rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur                                                                                                                                                             es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps                                                                                                                                                             ":["org.onosproject.pipelines.fabric"]}
root at ONOS:~/fabric-tofino#
root at ONOS:~/fabric-tofino#





root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int (fingerprint=cf:0e:30:28:dc:5f:97:4c)
2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 | PipeconfLoader                   | 237 - org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:42
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino" section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino. They provide compiled switch binaries. If you follow their guide, these are automatically cleaned (= deleted) before they are compiled again - so all subsequent commands will not work unless you are able to compile them yourself (which is only needed if you want to change the underlying P4 program, I guess). So I would suggest starting with a fresh copy of fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)



https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229927876&sdata=Hp3829IGHO8C%2F6T9F9lVTqGWHuwNobjVeBWqUGvJ0qk%3D&reserved=0>
On 7/13/20 11:20 PM, David Lake wrote:
OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229937868&sdata=d%2FiyS0msKs1j0PKRAXgfkIvuiPKA8lLQ8f%2BFwzD2%2Bhc%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229937868&sdata=naYFj1UhS5nHjnHYRWt9QwwW6tbK%2BjBaBLIfnTVQ1wI%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/cf4b7e37/attachment-0001.html>

From davidgengenbach at gmx.de  Mon Jul 13 22:11:55 2020
From: davidgengenbach at gmx.de (David Gengenbach)
Date: Tue, 14 Jul 2020 00:11:55 +0200
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
Message-ID: <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>

Perfect!
Interestingly, I think I had the exact same problems you encountered :D
That's why I wrote this guide - a lot of pitfalls. Restarting and
starting with a clean slate, miraculously, solved a lot of my problems.

On 7/14/20 12:01 AM, David Lake wrote:
>
> AHA!   Perfect – thank you.   It seems that the fabric-tofino was not
> empty.   I deleted and recompiled and now I see my switch!
>
> Thank you so much for your help.
>
>
> Kind regards
>
> David
>
> *From:*David Gengenbach <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 22:50
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>;
> Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>;
> Maximilian Pudelko <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
> Unfortunately, I do not have access to the Tofino switch now, so I can
> not confirm your logs.
> Can you please also provide the output of running "pipeconf | grep
> tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).
>
> Did you start with an empty fabric-tofino repo and executed the commands?
>
> Especially this log entry is strange (but again, I can not verify
> whether this is normal):
> 2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build
> pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is
> missing: spectrum.bin
>
> On 7/13/20 11:46 PM, David Lake wrote:
>
>     I did follow this step and was able to register the application
>     and pipeline but I don’t see
>     “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?
>
>     David
>
>     root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
>
>     *** Installing and activating pipeconf app in ONOS at localhost...
>
>     curl --fail -sSL --user onos:rocks --noproxy localhost -X POST
>     -HContent-Type:ap       plication/octet-stream \
>
>     'http://localhost:8181/onos/v1/applications?activate=true' \
>
>     --data-binary
>     @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN
>                                                                                      APSHOT.oar
>
>     {"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego
>                                                                              ry":"Pipeline","description":"Provides
>     pipeconfs based on fabric.","readme":"Pro
>                                                           vides
>     pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n To
>                                        fino-based
>     devices.","origin":"http://www.opencord.org"
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229917886&sdata=P15eHZ7XSBVdmsPCC%2B50YAAnRSycjkw65hEjnjeGYok%3D&reserved=0>,"url":"http://www.openco
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229927876&sdata=H3R2PcRjr0rwMJWowO57TION6WNm89ruFKxLAbbL%2FPA%3D&reserved=0>
>                     rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur
>     es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps
>     ":["org.onosproject.pipelines.fabric"]}
>
>     root at ONOS:~/fabric-tofino#
>
>     root at ONOS:~/fabric-tofino#
>
>     root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
>
>     2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>
>     2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |   Region: root
>
>     2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>
>     2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
>     2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
>     2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>
>     2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
>     2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
>     2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>
>     2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
>
>     2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     org.onosproject.onos-pipelines-basic/2.2.3
>
>     2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
>
>     2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.int (fingerprint=cf:0e:30:28:dc:5f:97:4c)
>
>     2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Done.
>
>     2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation |
>     ApplicationManager               | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | Application
>     org.onosproject.pipelines.basic has been activated
>
>     2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Adding features:
>     onos-pipelines-fabric/[2.2.3,2.2.3]
>
>     2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl       | 11 - org.apache.karaf.features.core -
>     4.2.8 | Changes to perform:
>
>     2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |   Region: root
>
>     2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>
>     2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
>     2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
>     2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>
>     2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
>     2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
>     2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>
>     2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     org.onosproject.onos-pipelines-fabric-api/2.2.3
>
>     2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     org.onosproject.onos-pipelines-fabric-impl/2.2.3
>
>     2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
>     FabricPipeconfLoader             | 236 -
>     org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to
>     build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because
>     file is missing: spectrum.bin
>
>     2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.fabric-bng
>     (fingerprint=9e:af:91:d4:8c:8a:bc:98)
>
>     2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.fabric-full
>     (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
>
>     2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.fabric-int
>     (fingerprint=01:39:87:22:c5:c4:e6:0a)
>
>     2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.fabric-spgw-int
>     (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
>
>     2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.fabric-spgw
>     (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
>
>     2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>     PiPipeconfManager                | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered:
>     org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
>
>     2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 |
>     FabricPipeconfLoader             | 236 -
>     org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
>     2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 |
>     FabricPipeconfLoader             | 236 -
>     org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
>     2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Done.
>
>     2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation |
>     ApplicationManager               | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | Application
>     org.onosproject.pipelines.fabric has been activated
>
>     2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Adding features:
>     fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
>
>     2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>
>     2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |   Region: root
>
>     2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>
>     2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
>     2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>
>     2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
>     2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>
>     2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 |
>     org.opencord.fabric-tofino/1.1.1.SNAPSHOT
>
>     2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 |
>     PipeconfLoader                   | 237 -
>     org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
>
>     2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 |
>     FeaturesServiceImpl              | 11 -
>     org.apache.karaf.features.core - 4.2.8 | Done.
>
>     2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
>     ApplicationManager               | 193 -
>     org.onosproject.onos-core-net - 2.2.3 | Application
>     org.opencord.fabric-tofino has been activated
>
>     root at ONOS:~/fabric-tofino#
>
>     *From:*David Gengenbach <davidgengenbach at gmx.de>
>     <mailto:davidgengenbach at gmx.de>
>     *Sent:* 13 July 2020 22:42
>     *To:* Lake, David (PG/R - Elec Electronic Eng)
>     <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>; Alireza
>     Ghaffarkhah <aghaffar at google.com> <mailto:aghaffar at google.com>;
>     Brian O'Connor <brian at opennetworking.org>
>     <mailto:brian at opennetworking.org>; Yi Tseng
>     <yi at opennetworking.org> <mailto:yi at opennetworking.org>; Maximilian
>     Pudelko <max at opennetworking.org> <mailto:max at opennetworking.org>
>     *Cc:* stratum-dev at lists.stratumproject.org
>     <mailto:stratum-dev at lists.stratumproject.org>
>     *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>     It seems like you did not install/activate the fabric-tofino library?
>
>     Did you follow the steps in the guide? The "Compile fabric-tofino"
>     section should install the pipeconfs.
>
>     Important: you do NOT have to follow the whole guide of
>     fabric-tofino. They provide compiled switch binaries. If you
>     follow their guide, these are automatically cleaned (= deleted)
>     before they are compiled again - so all subsequent commands will
>     not work unless you are able to compile them yourself (which is
>     only needed if you want to change the underlying P4 program, I
>     guess). So I would suggest starting with a fresh copy of
>     fabric-tofino in case you changed to much.
>
>     For troubleshooting: as described in the guide, you can connect to
>     ONOS via the CLI and look for the pipeconf by executing:
>     `onos onos at localhost` (or wherever ONOS is hosted)
>
>
>     https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino
>     <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229927876&sdata=Hp3829IGHO8C%2F6T9F9lVTqGWHuwNobjVeBWqUGvJ0qk%3D&reserved=0>
>
>     On 7/13/20 11:20 PM, David Lake wrote:
>
>         OK – I followed the instructions from David Gengenbach (thank
>         you) and I now have a Stratum agent running on the switch.
>
>         I then built the pipeline in ONOS and loaded it:
>
>         2020-07-13T22:10:58,999 | INFO  |
>         onos-store-app-app-activation |
>         ApplicationManager               | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | Application
>         org.opencord.fabric-tofino has been activated
>
>         root at ONOS:~/fabric-tofino#
>
>         But when I add the netfcfg, I see this message in the ONOS log:
>
>         2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       |
>         DeviceTaskExecutor               | 225 -
>         org.onosproject.onos-providers-general-device - 2.2.3 | Unable
>         to complete task CONNECTION_SETUP for device:my-tofino-switch:
>         pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not
>         registered
>
>         My switch is a Montara but I don’t see where the pipeconf is
>         built?
>
>         On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have
>         not built anything with the bf-sde.
>
>         Do I need to run p4studio_build in the BF-SDE first?
>
>         Thanks
>
>
>         David
>
>         *From:*Alireza Ghaffarkhah <aghaffar at google.com>
>         <mailto:aghaffar at google.com>
>         *Sent:* 13 July 2020 07:01
>         *To:* David Gengenbach <davidgengenbach at gmx.de>
>         <mailto:davidgengenbach at gmx.de>; Brian O'Connor
>         <brian at opennetworking.org> <mailto:brian at opennetworking.org>;
>         Yi Tseng <yi at opennetworking.org>
>         <mailto:yi at opennetworking.org>; Maximilian Pudelko
>         <max at opennetworking.org> <mailto:max at opennetworking.org>
>         *Cc:* Lake, David (PG/R - Elec Electronic Eng)
>         <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>;
>         stratum-dev at lists.stratumproject.org
>         <mailto:stratum-dev at lists.stratumproject.org>
>         *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>         +Brian O'Connor <mailto:brian at opennetworking.org> +Yi Tseng
>         <mailto:yi at opennetworking.org> +Maximilian Pudelko
>         <mailto:max at opennetworking.org> in case they can provide more
>         input.
>
>         On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via
>         stratum-dev <stratum-dev at lists.stratumproject.org
>         <mailto:stratum-dev at lists.stratumproject.org>> wrote:
>
>             I created a setup guide for this exact use-case. The PR
>             for it has not
>             been merged but should work:
>             https://github.com/stratum/stratum/pull/280
>             <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229937868&sdata=d%2FiyS0msKs1j0PKRAXgfkIvuiPKA8lLQ8f%2BFwzD2%2Bhc%3D&reserved=0>
>
>             _______________________________________________
>             stratum-dev mailing list
>             stratum-dev at lists.stratumproject.org
>             <mailto:stratum-dev at lists.stratumproject.org>
>             https://lists.stratumproject.org/listinfo/stratum-dev
>             <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cd600e4d0063b42f8856908d82776bd04%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302738229937868&sdata=naYFj1UhS5nHjnHYRWt9QwwW6tbK%2BjBaBLIfnTVQ1wI%3D&reserved=0>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200714/03fb1a82/attachment-0001.html>

From d.lake at surrey.ac.uk  Mon Jul 13 22:15:47 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Mon, 13 Jul 2020 22:15:47 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
Message-ID: <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>

The guide was VERY useful!

I now need to understand how to configure the ports in the switch – I want to build a very simple SPGW use-case with a single switch.

How do I build the switch configuration?  Is this is in the JSON file?

Thanks

David

From: David Gengenbach <davidgengenbach at gmx.de>
Sent: 13 July 2020 23:12
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum


Perfect!
Interestingly, I think I had the exact same problems you encountered :D That's why I wrote this guide - a lot of pitfalls. Restarting and starting with a clean slate, miraculously, solved a lot of my problems.
On 7/14/20 12:01 AM, David Lake wrote:
AHA!   Perfect – thank you.   It seems that the fabric-tofino was not empty.   I deleted and recompiled and now I see my switch!

Thank you so much for your help.

Kind regards

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:50
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Unfortunately, I do not have access to the Tofino switch now, so I can not confirm your logs.
Can you please also provide the output of running "pipeconf | grep tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).

Did you start with an empty fabric-tofino repo and executed the commands?

Especially this log entry is strange (but again, I can not verify whether this is normal):
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin


On 7/13/20 11:46 PM, David Lake wrote:
I did follow this step and was able to register the application and pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?

David

root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
*** Installing and activating pipeconf app in ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -HContent-Type:ap                                                                                                                                                             plication/octet-stream \
        'http://localhost:8181/onos/v1/applications?activate=true' \
        --data-binary @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN                                                                                                                                                             APSHOT.oar
{"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego                                                                                                                                                             ry":"Pipeline","description":"Provides pipeconfs based on fabric.","readme":"Pro                                                                                                                                                             vides pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n            To                                                                                                                                                             fino-based devices.","origin":"http://www.opencord.org"<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234825308&sdata=AL7QWHARhScQuKn4M2F2hH9U3LnYa5jAQaVdkx2xPk0%3D&reserved=0>,"url":"http://www.openco<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=4%2BsuFYwNtfNqfKI9iPyn646TVZvmbjFIicgDC5sXtSw%3D&reserved=0>                                                                                                                                                             rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur                                                                                                                                                             es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps                                                                                                                                                             ":["org.onosproject.pipelines.fabric"]}
root at ONOS:~/fabric-tofino#
root at ONOS:~/fabric-tofino#





root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int (fingerprint=cf:0e:30:28:dc:5f:97:4c)
2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 | PipeconfLoader                   | 237 - org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:42
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino" section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino. They provide compiled switch binaries. If you follow their guide, these are automatically cleaned (= deleted) before they are compiled again - so all subsequent commands will not work unless you are able to compile them yourself (which is only needed if you want to change the underlying P4 program, I guess). So I would suggest starting with a fresh copy of fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)




https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=Icxw4PbbRnKxnXbyoVvZp1fqz5X%2F2fpn2fx8Vw9lnJM%3D&reserved=0>
On 7/13/20 11:20 PM, David Lake wrote:
OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=ZSVE44LwncoyEu6%2BU1pcDa9dDh4bjWPSSHZxnd4Hl24%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=jcoe4FaLpCCHSwMbCdNrBEpR9Kz0EoMvlaU6CE03gXg%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/f1c4d7b6/attachment-0001.html>

From davidgengenbach at gmx.de  Mon Jul 13 22:22:44 2020
From: davidgengenbach at gmx.de (David Gengenbach)
Date: Tue, 14 Jul 2020 00:22:44 +0200
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
Message-ID: <30d99d32-caba-3e0f-d1d8-66284dc3c77b@gmx.de>

As far as I know, you would use gNMI
(https://github.com/openconfig/gnmi) for this - which is also
bundled/started with Stratum.
Here is a really helpful tutorial for Stratum which also covers gNMI:
https://github.com/stratum/tutorial/tree/master/basic#gnmi

The port config command would look something like: ./gnmi-cli.sh set
/interfaces/interface[name=s1-eth1]/config/enabled --bool-val true

(Using the gnmi-cli from the tutorial.)

On 7/14/20 12:15 AM, David Lake wrote:
>
> The guide was VERY useful!
>
>
> I now need to understand how to configure the ports in the switch – I
> want to build a very simple SPGW use-case with a single switch.
>
> How do I build the switch configuration?  Is this is in the JSON file?
>
> Thanks
>
> David
>
> *From:*David Gengenbach <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 23:12
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>;
> Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>;
> Maximilian Pudelko <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
> Perfect!
> Interestingly, I think I had the exact same problems you encountered
> :D That's why I wrote this guide - a lot of pitfalls. Restarting and
> starting with a clean slate, miraculously, solved a lot of my problems.
>
> On 7/14/20 12:01 AM, David Lake wrote:
>
>     AHA!   Perfect – thank you.   It seems that the fabric-tofino was
>     not empty.   I deleted and recompiled and now I see my switch!
>
>     Thank you so much for your help.
>
>
>     Kind regards
>
>     David
>
>     *From:*David Gengenbach <davidgengenbach at gmx.de>
>     <mailto:davidgengenbach at gmx.de>
>     *Sent:* 13 July 2020 22:50
>     *To:* Lake, David (PG/R - Elec Electronic Eng)
>     <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>; Alireza
>     Ghaffarkhah <aghaffar at google.com> <mailto:aghaffar at google.com>;
>     Brian O'Connor <brian at opennetworking.org>
>     <mailto:brian at opennetworking.org>; Yi Tseng
>     <yi at opennetworking.org> <mailto:yi at opennetworking.org>; Maximilian
>     Pudelko <max at opennetworking.org> <mailto:max at opennetworking.org>
>     *Cc:* stratum-dev at lists.stratumproject.org
>     <mailto:stratum-dev at lists.stratumproject.org>
>     *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>     Unfortunately, I do not have access to the Tofino switch now, so I
>     can not confirm your logs.
>     Can you please also provide the output of running "pipeconf | grep
>     tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).
>
>     Did you start with an empty fabric-tofino repo and executed the
>     commands?
>
>     Especially this log entry is strange (but again, I can not verify
>     whether this is normal):
>     2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
>     FabricPipeconfLoader             | 236 -
>     org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to
>     build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because
>     file is missing: spectrum.bin
>
>     On 7/13/20 11:46 PM, David Lake wrote:
>
>         I did follow this step and was able to register the
>         application and pipeline but I don’t see
>         “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?
>
>         David
>
>         root at ONOS:~/fabric-tofino# make pipeconf-install
>         ONOS_HOST=localhost
>
>         *** Installing and activating pipeconf app in ONOS at localhost...
>
>         curl --fail -sSL --user onos:rocks --noproxy localhost -X POST
>         -HContent-Type:ap       plication/octet-stream \
>
>                
>         'http://localhost:8181/onos/v1/applications?activate=true' \
>
>                 --data-binary
>         @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN
>                                                                                          APSHOT.oar
>
>         {"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego
>                                                                                  ry":"Pipeline","description":"Provides
>         pipeconfs based on fabric.","readme":"Pro
>                                                               vides
>         pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n
>         To                                    fino-based
>         devices.","origin":"http://www.opencord.org"
>         <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234825308&sdata=AL7QWHARhScQuKn4M2F2hH9U3LnYa5jAQaVdkx2xPk0%3D&reserved=0>,"url":"http://www.openco
>         <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=4%2BsuFYwNtfNqfKI9iPyn646TVZvmbjFIicgDC5sXtSw%3D&reserved=0>
>                         rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur
>         es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps
>         ":["org.onosproject.pipelines.fabric"]}
>
>         root at ONOS:~/fabric-tofino#
>
>         root at ONOS:~/fabric-tofino#
>
>         root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
>
>         2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>
>         2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |   Region: root
>
>         2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>
>         2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
>         2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
>         2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>
>         2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
>         2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
>         2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>
>         2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
>
>         2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         org.onosproject.onos-pipelines-basic/2.2.3
>
>         2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.basic
>         (fingerprint=1f:03:c5:4d:32:19:e4:f4)
>
>         2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.int
>         (fingerprint=cf:0e:30:28:dc:5f:97:4c)
>
>         2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Done.
>
>         2020-07-13T22:10:56,399 | INFO  |
>         onos-store-app-app-activation |
>         ApplicationManager               | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | Application
>         org.onosproject.pipelines.basic has been activated
>
>         2020-07-13T22:10:56,402 | INFO  |
>         onos-store-app-app-activation |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Adding features:
>         onos-pipelines-fabric/[2.2.3,2.2.3]
>
>         2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>
>         2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |   Region: root
>
>         2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>
>         2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
>         2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
>         2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>
>         2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
>         2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
>         2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>
>         2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         org.onosproject.onos-pipelines-fabric-api/2.2.3
>
>         2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         org.onosproject.onos-pipelines-fabric-impl/2.2.3
>
>         2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
>         FabricPipeconfLoader             | 236 -
>         org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to
>         build pipeconf at p4c-out/fabric-mlnx/spectrum/default/
>         because file is missing: spectrum.bin
>
>         2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.fabric-bng
>         (fingerprint=9e:af:91:d4:8c:8a:bc:98)
>
>         2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.fabric-full
>         (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
>
>         2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.fabric-int
>         (fingerprint=01:39:87:22:c5:c4:e6:0a)
>
>         2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.fabric-spgw-int
>         (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
>
>         2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.fabric-spgw
>         (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
>
>         2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>         PiPipeconfManager                | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>         registered: org.onosproject.pipelines.fabric
>         (fingerprint=33:a1:c2:36:82:04:f5:0c)
>
>         2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 |
>         FabricPipeconfLoader             | 236 -
>         org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
>         2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 |
>         FabricPipeconfLoader             | 236 -
>         org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
>         2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Done.
>
>         2020-07-13T22:10:58,263 | INFO  |
>         onos-store-app-app-activation |
>         ApplicationManager               | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | Application
>         org.onosproject.pipelines.fabric has been activated
>
>         2020-07-13T22:10:58,266 | INFO  |
>         onos-store-app-app-activation |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Adding features:
>         fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
>
>         2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>
>         2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |   Region: root
>
>         2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>
>         2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
>         2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>
>         2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
>         2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>
>         2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 |
>         org.opencord.fabric-tofino/1.1.1.SNAPSHOT
>
>         2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 |
>         PipeconfLoader                   | 237 -
>         org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
>
>         2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 |
>         FeaturesServiceImpl              | 11 -
>         org.apache.karaf.features.core - 4.2.8 | Done.
>
>         2020-07-13T22:10:58,999 | INFO  |
>         onos-store-app-app-activation |
>         ApplicationManager               | 193 -
>         org.onosproject.onos-core-net - 2.2.3 | Application
>         org.opencord.fabric-tofino has been activated
>
>         root at ONOS:~/fabric-tofino#
>
>         *From:*David Gengenbach <davidgengenbach at gmx.de>
>         <mailto:davidgengenbach at gmx.de>
>         *Sent:* 13 July 2020 22:42
>         *To:* Lake, David (PG/R - Elec Electronic Eng)
>         <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>; Alireza
>         Ghaffarkhah <aghaffar at google.com>
>         <mailto:aghaffar at google.com>; Brian O'Connor
>         <brian at opennetworking.org> <mailto:brian at opennetworking.org>;
>         Yi Tseng <yi at opennetworking.org>
>         <mailto:yi at opennetworking.org>; Maximilian Pudelko
>         <max at opennetworking.org> <mailto:max at opennetworking.org>
>         *Cc:* stratum-dev at lists.stratumproject.org
>         <mailto:stratum-dev at lists.stratumproject.org>
>         *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>         It seems like you did not install/activate the fabric-tofino
>         library?
>
>         Did you follow the steps in the guide? The "Compile
>         fabric-tofino" section should install the pipeconfs.
>
>         Important: you do NOT have to follow the whole guide of
>         fabric-tofino. They provide compiled switch binaries. If you
>         follow their guide, these are automatically cleaned (=
>         deleted) before they are compiled again - so all subsequent
>         commands will not work unless you are able to compile them
>         yourself (which is only needed if you want to change the
>         underlying P4 program, I guess). So I would suggest starting
>         with a fresh copy of fabric-tofino in case you changed to much.
>
>         For troubleshooting: as described in the guide, you can
>         connect to ONOS via the CLI and look for the pipeconf by
>         executing:
>         `onos onos at localhost` (or wherever ONOS is hosted)
>
>
>
>         https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino
>         <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=Icxw4PbbRnKxnXbyoVvZp1fqz5X%2F2fpn2fx8Vw9lnJM%3D&reserved=0>
>
>         On 7/13/20 11:20 PM, David Lake wrote:
>
>             OK – I followed the instructions from David Gengenbach
>             (thank you) and I now have a Stratum agent running on the
>             switch.
>
>             I then built the pipeline in ONOS and loaded it:
>
>             2020-07-13T22:10:58,999 | INFO  |
>             onos-store-app-app-activation |
>             ApplicationManager               | 193 -
>             org.onosproject.onos-core-net - 2.2.3 | Application
>             org.opencord.fabric-tofino has been activated
>
>             root at ONOS:~/fabric-tofino#
>
>             But when I add the netfcfg, I see this message in the ONOS
>             log:
>
>             2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       |
>             DeviceTaskExecutor               | 225 -
>             org.onosproject.onos-providers-general-device - 2.2.3 |
>             Unable to complete task CONNECTION_SETUP for
>             device:my-tofino-switch: pipeconf
>             org.opencord.fabric.tofino.montara_sde_9_0_0 not registered
>
>             My switch is a Montara but I don’t see where the pipeconf
>             is built?
>
>             On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I
>             have not built anything with the bf-sde.
>
>             Do I need to run p4studio_build in the BF-SDE first?
>
>             Thanks
>
>
>             David
>
>             *From:*Alireza Ghaffarkhah <aghaffar at google.com>
>             <mailto:aghaffar at google.com>
>             *Sent:* 13 July 2020 07:01
>             *To:* David Gengenbach <davidgengenbach at gmx.de>
>             <mailto:davidgengenbach at gmx.de>; Brian O'Connor
>             <brian at opennetworking.org>
>             <mailto:brian at opennetworking.org>; Yi Tseng
>             <yi at opennetworking.org> <mailto:yi at opennetworking.org>;
>             Maximilian Pudelko <max at opennetworking.org>
>             <mailto:max at opennetworking.org>
>             *Cc:* Lake, David (PG/R - Elec Electronic Eng)
>             <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>;
>             stratum-dev at lists.stratumproject.org
>             <mailto:stratum-dev at lists.stratumproject.org>
>             *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>             +Brian O'Connor <mailto:brian at opennetworking.org> +Yi
>             Tseng <mailto:yi at opennetworking.org> +Maximilian Pudelko
>             <mailto:max at opennetworking.org> in case they can provide
>             more input.
>
>             On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via
>             stratum-dev <stratum-dev at lists.stratumproject.org
>             <mailto:stratum-dev at lists.stratumproject.org>> wrote:
>
>                 I created a setup guide for this exact use-case. The
>                 PR for it has not
>                 been merged but should work:
>                 https://github.com/stratum/stratum/pull/280
>                 <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=ZSVE44LwncoyEu6%2BU1pcDa9dDh4bjWPSSHZxnd4Hl24%3D&reserved=0>
>
>                 _______________________________________________
>                 stratum-dev mailing list
>                 stratum-dev at lists.stratumproject.org
>                 <mailto:stratum-dev at lists.stratumproject.org>
>                 https://lists.stratumproject.org/listinfo/stratum-dev
>                 <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=jcoe4FaLpCCHSwMbCdNrBEpR9Kz0EoMvlaU6CE03gXg%3D&reserved=0>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200714/ca7836d3/attachment-0001.html>

From d.lake at surrey.ac.uk  Mon Jul 13 22:23:38 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Mon, 13 Jul 2020 22:23:38 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <30d99d32-caba-3e0f-d1d8-66284dc3c77b@gmx.de>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <30d99d32-caba-3e0f-d1d8-66284dc3c77b@gmx.de>
Message-ID: <VI1PR06MB521433B85415BCA662351E7CB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>

Again, perfect!  Thank you

David

From: David Gengenbach <davidgengenbach at gmx.de>
Sent: 13 July 2020 23:23
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum


As far as I know, you would use gNMI (https://github.com/openconfig/gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopenconfig%2Fgnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C29ad5786708c4d96b0fd08d8277b46f0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302757721801041&sdata=Lw1w8Nmg5LDAnE4B0ea%2FrFwpg2R0YxjaP6BOFdxr3QE%3D&reserved=0>) for this - which is also bundled/started with Stratum.
Here is a really helpful tutorial for Stratum which also covers gNMI: https://github.com/stratum/tutorial/tree/master/basic#gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Ftutorial%2Ftree%2Fmaster%2Fbasic%23gnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C29ad5786708c4d96b0fd08d8277b46f0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302757721801041&sdata=3UUOZlKb8WzMb6NsmHxMw4uXMoIcfqajB7DMCvwOztA%3D&reserved=0>

The port config command would look something like: ./gnmi-cli.sh set /interfaces/interface[name=s1-eth1]/config/enabled --bool-val true

(Using the gnmi-cli from the tutorial.)
On 7/14/20 12:15 AM, David Lake wrote:
The guide was VERY useful!

I now need to understand how to configure the ports in the switch – I want to build a very simple SPGW use-case with a single switch.

How do I build the switch configuration?  Is this is in the JSON file?

Thanks

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 23:12
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Perfect!
Interestingly, I think I had the exact same problems you encountered :D That's why I wrote this guide - a lot of pitfalls. Restarting and starting with a clean slate, miraculously, solved a lot of my problems.
On 7/14/20 12:01 AM, David Lake wrote:
AHA!   Perfect – thank you.   It seems that the fabric-tofino was not empty.   I deleted and recompiled and now I see my switch!

Thank you so much for your help.

Kind regards

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:50
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Unfortunately, I do not have access to the Tofino switch now, so I can not confirm your logs.
Can you please also provide the output of running "pipeconf | grep tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).

Did you start with an empty fabric-tofino repo and executed the commands?

Especially this log entry is strange (but again, I can not verify whether this is normal):
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin


On 7/13/20 11:46 PM, David Lake wrote:
I did follow this step and was able to register the application and pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?

David

root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
*** Installing and activating pipeconf app in ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -HContent-Type:ap                                                                                                                                                             plication/octet-stream \
        'http://localhost:8181/onos/v1/applications?activate=true' \
        --data-binary @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN                                                                                                                                                             APSHOT.oar
{"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego                                                                                                                                                             ry":"Pipeline","description":"Provides pipeconfs based on fabric.","readme":"Pro                                                                                                                                                             vides pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n            To                                                                                                                                                             fino-based devices.","origin":"http://www.opencord.org"<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C29ad5786708c4d96b0fd08d8277b46f0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302757721801041&sdata=XQpjfq0mlh2F7HdB5Fx12q6s1Ot%2BEJ%2BPfgNUJHYdVyQ%3D&reserved=0>,"url":"http://www.openco<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C29ad5786708c4d96b0fd08d8277b46f0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302757721810995&sdata=chfgcSv6VQl5hPMYI6JSeBXb1LUiAl7TQP4rJAIvLTs%3D&reserved=0>                                                                                                                                                             rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur                                                                                                                                                             es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps                                                                                                                                                             ":["org.onosproject.pipelines.fabric"]}
root at ONOS:~/fabric-tofino#
root at ONOS:~/fabric-tofino#





root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int (fingerprint=cf:0e:30:28:dc:5f:97:4c)
2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 | PipeconfLoader                   | 237 - org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:42
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino" section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino. They provide compiled switch binaries. If you follow their guide, these are automatically cleaned (= deleted) before they are compiled again - so all subsequent commands will not work unless you are able to compile them yourself (which is only needed if you want to change the underlying P4 program, I guess). So I would suggest starting with a fresh copy of fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)





https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C29ad5786708c4d96b0fd08d8277b46f0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302757721810995&sdata=pHQ14WNnWHGSrEcSTagk6YuPpZrH7efog8Th1HvAT9k%3D&reserved=0>
On 7/13/20 11:20 PM, David Lake wrote:
OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C29ad5786708c4d96b0fd08d8277b46f0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302757721820949&sdata=%2F5%2B6xJhoqhl%2FSX8r6f8Ox41%2ByzL2bHowQr9DpIYAb%2B8%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C29ad5786708c4d96b0fd08d8277b46f0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302757721820949&sdata=Ai8qiLFZ%2BgfF0ReaPLCcKbdKDWwZ8xToxUqAYUyVTlI%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/c11baaed/attachment-0001.html>

From davidgengenbach at gmx.de  Mon Jul 13 22:25:00 2020
From: davidgengenbach at gmx.de (David Gengenbach)
Date: Tue, 14 Jul 2020 00:25:00 +0200
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <010101734a4614c5-15b131f0-baaf-4456-8936-447043f850a9-000000@us-west-2.amazonses.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <010101734a4614c5-15b131f0-baaf-4456-8936-447043f850a9-000000@us-west-2.amazonses.com>
Message-ID: <ff28c38c-ced6-98e1-982f-339d1fee59ea@gmx.de>

Ah, I forgot that you use ONOS - in that case, you have to look into the
way ONOS is handling/configuring ports (like
https://wiki.onosproject.org/display/ONOS/Interfaces+configuration).

Basically, you have to adapt your netcfg (or the one you used from the
fabric-tofino repo).

You would not talk to gNMI directly since it might lead to inconsistencies.

On 7/14/20 12:22 AM, David Gengenbach via stratum-dev wrote:
>
> As far as I know, you would use gNMI
> (https://github.com/openconfig/gnmi) for this - which is also
> bundled/started with Stratum.
> Here is a really helpful tutorial for Stratum which also covers gNMI:
> https://github.com/stratum/tutorial/tree/master/basic#gnmi
>
> The port config command would look something like: ./gnmi-cli.sh set
> /interfaces/interface[name=s1-eth1]/config/enabled --bool-val true
>
> (Using the gnmi-cli from the tutorial.)
>
> On 7/14/20 12:15 AM, David Lake wrote:
>>
>> The guide was VERY useful!
>>
>>
>> I now need to understand how to configure the ports in the switch – I
>> want to build a very simple SPGW use-case with a single switch.
>>
>> How do I build the switch configuration?  Is this is in the JSON file?
>>
>> Thanks
>>
>> David
>>
>> *From:*David Gengenbach <davidgengenbach at gmx.de>
>> *Sent:* 13 July 2020 23:12
>> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>;
>> Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor
>> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>;
>> Maximilian Pudelko <max at opennetworking.org>
>> *Cc:* stratum-dev at lists.stratumproject.org
>> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>>
>> Perfect!
>> Interestingly, I think I had the exact same problems you encountered
>> :D That's why I wrote this guide - a lot of pitfalls. Restarting and
>> starting with a clean slate, miraculously, solved a lot of my problems.
>>
>> On 7/14/20 12:01 AM, David Lake wrote:
>>
>>     AHA!   Perfect – thank you.   It seems that the fabric-tofino was
>>     not empty.   I deleted and recompiled and now I see my switch!
>>
>>     Thank you so much for your help.
>>
>>
>>     Kind regards
>>
>>     David
>>
>>     *From:*David Gengenbach <davidgengenbach at gmx.de>
>>     <mailto:davidgengenbach at gmx.de>
>>     *Sent:* 13 July 2020 22:50
>>     *To:* Lake, David (PG/R - Elec Electronic Eng)
>>     <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>; Alireza
>>     Ghaffarkhah <aghaffar at google.com> <mailto:aghaffar at google.com>;
>>     Brian O'Connor <brian at opennetworking.org>
>>     <mailto:brian at opennetworking.org>; Yi Tseng
>>     <yi at opennetworking.org> <mailto:yi at opennetworking.org>;
>>     Maximilian Pudelko <max at opennetworking.org>
>>     <mailto:max at opennetworking.org>
>>     *Cc:* stratum-dev at lists.stratumproject.org
>>     <mailto:stratum-dev at lists.stratumproject.org>
>>     *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>>
>>     Unfortunately, I do not have access to the Tofino switch now, so
>>     I can not confirm your logs.
>>     Can you please also provide the output of running "pipeconf |
>>     grep tofino" in the ONOS CLI (onos onos at localhost    # Password
>>     is rocks).
>>
>>     Did you start with an empty fabric-tofino repo and executed the
>>     commands?
>>
>>     Especially this log entry is strange (but again, I can not verify
>>     whether this is normal):
>>     2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
>>     FabricPipeconfLoader             | 236 -
>>     org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to
>>     build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because
>>     file is missing: spectrum.bin
>>
>>     On 7/13/20 11:46 PM, David Lake wrote:
>>
>>         I did follow this step and was able to register the
>>         application and pipeline but I don’t see
>>         “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?
>>
>>         David
>>
>>         root at ONOS:~/fabric-tofino# make pipeconf-install
>>         ONOS_HOST=localhost
>>
>>         *** Installing and activating pipeconf app in ONOS at
>>         localhost...
>>
>>         curl --fail -sSL --user onos:rocks --noproxy localhost -X
>>         POST -HContent-Type:ap       plication/octet-stream \
>>
>>                
>>         'http://localhost:8181/onos/v1/applications?activate=true' \
>>
>>         --data-binary
>>         @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN
>>                                                                                          APSHOT.oar
>>
>>         {"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego
>>                                                                                  ry":"Pipeline","description":"Provides
>>         pipeconfs based on fabric.","readme":"Pro
>>                                                               vides
>>         pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n
>>         To                                    fino-based
>>         devices.","origin":"http://www.opencord.org"
>>         <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234825308&sdata=AL7QWHARhScQuKn4M2F2hH9U3LnYa5jAQaVdkx2xPk0%3D&reserved=0>,"url":"http://www.openco
>>         <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=4%2BsuFYwNtfNqfKI9iPyn646TVZvmbjFIicgDC5sXtSw%3D&reserved=0>
>>                         rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur
>>         es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps
>>         ":["org.onosproject.pipelines.fabric"]}
>>
>>         root at ONOS:~/fabric-tofino#
>>
>>         root at ONOS:~/fabric-tofino#
>>
>>         root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
>>
>>         2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>>
>>         2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |   Region: root
>>
>>         2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>>
>>         2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>>
>>         2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-pipelines-basic/2.2.3
>>
>>         2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>>
>>         2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>>
>>         2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-pipelines-basic/2.2.3
>>
>>         2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>>
>>         2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
>>
>>         2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         org.onosproject.onos-pipelines-basic/2.2.3
>>
>>         2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.basic
>>         (fingerprint=1f:03:c5:4d:32:19:e4:f4)
>>
>>         2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.int
>>         (fingerprint=cf:0e:30:28:dc:5f:97:4c)
>>
>>         2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Done.
>>
>>         2020-07-13T22:10:56,399 | INFO  |
>>         onos-store-app-app-activation |
>>         ApplicationManager               | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | Application
>>         org.onosproject.pipelines.basic has been activated
>>
>>         2020-07-13T22:10:56,402 | INFO  |
>>         onos-store-app-app-activation |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Adding features:
>>         onos-pipelines-fabric/[2.2.3,2.2.3]
>>
>>         2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>>
>>         2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |   Region: root
>>
>>         2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>>
>>         2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>>
>>         2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>>
>>         2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>>
>>         2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>>
>>         2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>>
>>         2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>>
>>         2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         org.onosproject.onos-pipelines-fabric-api/2.2.3
>>
>>         2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         org.onosproject.onos-pipelines-fabric-impl/2.2.3
>>
>>         2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
>>         FabricPipeconfLoader             | 236 -
>>         org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable
>>         to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/
>>         because file is missing: spectrum.bin
>>
>>         2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.fabric-bng
>>         (fingerprint=9e:af:91:d4:8c:8a:bc:98)
>>
>>         2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.fabric-full
>>         (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
>>
>>         2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.fabric-int
>>         (fingerprint=01:39:87:22:c5:c4:e6:0a)
>>
>>         2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.fabric-spgw-int
>>         (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
>>
>>         2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.fabric-spgw
>>         (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
>>
>>         2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
>>         PiPipeconfManager                | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | New pipeconf
>>         registered: org.onosproject.pipelines.fabric
>>         (fingerprint=33:a1:c2:36:82:04:f5:0c)
>>
>>         2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 |
>>         FabricPipeconfLoader             | 236 -
>>         org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>>
>>         2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 |
>>         FabricPipeconfLoader             | 236 -
>>         org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>>
>>         2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Done.
>>
>>         2020-07-13T22:10:58,263 | INFO  |
>>         onos-store-app-app-activation |
>>         ApplicationManager               | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | Application
>>         org.onosproject.pipelines.fabric has been activated
>>
>>         2020-07-13T22:10:58,266 | INFO  |
>>         onos-store-app-app-activation |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Adding features:
>>         fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
>>
>>         2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Changes to perform:
>>
>>         2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |   Region: root
>>
>>         2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
>>
>>         2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>>
>>         2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Installing bundles:
>>
>>         2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>>
>>         2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Starting bundles:
>>
>>         2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 |
>>         org.opencord.fabric-tofino/1.1.1.SNAPSHOT
>>
>>         2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 |
>>         PipeconfLoader                   | 237 -
>>         org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
>>
>>         2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 |
>>         FeaturesServiceImpl              | 11 -
>>         org.apache.karaf.features.core - 4.2.8 | Done.
>>
>>         2020-07-13T22:10:58,999 | INFO  |
>>         onos-store-app-app-activation |
>>         ApplicationManager               | 193 -
>>         org.onosproject.onos-core-net - 2.2.3 | Application
>>         org.opencord.fabric-tofino has been activated
>>
>>         root at ONOS:~/fabric-tofino#
>>
>>         *From:*David Gengenbach <davidgengenbach at gmx.de>
>>         <mailto:davidgengenbach at gmx.de>
>>         *Sent:* 13 July 2020 22:42
>>         *To:* Lake, David (PG/R - Elec Electronic Eng)
>>         <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>; Alireza
>>         Ghaffarkhah <aghaffar at google.com>
>>         <mailto:aghaffar at google.com>; Brian O'Connor
>>         <brian at opennetworking.org> <mailto:brian at opennetworking.org>;
>>         Yi Tseng <yi at opennetworking.org>
>>         <mailto:yi at opennetworking.org>; Maximilian Pudelko
>>         <max at opennetworking.org> <mailto:max at opennetworking.org>
>>         *Cc:* stratum-dev at lists.stratumproject.org
>>         <mailto:stratum-dev at lists.stratumproject.org>
>>         *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>>
>>         It seems like you did not install/activate the fabric-tofino
>>         library?
>>
>>         Did you follow the steps in the guide? The "Compile
>>         fabric-tofino" section should install the pipeconfs.
>>
>>         Important: you do NOT have to follow the whole guide of
>>         fabric-tofino. They provide compiled switch binaries. If you
>>         follow their guide, these are automatically cleaned (=
>>         deleted) before they are compiled again - so all subsequent
>>         commands will not work unless you are able to compile them
>>         yourself (which is only needed if you want to change the
>>         underlying P4 program, I guess). So I would suggest starting
>>         with a fresh copy of fabric-tofino in case you changed to much.
>>
>>         For troubleshooting: as described in the guide, you can
>>         connect to ONOS via the CLI and look for the pipeconf by
>>         executing:
>>         `onos onos at localhost` (or wherever ONOS is hosted)
>>
>>
>>
>>         https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino
>>         <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=Icxw4PbbRnKxnXbyoVvZp1fqz5X%2F2fpn2fx8Vw9lnJM%3D&reserved=0>
>>
>>         On 7/13/20 11:20 PM, David Lake wrote:
>>
>>             OK – I followed the instructions from David Gengenbach
>>             (thank you) and I now have a Stratum agent running on the
>>             switch.
>>
>>             I then built the pipeline in ONOS and loaded it:
>>
>>             2020-07-13T22:10:58,999 | INFO  |
>>             onos-store-app-app-activation |
>>             ApplicationManager               | 193 -
>>             org.onosproject.onos-core-net - 2.2.3 | Application
>>             org.opencord.fabric-tofino has been activated
>>
>>             root at ONOS:~/fabric-tofino#
>>
>>             But when I add the netfcfg, I see this message in the
>>             ONOS log:
>>
>>             2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       |
>>             DeviceTaskExecutor               | 225 -
>>             org.onosproject.onos-providers-general-device - 2.2.3 |
>>             Unable to complete task CONNECTION_SETUP for
>>             device:my-tofino-switch: pipeconf
>>             org.opencord.fabric.tofino.montara_sde_9_0_0 not registered
>>
>>             My switch is a Montara but I don’t see where the pipeconf
>>             is built?
>>
>>             On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I
>>             have not built anything with the bf-sde.
>>
>>             Do I need to run p4studio_build in the BF-SDE first?
>>
>>             Thanks
>>
>>
>>             David
>>
>>             *From:*Alireza Ghaffarkhah <aghaffar at google.com>
>>             <mailto:aghaffar at google.com>
>>             *Sent:* 13 July 2020 07:01
>>             *To:* David Gengenbach <davidgengenbach at gmx.de>
>>             <mailto:davidgengenbach at gmx.de>; Brian O'Connor
>>             <brian at opennetworking.org>
>>             <mailto:brian at opennetworking.org>; Yi Tseng
>>             <yi at opennetworking.org> <mailto:yi at opennetworking.org>;
>>             Maximilian Pudelko <max at opennetworking.org>
>>             <mailto:max at opennetworking.org>
>>             *Cc:* Lake, David (PG/R - Elec Electronic Eng)
>>             <d.lake at surrey.ac.uk> <mailto:d.lake at surrey.ac.uk>;
>>             stratum-dev at lists.stratumproject.org
>>             <mailto:stratum-dev at lists.stratumproject.org>
>>             *Subject:* Re: [stratum-dev] Confused about how to run
>>             Stratum
>>
>>             +Brian O'Connor <mailto:brian at opennetworking.org> +Yi
>>             Tseng <mailto:yi at opennetworking.org> +Maximilian Pudelko
>>             <mailto:max at opennetworking.org> in case they can provide
>>             more input.
>>
>>             On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via
>>             stratum-dev <stratum-dev at lists.stratumproject.org
>>             <mailto:stratum-dev at lists.stratumproject.org>> wrote:
>>
>>                 I created a setup guide for this exact use-case. The
>>                 PR for it has not
>>                 been merged but should work:
>>                 https://github.com/stratum/stratum/pull/280
>>                 <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=ZSVE44LwncoyEu6%2BU1pcDa9dDh4bjWPSSHZxnd4Hl24%3D&reserved=0>
>>
>>                 _______________________________________________
>>                 stratum-dev mailing list
>>                 stratum-dev at lists.stratumproject.org
>>                 <mailto:stratum-dev at lists.stratumproject.org>
>>                 https://lists.stratumproject.org/listinfo/stratum-dev
>>                 <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=jcoe4FaLpCCHSwMbCdNrBEpR9Kz0EoMvlaU6CE03gXg%3D&reserved=0>
>>
>
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200714/913596b2/attachment-0001.html>

From max at opennetworking.org  Mon Jul 13 23:12:36 2020
From: max at opennetworking.org (Maximilian Pudelko)
Date: Mon, 13 Jul 2020 16:12:36 -0700
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <ff28c38c-ced6-98e1-982f-339d1fee59ea@gmx.de>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <010101734a4614c5-15b131f0-baaf-4456-8936-447043f850a9-000000@us-west-2.amazonses.com>
 <ff28c38c-ced6-98e1-982f-339d1fee59ea@gmx.de>
Message-ID: <CAFh9Y_M9fsSH5FsYs1Gm1f76CLQou=YRWLEP5YRRHqbBO9c=vQ@mail.gmail.com>

I have just merged the guide to master. Seems like it already helped
someone :D

Thanks again David for putting in the work!

Max

On Mon, Jul 13, 2020 at 3:25 PM David Gengenbach <davidgengenbach at gmx.de>
wrote:

> Ah, I forgot that you use ONOS - in that case, you have to look into the
> way ONOS is handling/configuring ports (like
> https://wiki.onosproject.org/display/ONOS/Interfaces+configuration).
>
> Basically, you have to adapt your netcfg (or the one you used from the
> fabric-tofino repo).
>
> You would not talk to gNMI directly since it might lead to inconsistencies.
> On 7/14/20 12:22 AM, David Gengenbach via stratum-dev wrote:
>
> As far as I know, you would use gNMI (https://github.com/openconfig/gnmi)
> for this - which is also bundled/started with Stratum.
> Here is a really helpful tutorial for Stratum which also covers gNMI:
> https://github.com/stratum/tutorial/tree/master/basic#gnmi
>
> The port config command would look something like: ./gnmi-cli.sh set
> /interfaces/interface[name=s1-eth1]/config/enabled --bool-val true
>
> (Using the gnmi-cli from the tutorial.)
> On 7/14/20 12:15 AM, David Lake wrote:
>
> The guide was VERY useful!
>
>
> I now need to understand how to configure the ports in the switch – I want
> to build a very simple SPGW use-case with a single switch.
>
>
>
> How do I build the switch configuration?  Is this is in the JSON file?
>
>
>
> Thanks
>
>
>
> David
>
>
>
> *From:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 23:12
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>
> <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>
> <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
> <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> Perfect!
> Interestingly, I think I had the exact same problems you encountered :D
> That's why I wrote this guide - a lot of pitfalls. Restarting and starting
> with a clean slate, miraculously, solved a lot of my problems.
>
> On 7/14/20 12:01 AM, David Lake wrote:
>
> AHA!   Perfect – thank you.   It seems that the fabric-tofino was not
> empty.   I deleted and recompiled and now I see my switch!
>
>
>
> Thank you so much for your help.
>
>
> Kind regards
>
>
>
> David
>
>
>
> *From:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 22:50
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>
> <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>
> <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
> <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> Unfortunately, I do not have access to the Tofino switch now, so I can not
> confirm your logs.
> Can you please also provide the output of running "pipeconf | grep tofino"
> in the ONOS CLI (onos onos at localhost    # Password is rocks).
>
> Did you start with an empty fabric-tofino repo and executed the commands?
>
> Especially this log entry is strange (but again, I can not verify whether
> this is normal):
> 2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build
> pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing:
> spectrum.bin
>
>
>
> On 7/13/20 11:46 PM, David Lake wrote:
>
> I did follow this step and was able to register the application and
> pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0”
> anywhere?
>
>
>
> David
>
>
>
> root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
>
> *** Installing and activating pipeconf app in ONOS at localhost...
>
> curl --fail -sSL --user onos:rocks --noproxy localhost -X POST
> -HContent-Type:ap
>       plication/octet-stream \
>
>         'http://localhost:8181/onos/v1/applications?activate=true' \
>
>         --data-binary
> @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN
>                                                                                  APSHOT.oar
>
> {"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego
>                                                                          ry":"Pipeline","description":"Provides
> pipeconfs based on
> fabric.","readme":"Pro
>                                                       vides pipeconfs based
> on fabric.p4 to use Trellis with Barefoot\\n
> To
>                                    fino-based devices.","origin":
> "http://www.opencord.org"
> <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234825308&sdata=AL7QWHARhScQuKn4M2F2hH9U3LnYa5jAQaVdkx2xPk0%3D&reserved=0>
> ,"url":"http://www.openco
> <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=4%2BsuFYwNtfNqfKI9iPyn646TVZvmbjFIicgDC5sXtSw%3D&reserved=0>
>                 rd.org","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur
> es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps
> ":["org.onosproject.pipelines.fabric"]}
>
> root at ONOS:~/fabric-tofino#
>
> root at ONOS:~/fabric-tofino#
>
>
>
>
>
>
>
>
>
>
>
> root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
>
> 2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   Region: root
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager
>                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf
> registered: org.onosproject.pipelines.basic
> (fingerprint=1f:03:c5:4d:32:19:e4:f4)
>
> 2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int
> (fingerprint=cf:0e:30:28:dc:5f:97:4c)
>
> 2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Done.
>
> 2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.onosproject.pipelines.basic has been activated
>
> 2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
>
> 2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   Region: root
>
> 2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build
> pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing:
> spectrum.bin
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng
> (fingerprint=9e:af:91:d4:8c:8a:bc:98)
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full
> (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int
> (fingerprint=01:39:87:22:c5:c4:e6:0a)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int
> (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw
> (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric
> (fingerprint=33:a1:c2:36:82:04:f5:0c)
>
> 2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
> 2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
> 2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Done.
>
> 2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
>
> 2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
>
> 2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   Region: root
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
> 2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
> 2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
>
> 2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 |
> PipeconfLoader                   | 237 - org.opencord.fabric-tofino -
> 1.1.1.SNAPSHOT | Started
>
> 2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Done.
>
> 2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.opencord.fabric-tofino has been activated
>
> root at ONOS:~/fabric-tofino#
>
>
>
> *From:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 22:42
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>
> <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>
> <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
> <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> It seems like you did not install/activate the fabric-tofino library?
>
> Did you follow the steps in the guide? The "Compile fabric-tofino" section
> should install the pipeconfs.
>
> Important: you do NOT have to follow the whole guide of fabric-tofino.
> They provide compiled switch binaries. If you follow their guide, these are
> automatically cleaned (= deleted) before they are compiled again - so all
> subsequent commands will not work unless you are able to compile them
> yourself (which is only needed if you want to change the underlying P4
> program, I guess). So I would suggest starting with a fresh copy of
> fabric-tofino in case you changed to much.
>
> For troubleshooting: as described in the guide, you can connect to ONOS
> via the CLI and look for the pipeconf by executing:
> `onos onos at localhost` (or wherever ONOS is hosted)
>
>
>
>
> https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234835274&sdata=Icxw4PbbRnKxnXbyoVvZp1fqz5X%2F2fpn2fx8Vw9lnJM%3D&reserved=0>
>
> On 7/13/20 11:20 PM, David Lake wrote:
>
> OK – I followed the instructions from David Gengenbach (thank you) and I
> now have a Stratum agent running on the switch.
>
>
>
> I then built the pipeline in ONOS and loaded it:
>
>
>
> 2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.opencord.fabric-tofino has been activated
>
> root at ONOS:~/fabric-tofino#
>
>
>
> But when I add the netfcfg, I see this message in the ONOS log:
>
>
>
> 2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       |
> DeviceTaskExecutor               | 225 -
> org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete
> task CONNECTION_SETUP for device:my-tofino-switch: pipeconf
> org.opencord.fabric.tofino.montara_sde_9_0_0 not registered
>
>
>
>
>
> My switch is a Montara but I don’t see where the pipeconf is built?
>
>
>
> On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built
> anything with the bf-sde.
>
>
>
> Do I need to run p4studio_build in the BF-SDE first?
>
>
>
> Thanks
>
>
> David
>
>
>
> *From:* Alireza Ghaffarkhah <aghaffar at google.com> <aghaffar at google.com>
> *Sent:* 13 July 2020 07:01
> *To:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>;
> Brian O'Connor <brian at opennetworking.org> <brian at opennetworking.org>; Yi
> Tseng <yi at opennetworking.org> <yi at opennetworking.org>; Maximilian Pudelko
> <max at opennetworking.org> <max at opennetworking.org>
> *Cc:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> +Brian O'Connor <brian at opennetworking.org> +Yi Tseng
> <yi at opennetworking.org> +Maximilian Pudelko <max at opennetworking.org> in
> case they can provide more input.
>
>
>
> On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <
> stratum-dev at lists.stratumproject.org> wrote:
>
> I created a setup guide for this exact use-case. The PR for it has not
> been merged but should work: https://github.com/stratum/stratum/pull/280
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=ZSVE44LwncoyEu6%2BU1pcDa9dDh4bjWPSSHZxnd4Hl24%3D&reserved=0>
>
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C415c3626f18942cfc6ec08d82779c45b%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C1%7C637302751234845228&sdata=jcoe4FaLpCCHSwMbCdNrBEpR9Kz0EoMvlaU6CE03gXg%3D&reserved=0>
>
>
> _______________________________________________
> stratum-dev mailing liststratum-dev at lists.stratumproject.orghttps://lists.stratumproject.org/listinfo/stratum-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200713/c7ac6bbc/attachment-0001.html>

From d.lake at surrey.ac.uk  Tue Jul 14 08:45:50 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Tue, 14 Jul 2020 08:45:50 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <CAFh9Y_M9fsSH5FsYs1Gm1f76CLQou=YRWLEP5YRRHqbBO9c=vQ@mail.gmail.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <010101734a4614c5-15b131f0-baaf-4456-8936-447043f850a9-000000@us-west-2.amazonses.com>
 <ff28c38c-ced6-98e1-982f-339d1fee59ea@gmx.de>
 <CAFh9Y_M9fsSH5FsYs1Gm1f76CLQou=YRWLEP5YRRHqbBO9c=vQ@mail.gmail.com>
Message-ID: <VI1PR06MB52149FCAB9684C1DE1F833D0B5610@VI1PR06MB5214.eurprd06.prod.outlook.com>

It was very, very helpful.

What I am now trying to do is recreate the spgw use-case.

Can anyone point me to information on that please?  I need to understand how to inject the TEID into ONOS.

Thanks

David
From: Maximilian Pudelko <max at opennetworking.org>
Sent: 14 July 2020 00:13
To: David Gengenbach <davidgengenbach at gmx.de>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum

I have just merged the guide to master. Seems like it already helped someone :D
Thanks again David for putting in the work!
Max

On Mon, Jul 13, 2020 at 3:25 PM David Gengenbach <davidgengenbach at gmx.de<mailto:davidgengenbach at gmx.de>> wrote:

Ah, I forgot that you use ONOS - in that case, you have to look into the way ONOS is handling/configuring ports (like https://wiki.onosproject.org/display/ONOS/Interfaces+configuration<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.onosproject.org%2Fdisplay%2FONOS%2FInterfaces%2Bconfiguration&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887920332&sdata=QxFmT%2F6A0SNBqebHKV3Ihf0iRuu8j%2FOjuK5z70LpUw8%3D&reserved=0>).

Basically, you have to adapt your netcfg (or the one you used from the fabric-tofino repo).

You would not talk to gNMI directly since it might lead to inconsistencies.
On 7/14/20 12:22 AM, David Gengenbach via stratum-dev wrote:

As far as I know, you would use gNMI (https://github.com/openconfig/gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopenconfig%2Fgnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887930317&sdata=nqLys6NYsif7miYq%2FEVEsjYn1F%2BQgXaNdz%2BFl6sWW50%3D&reserved=0>) for this - which is also bundled/started with Stratum.
Here is a really helpful tutorial for Stratum which also covers gNMI: https://github.com/stratum/tutorial/tree/master/basic#gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Ftutorial%2Ftree%2Fmaster%2Fbasic%23gnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887930317&sdata=YCIkG76fUi2uW8P6HQ1hfX5woKTlWTJUNlsIvbcf78I%3D&reserved=0>

The port config command would look something like: ./gnmi-cli.sh set /interfaces/interface[name=s1-eth1]/config/enabled --bool-val true

(Using the gnmi-cli from the tutorial.)
On 7/14/20 12:15 AM, David Lake wrote:
The guide was VERY useful!

I now need to understand how to configure the ports in the switch – I want to build a very simple SPGW use-case with a single switch.

How do I build the switch configuration?  Is this is in the JSON file?

Thanks

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 23:12
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Perfect!
Interestingly, I think I had the exact same problems you encountered :D That's why I wrote this guide - a lot of pitfalls. Restarting and starting with a clean slate, miraculously, solved a lot of my problems.
On 7/14/20 12:01 AM, David Lake wrote:
AHA!   Perfect – thank you.   It seems that the fabric-tofino was not empty.   I deleted and recompiled and now I see my switch!

Thank you so much for your help.

Kind regards

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:50
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Unfortunately, I do not have access to the Tofino switch now, so I can not confirm your logs.
Can you please also provide the output of running "pipeconf | grep tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).

Did you start with an empty fabric-tofino repo and executed the commands?

Especially this log entry is strange (but again, I can not verify whether this is normal):
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin


On 7/13/20 11:46 PM, David Lake wrote:
I did follow this step and was able to register the application and pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?

David

root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
*** Installing and activating pipeconf app in ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -HContent-Type:ap                                                                                                                                                             plication/octet-stream \
        'http://localhost:8181/onos/v1/applications?activate=true' \
        --data-binary @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN                                                                                                                                                             APSHOT.oar
{"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego                                                                                                                                                             ry":"Pipeline","description":"Provides pipeconfs based on fabric.","readme":"Pro                                                                                                                                                             vides pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n            To                                                                                                                                                             fino-based devices.","origin":"http://www.opencord.org"<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887940318&sdata=gHkysdE5CshNTta1D33uHOFs87XAw1lydPIRFs%2BFR9U%3D&reserved=0>,"url":"http://www.openco<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887940318&sdata=FajaTgy9rOukuze587NWfuovr8S00tTxaGYc9a6zuFE%3D&reserved=0>                                                                                                                                                             rd.org<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Frd.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887950314&sdata=FIs4Vm3FtcHJHyQHyzssqta6VFI%2BD6XPvPqwbkJ8DL0%3D&reserved=0>","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur                                                                                                                                                             es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps                                                                                                                                                             ":["org.onosproject.pipelines.fabric"]}
root at ONOS:~/fabric-tofino#
root at ONOS:~/fabric-tofino#





root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Forg.onosproject.pipelines.int%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887950314&sdata=iRmV6rck1qX83iFb6fMPZU6hRXCv5Ze0mNW7XTvYPVY%3D&reserved=0> (fingerprint=cf:0e:30:28:dc:5f:97:4c)
2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 | PipeconfLoader                   | 237 - org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:42
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino" section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino. They provide compiled switch binaries. If you follow their guide, these are automatically cleaned (= deleted) before they are compiled again - so all subsequent commands will not work unless you are able to compile them yourself (which is only needed if you want to change the underlying P4 program, I guess). So I would suggest starting with a fresh copy of fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)



https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887950314&sdata=SfX5Hv%2BNte4%2B8%2BHR3Njz7VwCoH1ZxAcEyAxBsk%2Bhrb8%3D&reserved=0>
On 7/13/20 11:20 PM, David Lake wrote:
OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887960306&sdata=%2F%2BhQ20zfkZHoznTFMxu35blKfFHgBKebjHMbzWMf5xE%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887960306&sdata=SCkfIxF%2FkYCRgSb3V35YzAzS4zEkcagrc3gw9ldDg48%3D&reserved=0>


_______________________________________________

stratum-dev mailing list

stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>

https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887970302&sdata=b0VqEoj9vnK47xoSUTU0I5FTqCaW%2FxcEeOypB3E%2B1LA%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200714/0ba02fde/attachment-0001.html>

From yi at opennetworking.org  Tue Jul 14 18:47:10 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Tue, 14 Jul 2020 11:47:10 -0700
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <VI1PR06MB52149FCAB9684C1DE1F833D0B5610@VI1PR06MB5214.eurprd06.prod.outlook.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <010101734a4614c5-15b131f0-baaf-4456-8936-447043f850a9-000000@us-west-2.amazonses.com>
 <ff28c38c-ced6-98e1-982f-339d1fee59ea@gmx.de>
 <CAFh9Y_M9fsSH5FsYs1Gm1f76CLQou=YRWLEP5YRRHqbBO9c=vQ@mail.gmail.com>
 <VI1PR06MB52149FCAB9684C1DE1F833D0B5610@VI1PR06MB5214.eurprd06.prod.outlook.com>
Message-ID: <CAOyFVR1fySqYorzNeHjhKkanoqY8j0yFX_xg4eg79WgwSppVjA@mail.gmail.com>

Hi David,

It depends on the P4 program. basically you need to create an ONOS
application to manage tables in spgw pipeline.

You can use Pi* classes (PiAction, PiTableId, ...) to manage
protocol-independent tables/pipelines.

Here is an example:
https://github.com/opennetworkinglab/onos/blob/master/apps/p4-tutorial/mytunnel/src/main/java/org/onosproject/p4tutorial/mytunnel/MyTunnelApp.solution

Yi

On Tue, Jul 14, 2020 at 1:45 AM David Lake <d.lake at surrey.ac.uk> wrote:

> It was very, very helpful.
>
>
>
> What I am now trying to do is recreate the spgw use-case.
>
>
>
> Can anyone point me to information on that please?  I need to understand
> how to inject the TEID into ONOS.
>
>
>
> Thanks
>
>
> David
>
> *From:* Maximilian Pudelko <max at opennetworking.org>
> *Sent:* 14 July 2020 00:13
> *To:* David Gengenbach <davidgengenbach at gmx.de>
> *Cc:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>;
> Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <
> brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>;
> stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> I have just merged the guide to master. Seems like it already helped
> someone :D
>
> Thanks again David for putting in the work!
>
> Max
>
>
>
> On Mon, Jul 13, 2020 at 3:25 PM David Gengenbach <davidgengenbach at gmx.de>
> wrote:
>
> Ah, I forgot that you use ONOS - in that case, you have to look into the
> way ONOS is handling/configuring ports (like
> https://wiki.onosproject.org/display/ONOS/Interfaces+configuration
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.onosproject.org%2Fdisplay%2FONOS%2FInterfaces%2Bconfiguration&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887920332&sdata=QxFmT%2F6A0SNBqebHKV3Ihf0iRuu8j%2FOjuK5z70LpUw8%3D&reserved=0>
> ).
>
> Basically, you have to adapt your netcfg (or the one you used from the
> fabric-tofino repo).
>
> You would not talk to gNMI directly since it might lead to inconsistencies.
>
> On 7/14/20 12:22 AM, David Gengenbach via stratum-dev wrote:
>
> As far as I know, you would use gNMI (https://github.com/openconfig/gnmi
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopenconfig%2Fgnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887930317&sdata=nqLys6NYsif7miYq%2FEVEsjYn1F%2BQgXaNdz%2BFl6sWW50%3D&reserved=0>)
> for this - which is also bundled/started with Stratum.
> Here is a really helpful tutorial for Stratum which also covers gNMI:
> https://github.com/stratum/tutorial/tree/master/basic#gnmi
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Ftutorial%2Ftree%2Fmaster%2Fbasic%23gnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887930317&sdata=YCIkG76fUi2uW8P6HQ1hfX5woKTlWTJUNlsIvbcf78I%3D&reserved=0>
>
> The port config command would look something like: ./gnmi-cli.sh set
> /interfaces/interface[name=s1-eth1]/config/enabled --bool-val true
>
> (Using the gnmi-cli from the tutorial.)
>
> On 7/14/20 12:15 AM, David Lake wrote:
>
> The guide was VERY useful!
>
>
> I now need to understand how to configure the ports in the switch – I want
> to build a very simple SPGW use-case with a single switch.
>
>
>
> How do I build the switch configuration?  Is this is in the JSON file?
>
>
>
> Thanks
>
>
>
> David
>
>
>
> *From:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 23:12
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>
> <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>
> <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
> <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> Perfect!
> Interestingly, I think I had the exact same problems you encountered :D
> That's why I wrote this guide - a lot of pitfalls. Restarting and starting
> with a clean slate, miraculously, solved a lot of my problems.
>
> On 7/14/20 12:01 AM, David Lake wrote:
>
> AHA!   Perfect – thank you.   It seems that the fabric-tofino was not
> empty.   I deleted and recompiled and now I see my switch!
>
>
>
> Thank you so much for your help.
>
>
> Kind regards
>
>
>
> David
>
>
>
> *From:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 22:50
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>
> <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>
> <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
> <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> Unfortunately, I do not have access to the Tofino switch now, so I can not
> confirm your logs.
> Can you please also provide the output of running "pipeconf | grep tofino"
> in the ONOS CLI (onos onos at localhost    # Password is rocks).
>
> Did you start with an empty fabric-tofino repo and executed the commands?
>
> Especially this log entry is strange (but again, I can not verify whether
> this is normal):
> 2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build
> pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing:
> spectrum.bin
>
>
>
> On 7/13/20 11:46 PM, David Lake wrote:
>
> I did follow this step and was able to register the application and
> pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0”
> anywhere?
>
>
>
> David
>
>
>
> root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
>
> *** Installing and activating pipeconf app in ONOS at localhost...
>
> curl --fail -sSL --user onos:rocks --noproxy localhost -X POST
> -HContent-Type:ap
>       plication/octet-stream \
>
>         'http://localhost:8181/onos/v1/applications?activate=true' \
>
>         --data-binary
> @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN
>                                                                                  APSHOT.oar
>
> {"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego
>                                                                          ry":"Pipeline","description":"Provides
> pipeconfs based on
> fabric.","readme":"Pro
>                                                       vides pipeconfs based
> on fabric.p4 to use Trellis with Barefoot\\n
> To
>                                    fino-based devices.","origin":
> "http://www.opencord.org"
> <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887940318&sdata=gHkysdE5CshNTta1D33uHOFs87XAw1lydPIRFs%2BFR9U%3D&reserved=0>
> ,"url":"http://www.openco
> <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887940318&sdata=FajaTgy9rOukuze587NWfuovr8S00tTxaGYc9a6zuFE%3D&reserved=0>
>                 rd.org
> <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Frd.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887950314&sdata=FIs4Vm3FtcHJHyQHyzssqta6VFI%2BD6XPvPqwbkJ8DL0%3D&reserved=0>","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur
> es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps
> ":["org.onosproject.pipelines.fabric"]}
>
> root at ONOS:~/fabric-tofino#
>
> root at ONOS:~/fabric-tofino#
>
>
>
>
>
>
>
>
>
>
>
> root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
>
> 2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   Region: root
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
>
> 2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
>
> 2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager
>                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf
> registered: org.onosproject.pipelines.basic
> (fingerprint=1f:03:c5:4d:32:19:e4:f4)
>
> 2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int
> <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Forg.onosproject.pipelines.int%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887950314&sdata=iRmV6rck1qX83iFb6fMPZU6hRXCv5Ze0mNW7XTvYPVY%3D&reserved=0>
> (fingerprint=cf:0e:30:28:dc:5f:97:4c)
>
> 2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Done.
>
> 2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.onosproject.pipelines.basic has been activated
>
> 2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
>
> 2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   Region: root
>
> 2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
>
> 2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
>
> 2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build
> pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing:
> spectrum.bin
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng
> (fingerprint=9e:af:91:d4:8c:8a:bc:98)
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full
> (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
>
> 2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int
> (fingerprint=01:39:87:22:c5:c4:e6:0a)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int
> (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw
> (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
>
> 2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 |
> PiPipeconfManager                | 193 - org.onosproject.onos-core-net -
> 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric
> (fingerprint=33:a1:c2:36:82:04:f5:0c)
>
> 2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
> 2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 |
> FabricPipeconfLoader             | 236 -
> org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
>
> 2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Done.
>
> 2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
>
> 2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
>
> 2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Changes to perform:
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   Region: root
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |     Bundles to install:
>
> 2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
> 2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Installing bundles:
>
> 2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
>
> 2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Starting bundles:
>
> 2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
>
> 2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 |
> PipeconfLoader                   | 237 - org.opencord.fabric-tofino -
> 1.1.1.SNAPSHOT | Started
>
> 2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 |
> FeaturesServiceImpl              | 11 - org.apache.karaf.features.core -
> 4.2.8 | Done.
>
> 2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.opencord.fabric-tofino has been activated
>
> root at ONOS:~/fabric-tofino#
>
>
>
> *From:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>
> *Sent:* 13 July 2020 22:42
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com>
> <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>
> <brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org>
> <yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org>
> <max at opennetworking.org>
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> It seems like you did not install/activate the fabric-tofino library?
>
> Did you follow the steps in the guide? The "Compile fabric-tofino" section
> should install the pipeconfs.
>
> Important: you do NOT have to follow the whole guide of fabric-tofino.
> They provide compiled switch binaries. If you follow their guide, these are
> automatically cleaned (= deleted) before they are compiled again - so all
> subsequent commands will not work unless you are able to compile them
> yourself (which is only needed if you want to change the underlying P4
> program, I guess). So I would suggest starting with a fresh copy of
> fabric-tofino in case you changed to much.
>
> For troubleshooting: as described in the guide, you can connect to ONOS
> via the CLI and look for the pipeconf by executing:
> `onos onos at localhost` (or wherever ONOS is hosted)
>
>
>
> https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887950314&sdata=SfX5Hv%2BNte4%2B8%2BHR3Njz7VwCoH1ZxAcEyAxBsk%2Bhrb8%3D&reserved=0>
>
> On 7/13/20 11:20 PM, David Lake wrote:
>
> OK – I followed the instructions from David Gengenbach (thank you) and I
> now have a Stratum agent running on the switch.
>
>
>
> I then built the pipeline in ONOS and loaded it:
>
>
>
> 2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation |
> ApplicationManager               | 193 - org.onosproject.onos-core-net -
> 2.2.3 | Application org.opencord.fabric-tofino has been activated
>
> root at ONOS:~/fabric-tofino#
>
>
>
> But when I add the netfcfg, I see this message in the ONOS log:
>
>
>
> 2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       |
> DeviceTaskExecutor               | 225 -
> org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete
> task CONNECTION_SETUP for device:my-tofino-switch: pipeconf
> org.opencord.fabric.tofino.montara_sde_9_0_0 not registered
>
>
>
>
>
> My switch is a Montara but I don’t see where the pipeconf is built?
>
>
>
> On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built
> anything with the bf-sde.
>
>
>
> Do I need to run p4studio_build in the BF-SDE first?
>
>
>
> Thanks
>
>
> David
>
>
>
> *From:* Alireza Ghaffarkhah <aghaffar at google.com> <aghaffar at google.com>
> *Sent:* 13 July 2020 07:01
> *To:* David Gengenbach <davidgengenbach at gmx.de> <davidgengenbach at gmx.de>;
> Brian O'Connor <brian at opennetworking.org> <brian at opennetworking.org>; Yi
> Tseng <yi at opennetworking.org> <yi at opennetworking.org>; Maximilian Pudelko
> <max at opennetworking.org> <max at opennetworking.org>
> *Cc:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> <d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Confused about how to run Stratum
>
>
>
> +Brian O'Connor <brian at opennetworking.org> +Yi Tseng
> <yi at opennetworking.org> +Maximilian Pudelko <max at opennetworking.org> in
> case they can provide more input.
>
>
>
> On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <
> stratum-dev at lists.stratumproject.org> wrote:
>
> I created a setup guide for this exact use-case. The PR for it has not
> been merged but should work: https://github.com/stratum/stratum/pull/280
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887960306&sdata=%2F%2BhQ20zfkZHoznTFMxu35blKfFHgBKebjHMbzWMf5xE%3D&reserved=0>
>
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887960306&sdata=SCkfIxF%2FkYCRgSb3V35YzAzS4zEkcagrc3gw9ldDg48%3D&reserved=0>
>
>
>
> _______________________________________________
>
> stratum-dev mailing list
>
> stratum-dev at lists.stratumproject.org
>
> https://lists.stratumproject.org/listinfo/stratum-dev <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C50652355f2294ec61d7208d827824c28%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637302787887970302&sdata=b0VqEoj9vnK47xoSUTU0I5FTqCaW%2FxcEeOypB3E%2B1LA%3D&reserved=0>
>
>

-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200714/f5d7796a/attachment-0001.html>

From d.lake at surrey.ac.uk  Wed Jul 15 08:46:32 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Wed, 15 Jul 2020 08:46:32 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <CAOyFVR1fySqYorzNeHjhKkanoqY8j0yFX_xg4eg79WgwSppVjA@mail.gmail.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <010101734a4614c5-15b131f0-baaf-4456-8936-447043f850a9-000000@us-west-2.amazonses.com>
 <ff28c38c-ced6-98e1-982f-339d1fee59ea@gmx.de>
 <CAFh9Y_M9fsSH5FsYs1Gm1f76CLQou=YRWLEP5YRRHqbBO9c=vQ@mail.gmail.com>
 <VI1PR06MB52149FCAB9684C1DE1F833D0B5610@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <CAOyFVR1fySqYorzNeHjhKkanoqY8j0yFX_xg4eg79WgwSppVjA@mail.gmail.com>
Message-ID: <VI1PR06MB52143B736E9BBC2FC1B59050B57E0@VI1PR06MB5214.eurprd06.prod.outlook.com>

HI Yi

Thanks!  I’ve been looking at the ONF-Connect 2018 Tutorials – there is an SPGW lab there which I’m going to try to recreate using the Wedge switch.

My understanding now is that to build the physical topology I need to add sections to the JSON file that describes the switch and then use the P4 program to direct the flows.

Unfortunately, the lab only uses BMV2 switches rather than a real switch but I will need to learn!

David

From: Yi Tseng <yi at opennetworking.org>
Sent: 14 July 2020 19:47
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
Cc: Maximilian Pudelko <max at opennetworking.org>; David Gengenbach <davidgengenbach at gmx.de>; Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum

Hi David,

It depends on the P4 program. basically you need to create an ONOS application to manage tables in spgw pipeline.

You can use Pi* classes (PiAction, PiTableId, ...) to manage protocol-independent tables/pipelines.

Here is an example:
https://github.com/opennetworkinglab/onos/blob/master/apps/p4-tutorial/mytunnel/src/main/java/org/onosproject/p4tutorial/mytunnel/MyTunnelApp.solution<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopennetworkinglab%2Fonos%2Fblob%2Fmaster%2Fapps%2Fp4-tutorial%2Fmytunnel%2Fsrc%2Fmain%2Fjava%2Forg%2Fonosproject%2Fp4tutorial%2Fmytunnel%2FMyTunnelApp.solution&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700304550&sdata=8EA6a5IdnFa4wZOQPMgGnPFlFTtAo%2BvrOSqrO7boe5M%3D&reserved=0>

Yi

On Tue, Jul 14, 2020 at 1:45 AM David Lake <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>> wrote:
It was very, very helpful.

What I am now trying to do is recreate the spgw use-case.

Can anyone point me to information on that please?  I need to understand how to inject the TEID into ONOS.

Thanks

David
From: Maximilian Pudelko <max at opennetworking.org<mailto:max at opennetworking.org>>
Sent: 14 July 2020 00:13
To: David Gengenbach <davidgengenbach at gmx.de<mailto:davidgengenbach at gmx.de>>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>>; Alireza Ghaffarkhah <aghaffar at google.com<mailto:aghaffar at google.com>>; Brian O'Connor <brian at opennetworking.org<mailto:brian at opennetworking.org>>; Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

I have just merged the guide to master. Seems like it already helped someone :D
Thanks again David for putting in the work!
Max

On Mon, Jul 13, 2020 at 3:25 PM David Gengenbach <davidgengenbach at gmx.de<mailto:davidgengenbach at gmx.de>> wrote:

Ah, I forgot that you use ONOS - in that case, you have to look into the way ONOS is handling/configuring ports (like https://wiki.onosproject.org/display/ONOS/Interfaces+configuration<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.onosproject.org%2Fdisplay%2FONOS%2FInterfaces%2Bconfiguration&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700314547&sdata=Rb6qBlCyp4J17i7eIE6hSg9Bm79oWKkNi%2BUuByQVNEQ%3D&reserved=0>).

Basically, you have to adapt your netcfg (or the one you used from the fabric-tofino repo).

You would not talk to gNMI directly since it might lead to inconsistencies.
On 7/14/20 12:22 AM, David Gengenbach via stratum-dev wrote:

As far as I know, you would use gNMI (https://github.com/openconfig/gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopenconfig%2Fgnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700314547&sdata=AK5EUoSs2L6s9Op1vK%2F%2BavnuTAZqMtCuJ5yYzLqHKSo%3D&reserved=0>) for this - which is also bundled/started with Stratum.
Here is a really helpful tutorial for Stratum which also covers gNMI: https://github.com/stratum/tutorial/tree/master/basic#gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Ftutorial%2Ftree%2Fmaster%2Fbasic%23gnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700324540&sdata=fEcHkYVA1aFPATmizuH3KAFxTY3VR73n6JQGPfMt%2B00%3D&reserved=0>

The port config command would look something like: ./gnmi-cli.sh set /interfaces/interface[name=s1-eth1]/config/enabled --bool-val true

(Using the gnmi-cli from the tutorial.)
On 7/14/20 12:15 AM, David Lake wrote:
The guide was VERY useful!

I now need to understand how to configure the ports in the switch – I want to build a very simple SPGW use-case with a single switch.

How do I build the switch configuration?  Is this is in the JSON file?

Thanks

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 23:12
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Perfect!
Interestingly, I think I had the exact same problems you encountered :D That's why I wrote this guide - a lot of pitfalls. Restarting and starting with a clean slate, miraculously, solved a lot of my problems.
On 7/14/20 12:01 AM, David Lake wrote:
AHA!   Perfect – thank you.   It seems that the fabric-tofino was not empty.   I deleted and recompiled and now I see my switch!

Thank you so much for your help.

Kind regards

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:50
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Unfortunately, I do not have access to the Tofino switch now, so I can not confirm your logs.
Can you please also provide the output of running "pipeconf | grep tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).

Did you start with an empty fabric-tofino repo and executed the commands?

Especially this log entry is strange (but again, I can not verify whether this is normal):
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin


On 7/13/20 11:46 PM, David Lake wrote:
I did follow this step and was able to register the application and pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?

David

root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
*** Installing and activating pipeconf app in ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -HContent-Type:ap                                                                                                                                                             plication/octet-stream \
        'http://localhost:8181/onos/v1/applications?activate=true' \
        --data-binary @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN                                                                                                                                                             APSHOT.oar
{"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego                                                                                                                                                             ry":"Pipeline","description":"Provides pipeconfs based on fabric.","readme":"Pro                                                                                                                                                             vides pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n            To                                                                                                                                                             fino-based devices.","origin":"http://www.opencord.org"<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700324540&sdata=%2BkNzV2gzB%2Bhc1hZ70t5QvvCJNPI6xP8V7mNRutrySDw%3D&reserved=0>,"url":"http://www.openco<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700334534&sdata=XvYSfYCElAEzsxvnADPuIwR99qpM1RbbsuVQlRRP6KI%3D&reserved=0>                                                                                                                                                             rd.org<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Frd.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700334534&sdata=WTX8EbO07U8DZMHArwGthry%2FpNFC%2F54ltWnATViln%2BY%3D&reserved=0>","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur                                                                                                                                                             es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps                                                                                                                                                             ":["org.onosproject.pipelines.fabric"]}
root at ONOS:~/fabric-tofino#
root at ONOS:~/fabric-tofino#





root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Forg.onosproject.pipelines.int%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700334534&sdata=2dR7Dh%2F3f6U4J18OOVfIT3zs3Zo3Mb2A8cpS7cPIGXo%3D&reserved=0> (fingerprint=cf:0e:30:28:dc:5f:97:4c)
2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 | PipeconfLoader                   | 237 - org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:42
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino" section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino. They provide compiled switch binaries. If you follow their guide, these are automatically cleaned (= deleted) before they are compiled again - so all subsequent commands will not work unless you are able to compile them yourself (which is only needed if you want to change the underlying P4 program, I guess). So I would suggest starting with a fresh copy of fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)


https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700344528&sdata=XQ7F1%2FkJs06%2Bzh91IC%2Bj0kYXVOYYwIraPxmWd3hT9mE%3D&reserved=0>
On 7/13/20 11:20 PM, David Lake wrote:
OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700344528&sdata=kqnQ9VvyQNd5F7jNkKnxK5KeXr8cbh0%2Fa632ve3%2FdJY%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700354522&sdata=0glELd81VXazGqvqW0xBckyh9JefMu%2Fz8sEKxxH5MAk%3D&reserved=0>


_______________________________________________

stratum-dev mailing list

stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>

https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700354522&sdata=0glELd81VXazGqvqW0xBckyh9JefMu%2Fz8sEKxxH5MAk%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700364517&sdata=%2BJD4z2atX1rx7zCsll0ZeQmFJVdkZIQpcaIb%2FYrEyU8%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200715/b4424b56/attachment-0001.html>

From d.lake at surrey.ac.uk  Wed Jul 15 17:07:15 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Wed, 15 Jul 2020 17:07:15 +0000
Subject: [stratum-dev] ONOS P4 Trellis and SPGW
Message-ID: <VI1PR06MB5214DADE0323509F66320756B57E0@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hello

I'm trying to run the ONF Connect 2018 lab for SPGW.

Eventually, I want to run this on a Wedge 100BF-32x switch - I have the Stratum agent running on the switch and ONOS 2.2.3 connected to it.

However, before I do that, I want to run the BMV2 lab - https://github.com/charlesmcchan/onf-connect-18-tutorial/tree/master/lab2

The original VM for the lab is no longer available so I am trying to use the 2019 ngsdn VM.

The ONOS controller is running but when I try to run the Mininet topology using "trellis-gtp.py" I get a message that it cannot connect to the ONOS controller:

"Unable to contact the remote controller at localhost:6633"

How can I change the scenario to work on the ngsdn VM please?

Many thanks

David Lake
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200715/ab62e789/attachment.html>

From carmelo at opennetworking.org  Wed Jul 15 17:44:21 2020
From: carmelo at opennetworking.org (Carmelo Cascone)
Date: Wed, 15 Jul 2020 10:44:21 -0700
Subject: [stratum-dev] ONOS P4 Trellis and SPGW
In-Reply-To: <010101735371e4de-909ec448-0053-4874-bfad-3229e3d2ffa1-000000@us-west-2.amazonses.com>
References: <010101735371e4de-909ec448-0053-4874-bfad-3229e3d2ffa1-000000@us-west-2.amazonses.com>
Message-ID: <9558B0B2-46AD-406F-B718-19C8F478113E@opennetworking.org>

Hi David,

Please check exercise 7 and 8 from the ngsdn-tutorial (“advanced" branch):
https://github.com/opennetworkinglab/ngsdn-tutorial/tree/advanced

These two exercises have been adapted from the older ONF Connect 2018 tutorial which is no longer maintained.

Hope it helps
Carmelo

> On Jul 15, 2020, at 10:07 AM, David Lake via stratum-dev <stratum-dev at lists.stratumproject.org> wrote:
> 
> Hello
>  
> I’m trying to run the ONF Connect 2018 lab for SPGW.
>  
> Eventually, I want to run this on a Wedge 100BF-32x switch – I have the Stratum agent running on the switch and ONOS 2.2.3 connected to it.
>  
> However, before I do that, I want to run the BMV2 lab - https://github.com/charlesmcchan/onf-connect-18-tutorial/tree/master/lab2 <https://github.com/charlesmcchan/onf-connect-18-tutorial/tree/master/lab2>
>  
> The original VM for the lab is no longer available so I am trying to use the 2019 ngsdn VM.
>  
> The ONOS controller is running but when I try to run the Mininet topology using “trellis-gtp.py” I get a message that it cannot connect to the ONOS controller:
>  
> “Unable to contact the remote controller at localhost:6633”
>  
> How can I change the scenario to work on the ngsdn VM please?
> 
> Many thanks
> 
> David Lake
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org <mailto:stratum-dev at lists.stratumproject.org>
> https://lists.stratumproject.org/listinfo/stratum-dev <https://lists.stratumproject.org/listinfo/stratum-dev>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200715/fb3d72d8/attachment.html>

From d.lake at surrey.ac.uk  Wed Jul 15 17:54:29 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Wed, 15 Jul 2020 17:54:29 +0000
Subject: [stratum-dev] ONOS P4 Trellis and SPGW
In-Reply-To: <9558B0B2-46AD-406F-B718-19C8F478113E@opennetworking.org>
References: <010101735371e4de-909ec448-0053-4874-bfad-3229e3d2ffa1-000000@us-west-2.amazonses.com>
 <9558B0B2-46AD-406F-B718-19C8F478113E@opennetworking.org>
Message-ID: <VI1PR06MB521421F9C6C8581285FE761BB57E0@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hi Carmelo

Perfect!  Thank you – I will download the new VM and start over.

David

From: Carmelo Cascone <carmelo at opennetworking.org>
Sent: 15 July 2020 18:44
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
Cc: brigade-p4 at onosproject.org; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] ONOS P4 Trellis and SPGW

Hi David,

Please check exercise 7 and 8 from the ngsdn-tutorial (“advanced" branch):
https://github.com/opennetworkinglab/ngsdn-tutorial/tree/advanced<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopennetworkinglab%2Fngsdn-tutorial%2Ftree%2Fadvanced&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cc0598382b56e46bd652408d828e6b748%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637304318675263411&sdata=J5tm257ez1l%2FEYW8GhlTKDnStgJeIRbBIhMp4TwTBDQ%3D&reserved=0>

These two exercises have been adapted from the older ONF Connect 2018 tutorial which is no longer maintained.

Hope it helps
Carmelo


On Jul 15, 2020, at 10:07 AM, David Lake via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:

Hello

I’m trying to run the ONF Connect 2018 lab for SPGW.

Eventually, I want to run this on a Wedge 100BF-32x switch – I have the Stratum agent running on the switch and ONOS 2.2.3 connected to it.

However, before I do that, I want to run the BMV2 lab - https://github.com/charlesmcchan/onf-connect-18-tutorial/tree/master/lab2<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fcharlesmcchan%2Fonf-connect-18-tutorial%2Ftree%2Fmaster%2Flab2&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cc0598382b56e46bd652408d828e6b748%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637304318675273400&sdata=%2Fkx1SLQnxrD7SiiXxnKKcMYJ4vOsCRMJdNhtUAHc1cs%3D&reserved=0>

The original VM for the lab is no longer available so I am trying to use the 2019 ngsdn VM.

The ONOS controller is running but when I try to run the Mininet topology using “trellis-gtp.py” I get a message that it cannot connect to the ONOS controller:

“Unable to contact the remote controller at localhost:6633”

How can I change the scenario to work on the ngsdn VM please?

Many thanks

David Lake
_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7Cc0598382b56e46bd652408d828e6b748%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637304318675273400&sdata=0YRD%2B9376JD5Q0NkOnyLQpu4cZhcKhEF2cNCViyqy1U%3D&reserved=0>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200715/c4cf8259/attachment-0001.html>

From d.lake at surrey.ac.uk  Thu Jul 16 14:32:24 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Thu, 16 Jul 2020 14:32:24 +0000
Subject: [stratum-dev] Confused about how to run Stratum
In-Reply-To: <CAOyFVR1fySqYorzNeHjhKkanoqY8j0yFX_xg4eg79WgwSppVjA@mail.gmail.com>
References: <0101017345793335-3558663d-bbd9-40bb-8e17-a3ce4a99e50a-000000@us-west-2.amazonses.com>
 <CA+kiLHFoPMhWoEMO0TdLHzQKL=jmZaOHgZE=NZQE0nNfO+MrJQ@mail.gmail.com>
 <VI1PR06MB5214BE4129F113D74CDD0BA1B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <e6cecc65-1766-0781-036e-10bc722a51c2@gmx.de>
 <VI1PR06MB521494F8B8D8321EB0407232B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <666d626b-d5a3-d83b-cf7a-b06836c61c5a@gmx.de>
 <VI1PR06MB52149A19A1599899788993DEB5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <57dbdb09-96f8-2749-4c40-b9456cfad25c@gmx.de>
 <VI1PR06MB52143FA1563829B9C91C3591B5600@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <010101734a4614c5-15b131f0-baaf-4456-8936-447043f850a9-000000@us-west-2.amazonses.com>
 <ff28c38c-ced6-98e1-982f-339d1fee59ea@gmx.de>
 <CAFh9Y_M9fsSH5FsYs1Gm1f76CLQou=YRWLEP5YRRHqbBO9c=vQ@mail.gmail.com>
 <VI1PR06MB52149FCAB9684C1DE1F833D0B5610@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <CAOyFVR1fySqYorzNeHjhKkanoqY8j0yFX_xg4eg79WgwSppVjA@mail.gmail.com>
Message-ID: <VI1PR06MB521417E6D06BA0EABA98775DB57F0@VI1PR06MB5214.eurprd06.prod.outlook.com>

Thank you.

I have the SPGW use-case running now from the latest labs from the NGSDN tutorial.

I now need to move this to a real switch (EdgeCore Wedge 100BF-32x).

And again, more confusion!

I presume that I have to use the pipeconf “org.opencord.fabric-spgw.tofino.mavericks_sde_9_0_0” ?

The other piece I don’t understand is the configuration of the switch ports:

If I look at devices in ONOS, I see my switch and the “Ports” underneath (as shown below).   How do I reference these in the netcfg JSON?  What are the parameters to configure against each port.

My build is going to be very simple – one switch with an eNB on one port, two subnets across the one switch.

Does anyone have a sample JSON for a Wedge 100bf-32x I can build from?

Thanks

David

false
[17/0](0)
100000
Copper
false
[16/0](4)
100000
Copper
false
[18/0](8)
100000
Copper
false
[15/0](12)
100000
Copper
false
[19/0](16)
100000
Copper
false
[14/0](20)
100000
Copper
false
[20/0](24)
100000
Copper
false
[13/0](28)
100000
Copper
false
[21/0](32)
100000
Copper
false
[12/0](36)
100000
Copper
false
[22/0](40)
100000
Copper
false
[11/0](44)
100000
Copper
false
[23/0](48)
100000
Copper
false
[10/0](52)
100000
Copper
false
[24/0](56)
100000
Copper
false
[9/0](60)
100000
Copper
false
[1/0](128)
100000
Copper
false
[31/0](132)
100000
Copper
false
[2/0](136)
100000
Copper
false
[32/0](140)
100000
Copper
false
[3/0](144)
100000
Copper
false
[29/0](148)
100000
Copper
false
[4/0](152)
100000
Copper
false
[30/0](156)
100000
Copper
false
[5/0](160)
100000
Copper
false
[28/0](164)
100000
Copper
false
[6/0](168)
100000
Copper
false
[27/0](172)
100000
Copper
false
[7/0](176)
100000
Copper
false
[26/0](180)
100000
Copper
false
[8/0](184)
100000
Copper
false
[25/0](188)
100000
Copper



From: Yi Tseng <yi at opennetworking.org>
Sent: 14 July 2020 19:47
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
Cc: Maximilian Pudelko <max at opennetworking.org>; David Gengenbach <davidgengenbach at gmx.de>; Alireza Ghaffarkhah <aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org>; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Confused about how to run Stratum

Hi David,

It depends on the P4 program. basically you need to create an ONOS application to manage tables in spgw pipeline.

You can use Pi* classes (PiAction, PiTableId, ...) to manage protocol-independent tables/pipelines.

Here is an example:
https://github.com/opennetworkinglab/onos/blob/master/apps/p4-tutorial/mytunnel/src/main/java/org/onosproject/p4tutorial/mytunnel/MyTunnelApp.solution<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopennetworkinglab%2Fonos%2Fblob%2Fmaster%2Fapps%2Fp4-tutorial%2Fmytunnel%2Fsrc%2Fmain%2Fjava%2Forg%2Fonosproject%2Fp4tutorial%2Fmytunnel%2FMyTunnelApp.solution&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700304550&sdata=8EA6a5IdnFa4wZOQPMgGnPFlFTtAo%2BvrOSqrO7boe5M%3D&reserved=0>

Yi

On Tue, Jul 14, 2020 at 1:45 AM David Lake <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>> wrote:
It was very, very helpful.

What I am now trying to do is recreate the spgw use-case.

Can anyone point me to information on that please?  I need to understand how to inject the TEID into ONOS.

Thanks

David
From: Maximilian Pudelko <max at opennetworking.org<mailto:max at opennetworking.org>>
Sent: 14 July 2020 00:13
To: David Gengenbach <davidgengenbach at gmx.de<mailto:davidgengenbach at gmx.de>>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>>; Alireza Ghaffarkhah <aghaffar at google.com<mailto:aghaffar at google.com>>; Brian O'Connor <brian at opennetworking.org<mailto:brian at opennetworking.org>>; Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

I have just merged the guide to master. Seems like it already helped someone :D
Thanks again David for putting in the work!
Max

On Mon, Jul 13, 2020 at 3:25 PM David Gengenbach <davidgengenbach at gmx.de<mailto:davidgengenbach at gmx.de>> wrote:

Ah, I forgot that you use ONOS - in that case, you have to look into the way ONOS is handling/configuring ports (like https://wiki.onosproject.org/display/ONOS/Interfaces+configuration<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.onosproject.org%2Fdisplay%2FONOS%2FInterfaces%2Bconfiguration&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700314547&sdata=Rb6qBlCyp4J17i7eIE6hSg9Bm79oWKkNi%2BUuByQVNEQ%3D&reserved=0>).

Basically, you have to adapt your netcfg (or the one you used from the fabric-tofino repo).

You would not talk to gNMI directly since it might lead to inconsistencies.
On 7/14/20 12:22 AM, David Gengenbach via stratum-dev wrote:

As far as I know, you would use gNMI (https://github.com/openconfig/gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fopenconfig%2Fgnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700314547&sdata=AK5EUoSs2L6s9Op1vK%2F%2BavnuTAZqMtCuJ5yYzLqHKSo%3D&reserved=0>) for this - which is also bundled/started with Stratum.
Here is a really helpful tutorial for Stratum which also covers gNMI: https://github.com/stratum/tutorial/tree/master/basic#gnmi<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Ftutorial%2Ftree%2Fmaster%2Fbasic%23gnmi&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700324540&sdata=fEcHkYVA1aFPATmizuH3KAFxTY3VR73n6JQGPfMt%2B00%3D&reserved=0>

The port config command would look something like: ./gnmi-cli.sh set /interfaces/interface[name=s1-eth1]/config/enabled --bool-val true

(Using the gnmi-cli from the tutorial.)
On 7/14/20 12:15 AM, David Lake wrote:
The guide was VERY useful!

I now need to understand how to configure the ports in the switch – I want to build a very simple SPGW use-case with a single switch.

How do I build the switch configuration?  Is this is in the JSON file?

Thanks

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 23:12
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Perfect!
Interestingly, I think I had the exact same problems you encountered :D That's why I wrote this guide - a lot of pitfalls. Restarting and starting with a clean slate, miraculously, solved a lot of my problems.
On 7/14/20 12:01 AM, David Lake wrote:
AHA!   Perfect – thank you.   It seems that the fabric-tofino was not empty.   I deleted and recompiled and now I see my switch!

Thank you so much for your help.

Kind regards

David

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:50
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


Unfortunately, I do not have access to the Tofino switch now, so I can not confirm your logs.
Can you please also provide the output of running "pipeconf | grep tofino" in the ONOS CLI (onos onos at localhost    # Password is rocks).

Did you start with an empty fabric-tofino repo and executed the commands?

Especially this log entry is strange (but again, I can not verify whether this is normal):
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin


On 7/13/20 11:46 PM, David Lake wrote:
I did follow this step and was able to register the application and pipeline but I don’t see “org.opencord.fabric.tofino.montara_sde_9_0_0” anywhere?

David

root at ONOS:~/fabric-tofino# make pipeconf-install ONOS_HOST=localhost
*** Installing and activating pipeconf app in ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -HContent-Type:ap                                                                                                                                                             plication/octet-stream \
        'http://localhost:8181/onos/v1/applications?activate=true' \
        --data-binary @/home/admin5g/fabric-tofino/target/fabric-tofino-1.1.1-SN                                                                                                                                                             APSHOT.oar
{"name":"org.opencord.fabric-tofino","id":190,"version":"1.1.1.SNAPSHOT","catego                                                                                                                                                             ry":"Pipeline","description":"Provides pipeconfs based on fabric.","readme":"Pro                                                                                                                                                             vides pipeconfs based on fabric.p4 to use Trellis with Barefoot\\n            To                                                                                                                                                             fino-based devices.","origin":"http://www.opencord.org"<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.opencord.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700324540&sdata=%2BkNzV2gzB%2Bhc1hZ70t5QvvCJNPI6xP8V7mNRutrySDw%3D&reserved=0>,"url":"http://www.openco<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.openco%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700334534&sdata=XvYSfYCElAEzsxvnADPuIwR99qpM1RbbsuVQlRRP6KI%3D&reserved=0>                                                                                                                                                             rd.org<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Frd.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700334534&sdata=WTX8EbO07U8DZMHArwGthry%2FpNFC%2F54ltWnATViln%2BY%3D&reserved=0>","featuresRepo":"mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT/xml/featur                                                                                                                                                             es","state":"ACTIVE","features":["fabric-tofino"],"permissions":[],"requiredApps                                                                                                                                                             ":["org.onosproject.pipelines.fabric"]}
root at ONOS:~/fabric-tofino#
root at ONOS:~/fabric-tofino#





root at ONOS:~/fabric-tofino# tail -50 /opt/onos/log/karaf.log
2020-07-13T22:10:55,638 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:55,647 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,648 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:55,650 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,652 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-basic/2.2.3
2020-07-13T22:10:55,689 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:55,690 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-apps-inbandtelemetry-api/2.2.3
2020-07-13T22:10:55,696 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-basic/2.2.3
2020-07-13T22:10:56,388 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.basic (fingerprint=1f:03:c5:4d:32:19:e4:f4)
2020-07-13T22:10:56,391 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.int<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2Forg.onosproject.pipelines.int%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700334534&sdata=2dR7Dh%2F3f6U4J18OOVfIT3zs3Zo3Mb2A8cpS7cPIGXo%3D&reserved=0> (fingerprint=cf:0e:30:28:dc:5f:97:4c)
2020-07-13T22:10:56,396 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:56,399 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.basic has been activated
2020-07-13T22:10:56,402 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: onos-pipelines-fabric/[2.2.3,2.2.3]
2020-07-13T22:10:57,086 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:57,094 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,095 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:57,097 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,104 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.onosproject/onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,178 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:57,179 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-api/2.2.3
2020-07-13T22:10:57,183 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.onosproject.onos-pipelines-fabric-impl/2.2.3
2020-07-13T22:10:57,905 | WARN  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Unable to build pipeconf at p4c-out/fabric-mlnx/spectrum/default/ because file is missing: spectrum.bin
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-bng (fingerprint=9e:af:91:d4:8c:8a:bc:98)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-full (fingerprint=1a:cc:c0:b8:a6:f7:a4:7e)
2020-07-13T22:10:58,241 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-int (fingerprint=01:39:87:22:c5:c4:e6:0a)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw-int (fingerprint=97:b3:d2:dd:9e:10:bf:ce)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric-spgw (fingerprint=ca:1c:0d:f1:f2:df:07:3f)
2020-07-13T22:10:58,243 | INFO  | features-3-thread-1 | PiPipeconfManager                | 193 - org.onosproject.onos-core-net - 2.2.3 | New pipeconf registered: org.onosproject.pipelines.fabric (fingerprint=33:a1:c2:36:82:04:f5:0c)
2020-07-13T22:10:58,244 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,252 | INFO  | features-3-thread-1 | FabricPipeconfLoader             | 236 - org.onosproject.onos-pipelines-fabric-impl - 2.2.3 | Started
2020-07-13T22:10:58,261 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,263 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.onosproject.pipelines.fabric has been activated
2020-07-13T22:10:58,266 | INFO  | onos-store-app-app-activation | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Adding features: fabric-tofino/[1.1.1.SNAPSHOT,1.1.1.SNAPSHOT]
2020-07-13T22:10:58,960 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Changes to perform:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   Region: root
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |     Bundles to install:
2020-07-13T22:10:58,961 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |       mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,963 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Installing bundles:
2020-07-13T22:10:58,964 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   mvn:org.opencord/fabric-tofino/1.1.1-SNAPSHOT
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Starting bundles:
2020-07-13T22:10:58,988 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 |   org.opencord.fabric-tofino/1.1.1.SNAPSHOT
2020-07-13T22:10:58,996 | INFO  | features-3-thread-1 | PipeconfLoader                   | 237 - org.opencord.fabric-tofino - 1.1.1.SNAPSHOT | Started
2020-07-13T22:10:58,998 | INFO  | features-3-thread-1 | FeaturesServiceImpl              | 11 - org.apache.karaf.features.core - 4.2.8 | Done.
2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

From: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>
Sent: 13 July 2020 22:42
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum


It seems like you did not install/activate the fabric-tofino library?

Did you follow the steps in the guide? The "Compile fabric-tofino" section should install the pipeconfs.

Important: you do NOT have to follow the whole guide of fabric-tofino. They provide compiled switch binaries. If you follow their guide, these are automatically cleaned (= deleted) before they are compiled again - so all subsequent commands will not work unless you are able to compile them yourself (which is only needed if you want to change the underlying P4 program, I guess). So I would suggest starting with a fresh copy of fabric-tofino in case you changed to much.

For troubleshooting: as described in the guide, you can connect to ONOS via the CLI and look for the pipeconf by executing:
`onos onos at localhost` (or wherever ONOS is hosted)


https://github.com/stratum/stratum/blob/b1aa4a5fae55b9971839896add66f5d9a43505bf/stratum/docs/setup_guide_barefoot_tofino_onos.md#compile-fabric-tofino<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fblob%2Fb1aa4a5fae55b9971839896add66f5d9a43505bf%2Fstratum%2Fdocs%2Fsetup_guide_barefoot_tofino_onos.md%23compile-fabric-tofino&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700344528&sdata=XQ7F1%2FkJs06%2Bzh91IC%2Bj0kYXVOYYwIraPxmWd3hT9mE%3D&reserved=0>
On 7/13/20 11:20 PM, David Lake wrote:
OK – I followed the instructions from David Gengenbach (thank you) and I now have a Stratum agent running on the switch.

I then built the pipeline in ONOS and loaded it:

2020-07-13T22:10:58,999 | INFO  | onos-store-app-app-activation | ApplicationManager               | 193 - org.onosproject.onos-core-net - 2.2.3 | Application org.opencord.fabric-tofino has been activated
root at ONOS:~/fabric-tofino#

But when I add the netfcfg, I see this message in the ONOS log:

2020-07-13T22:15:42,571 | ERROR | onos-gdp-6       | DeviceTaskExecutor               | 225 - org.onosproject.onos-providers-general-device - 2.2.3 | Unable to complete task CONNECTION_SETUP for device:my-tofino-switch: pipeconf org.opencord.fabric.tofino.montara_sde_9_0_0 not registered


My switch is a Montara but I don’t see where the pipeconf is built?

On my ONOS system I have ONOS 2.2.3 and bf-sde-9.0.0.  I have not built anything with the bf-sde.

Do I need to run p4studio_build in the BF-SDE first?

Thanks

David

From: Alireza Ghaffarkhah <aghaffar at google.com><mailto:aghaffar at google.com>
Sent: 13 July 2020 07:01
To: David Gengenbach <davidgengenbach at gmx.de><mailto:davidgengenbach at gmx.de>; Brian O'Connor <brian at opennetworking.org><mailto:brian at opennetworking.org>; Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>; Maximilian Pudelko <max at opennetworking.org><mailto:max at opennetworking.org>
Cc: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Confused about how to run Stratum

+Brian O'Connor<mailto:brian at opennetworking.org> +Yi Tseng<mailto:yi at opennetworking.org> +Maximilian Pudelko<mailto:max at opennetworking.org> in case they can provide more input.

On Sun, Jul 12, 2020 at 5:00 PM David Gengenbach via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
I created a setup guide for this exact use-case. The PR for it has not
been merged but should work: https://github.com/stratum/stratum/pull/280<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fstratum%2Fstratum%2Fpull%2F280&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700344528&sdata=kqnQ9VvyQNd5F7jNkKnxK5KeXr8cbh0%2Fa632ve3%2FdJY%3D&reserved=0>

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700354522&sdata=0glELd81VXazGqvqW0xBckyh9JefMu%2Fz8sEKxxH5MAk%3D&reserved=0>


_______________________________________________

stratum-dev mailing list

stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>

https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700354522&sdata=0glELd81VXazGqvqW0xBckyh9JefMu%2Fz8sEKxxH5MAk%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C87d0b7183c7447d04be908d828266739%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637303492700364517&sdata=%2BJD4z2atX1rx7zCsll0ZeQmFJVdkZIQpcaIb%2FYrEyU8%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200716/1139e5e0/attachment-0001.html>

From d.lake at surrey.ac.uk  Sat Jul 18 19:55:31 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Sat, 18 Jul 2020 19:55:31 +0000
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
Message-ID: <VI1PR06MB521488E31A7387ED4DA8D247B57D0@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hello

Thank you for you help so far.  I now need some more guidance please.

I have a Wedge 100BF-32x running ONL and the Stratum Docker container with ONOS 2.2.3 and the fabric-tofino pipeconf.

When I set the CHASSIS_CONFIG for the switch and start the container, I see errors regarding the fan configuration from the switch (see "start-stratum2.txt" log file).

Eventually, these timeout and the switch becomes available (about 10 minutes to start).

However, when I add to ONOS using the netcfg command I see errors and the ports show as "Enabled - False" in ONOS.   My netfg log is attached as "necfg.txt."

What I need to do is to set up the switch with 4 subnets across the 32 ports.  I'm trying to find an example configuration and some worked tutorials/user-guides.

Can someone please point me to some sample configs for similar environments please and tell me where I am going wrong with the configuration?

Thanks

David


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200718/1289527c/attachment-0001.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: netcfg.txt
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200718/1289527c/attachment-0002.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Start-stratum2.txt
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200718/1289527c/attachment-0003.txt>

From yi at opennetworking.org  Mon Jul 20 18:12:35 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Mon, 20 Jul 2020 11:12:35 -0700
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
In-Reply-To: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
References: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
Message-ID: <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>

Hi David,

Please find the config file attached, and modify it based on your
requirements.

Also, you can follow the Trellis Configuration Guide
<https://docs.trellisfabric.org/1.12/configuration/bridging-unicast.html> for
more information about how to config the ONOS Trellis application.

Yi

On Sat, Jul 18, 2020 at 12:55 PM David Lake via stratum-dev <
stratum-dev at lists.stratumproject.org> wrote:

> Hello
>
>
>
> Thank you for you help so far.  I now need some more guidance please.
>
>
>
> I have a Wedge 100BF-32x running ONL and the Stratum Docker container with
> ONOS 2.2.3 and the fabric-tofino pipeconf.
>
>
>
> When I set the CHASSIS_CONFIG for the switch and start the container, I
> see errors regarding the fan configuration from the switch (see
> “start-stratum2.txt” log file).
>
>
>
> Eventually, these timeout and the switch becomes available (about 10
> minutes to start).
>
>
> However, when I add to ONOS using the netcfg command I see errors and the
> ports show as “Enabled – False” in ONOS.   My netfg log is attached as
> “necfg.txt.”
>
>
>
> What I need to do is to set up the switch with 4 subnets across the 32
> ports.  I’m trying to find an example configuration and some worked
> tutorials/user-guides.
>
>
>
> Can someone please point me to some sample configs for similar
> environments please and tell me where I am going wrong with the
> configuration?
>
>
> Thanks
>
>
>
> David
>
>
>
>
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev



-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200720/b3c52b63/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: netcfg.json
Type: application/json
Size: 6968 bytes
Desc: not available
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200720/b3c52b63/attachment.json>

From d.lake at surrey.ac.uk  Thu Jul 23 22:16:16 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Thu, 23 Jul 2020 22:16:16 +0000
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
In-Reply-To: <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>
References: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
 <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>
Message-ID: <VI1PR06MB521432D807DDB1B3C494AD6AB5760@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hi Yi

I’m making very good progress thanks to the excellent support here – thank you.

I have one problem.

One host I have does not “talk” first and therefore I need to configure the MAC address and port manually.

I’ve tried to do this by including the MAC address and IP address in the tofin-netcfg.json but I get this response from ONOS:

root at ONOS:~/fabric-tofino# make netcfg ONOS_HOST=localhost
*** Pushing tofino-netcfg.json to ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -H 'Content-Type:application/json' \
        http://localhost:8181/onos/v1/network/configuration -d at ./tofino-netcfg.json
{"code":207,"message":["Error parsing config hosts/24:8A:07:B8:71:DB/None/basic: Field \"location\" is invalid: Field is not allowed"]}


This is the Tofino-netcfg.json file:

{
  "layouts" : { },
  "devices" : {
    "device:my-tofino-switch" : {
      "basic" : {
        "managementAddress" : "grpc://10.5.23.21:28000?device_id=1",
        "driver" : "stratum-tofino",
        "pipeconf" : "org.opencord.fabric-spgw.tofino.montara_sde_9_0_0"
      },
  "segmentrouting": {
    "name": "edge1",
    "ipv4NodeSid": 101,
    "ipv4Loopback": "192.168.1.1",
    "routerMac": "00:AA:00:00:00:01",
    "isEdgeRouter": true,
    "adjacencySids": []
  }
  }
  },
  "hosts" : {
    "24:8a:07:b8:71:db/None": {
      "basic":{
       "ips":["10.0.40.3"],
       "location": "device:my-tofino-switch/136"
      }
    }
  },
  "apps" : { },
  "ports" : {
  "device:my-tofino-switch/128" : {
      "interfaces" : [{
        "name" : "Port 1",
        "ips" : [ "10.0.30.254/24"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/136" : {
      "interfaces" : [{
        "name" : "Port 2 ",
        "ips" : [ "10.0.40.254/24"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/144" : {
      "interfaces" : [{
        "name" : "Port 3 ",
        "ips" : [ "10.0.10.254/24"],
        "vlan-untagged": 10,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/152" : {
      "interfaces" : [{
        "name" : "Port 4 ",
        "ips" : [ "10.0.20.254/24"],
        "vlan-untagged": 20,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/12" : {
      "interfaces" : [{
        "name" : "Port 15/1",
        "ips" : [ "10.0.30.254/24"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
    "device:my-tofino-switch/48" : {
      "interfaces" : [{
        "name" : "Port 23/1",
        "ips" : [ "10.0.40.254/24"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    }
   },
  "regions" : { },
  "links" : { }
}

Thank you

David

From: Yi Tseng <yi at opennetworking.org>
Sent: 20 July 2020 19:13
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
Cc: stratum-dev at lists.stratumproject.org; P4 brigade <brigade-p4 at onosproject.org>; Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS

Hi David,

Please find the config file attached, and modify it based on your requirements.

Also, you can follow the Trellis Configuration Guide<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.trellisfabric.org%2F1.12%2Fconfiguration%2Fbridging-unicast.html&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C332a2c06e850489acee808d82cd890d3%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637308655942152951&sdata=0XiJAlBLBKGdcFboHXxC1JA19u9vdhorxIe%2BbQAtRBU%3D&reserved=0> for more information about how to config the ONOS Trellis application.

Yi

On Sat, Jul 18, 2020 at 12:55 PM David Lake via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
Hello

Thank you for you help so far.  I now need some more guidance please.

I have a Wedge 100BF-32x running ONL and the Stratum Docker container with ONOS 2.2.3 and the fabric-tofino pipeconf.

When I set the CHASSIS_CONFIG for the switch and start the container, I see errors regarding the fan configuration from the switch (see “start-stratum2.txt” log file).

Eventually, these timeout and the switch becomes available (about 10 minutes to start).

However, when I add to ONOS using the netcfg command I see errors and the ports show as “Enabled – False” in ONOS.   My netfg log is attached as “necfg.txt.”

What I need to do is to set up the switch with 4 subnets across the 32 ports.  I’m trying to find an example configuration and some worked tutorials/user-guides.

Can someone please point me to some sample configs for similar environments please and tell me where I am going wrong with the configuration?

Thanks

David


_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C332a2c06e850489acee808d82cd890d3%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637308655942162957&sdata=LKbjNn9ncfyafhujC4LRKDak7yr7yI0wgeQDJBbKS4U%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C332a2c06e850489acee808d82cd890d3%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637308655942162957&sdata=96%2Be%2FD4cwSaW9%2FLObmhpFCcjQm%2BeVujcLVwcnwGDlFU%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200723/8bb9459f/attachment-0001.html>

From yi at opennetworking.org  Fri Jul 24 02:57:30 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Thu, 23 Jul 2020 19:57:30 -0700
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
In-Reply-To: <VI1PR06MB521432D807DDB1B3C494AD6AB5760@VI1PR06MB5214.eurprd06.prod.outlook.com>
References: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
 <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>
 <VI1PR06MB521432D807DDB1B3C494AD6AB5760@VI1PR06MB5214.eurprd06.prod.outlook.com>
Message-ID: <CAOyFVR1N8Oq7qMeo=8ANP1UkYRuBNGmhC0mhWJk2o47njkraow@mail.gmail.com>

Hi David,

Please try *"locations": ["device:my-tofino-switch/136"]*

Yi

On Thu, Jul 23, 2020 at 3:16 PM David Lake <d.lake at surrey.ac.uk> wrote:

> Hi Yi
>
>
>
> I’m making very good progress thanks to the excellent support here – thank
> you.
>
>
>
> I have one problem.
>
>
>
> One host I have does not “talk” first and therefore I need to configure
> the MAC address and port manually.
>
>
>
> I’ve tried to do this by including the MAC address and IP address in the
> tofin-netcfg.json but I get this response from ONOS:
>
>
>
> root at ONOS:~/fabric-tofino# make netcfg ONOS_HOST=localhost
>
> *** Pushing tofino-netcfg.json to ONOS at localhost...
>
> curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -H
> 'Content-Type:application/json' \
>
>         http://localhost:8181/onos/v1/network/configuration -d@
> ./tofino-netcfg.json
>
> {"code":207,"message":["Error parsing config
> hosts/24:8A:07:B8:71:DB/None/basic: Field \"location\" is invalid: Field is
> not allowed"]}
>
>
>
>
>
> This is the Tofino-netcfg.json file:
>
>
>
> {
>
>   "layouts" : { },
>
>   "devices" : {
>
>     "device:my-tofino-switch" : {
>
>       "basic" : {
>
>         "managementAddress" : "grpc://10.5.23.21:28000?device_id=1",
>
>         "driver" : "stratum-tofino",
>
>         "pipeconf" : "org.opencord.fabric-spgw.tofino.montara_sde_9_0_0"
>
>       },
>
>   "segmentrouting": {
>
>     "name": "edge1",
>
>     "ipv4NodeSid": 101,
>
>     "ipv4Loopback": "192.168.1.1",
>
>     "routerMac": "00:AA:00:00:00:01",
>
>     "isEdgeRouter": true,
>
>     "adjacencySids": []
>
>   }
>
>   }
>
>   },
>
>   "hosts" : {
>
>     "24:8a:07:b8:71:db/None": {
>
>       "basic":{
>
>        "ips":["10.0.40.3"],
>
>        "location": "device:my-tofino-switch/136"
>
>       }
>
>     }
>
>   },
>
>   "apps" : { },
>
>   "ports" : {
>
>   "device:my-tofino-switch/128" : {
>
>       "interfaces" : [{
>
>         "name" : "Port 1",
>
>         "ips" : [ "10.0.30.254/24"],
>
>         "vlan-untagged": 30,
>
>         "mac" : "00:AA:00:00:00:01"
>
>       }]
>
>     },
>
>   "device:my-tofino-switch/136" : {
>
>       "interfaces" : [{
>
>         "name" : "Port 2 ",
>
>         "ips" : [ "10.0.40.254/24"],
>
>         "vlan-untagged": 40,
>
>         "mac" : "00:AA:00:00:00:01"
>
>       }]
>
>     },
>
>   "device:my-tofino-switch/144" : {
>
>       "interfaces" : [{
>
>         "name" : "Port 3 ",
>
>         "ips" : [ "10.0.10.254/24"],
>
>         "vlan-untagged": 10,
>
>         "mac" : "00:AA:00:00:00:01"
>
>       }]
>
>     },
>
>   "device:my-tofino-switch/152" : {
>
>       "interfaces" : [{
>
>         "name" : "Port 4 ",
>
>         "ips" : [ "10.0.20.254/24"],
>
>         "vlan-untagged": 20,
>
>         "mac" : "00:AA:00:00:00:01"
>
>       }]
>
>     },
>
>   "device:my-tofino-switch/12" : {
>
>       "interfaces" : [{
>
>         "name" : "Port 15/1",
>
>         "ips" : [ "10.0.30.254/24"],
>
>         "vlan-untagged": 30,
>
>         "mac" : "00:AA:00:00:00:01"
>
>       }]
>
>     },
>
>     "device:my-tofino-switch/48" : {
>
>       "interfaces" : [{
>
>         "name" : "Port 23/1",
>
>         "ips" : [ "10.0.40.254/24"],
>
>         "vlan-untagged": 40,
>
>         "mac" : "00:AA:00:00:00:01"
>
>       }]
>
>     }
>
>    },
>
>   "regions" : { },
>
>   "links" : { }
>
> }
>
>
>
> Thank you
>
>
>
> David
>
>
>
> *From:* Yi Tseng <yi at opennetworking.org>
> *Sent:* 20 July 2020 19:13
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> *Cc:* stratum-dev at lists.stratumproject.org; P4 brigade <
> brigade-p4 at onosproject.org>; Vural, Serdar Dr (Elec Electronic Eng) <
> s.vural at surrey.ac.uk>
> *Subject:* Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with
> ONOS
>
>
>
> Hi David,
>
>
>
> Please find the config file attached, and modify it based on your
> requirements.
>
>
>
> Also, you can follow the Trellis Configuration Guide
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.trellisfabric.org%2F1.12%2Fconfiguration%2Fbridging-unicast.html&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C332a2c06e850489acee808d82cd890d3%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637308655942152951&sdata=0XiJAlBLBKGdcFboHXxC1JA19u9vdhorxIe%2BbQAtRBU%3D&reserved=0> for
> more information about how to config the ONOS Trellis application.
>
>
>
> Yi
>
>
>
> On Sat, Jul 18, 2020 at 12:55 PM David Lake via stratum-dev <
> stratum-dev at lists.stratumproject.org> wrote:
>
> Hello
>
>
>
> Thank you for you help so far.  I now need some more guidance please.
>
>
>
> I have a Wedge 100BF-32x running ONL and the Stratum Docker container with
> ONOS 2.2.3 and the fabric-tofino pipeconf.
>
>
>
> When I set the CHASSIS_CONFIG for the switch and start the container, I
> see errors regarding the fan configuration from the switch (see
> “start-stratum2.txt” log file).
>
>
>
> Eventually, these timeout and the switch becomes available (about 10
> minutes to start).
>
>
> However, when I add to ONOS using the netcfg command I see errors and the
> ports show as “Enabled – False” in ONOS.   My netfg log is attached as
> “necfg.txt.”
>
>
>
> What I need to do is to set up the switch with 4 subnets across the 32
> ports.  I’m trying to find an example configuration and some worked
> tutorials/user-guides.
>
>
>
> Can someone please point me to some sample configs for similar
> environments please and tell me where I am going wrong with the
> configuration?
>
>
> Thanks
>
>
>
> David
>
>
>
>
>
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C332a2c06e850489acee808d82cd890d3%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637308655942162957&sdata=LKbjNn9ncfyafhujC4LRKDak7yr7yI0wgeQDJBbKS4U%3D&reserved=0>
>
>
>
>
> --
>
> Yi Tseng
>
> Member of Technical Staff
>
> Open Networking Foundation
>
> https://www.opennetworking.org/
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C332a2c06e850489acee808d82cd890d3%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637308655942162957&sdata=96%2Be%2FD4cwSaW9%2FLObmhpFCcjQm%2BeVujcLVwcnwGDlFU%3D&reserved=0>
>


-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200723/d60901ed/attachment.html>

From d.lake at surrey.ac.uk  Fri Jul 24 11:10:43 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Fri, 24 Jul 2020 11:10:43 +0000
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
In-Reply-To: <CAOyFVR1N8Oq7qMeo=8ANP1UkYRuBNGmhC0mhWJk2o47njkraow@mail.gmail.com>
References: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
 <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>
 <VI1PR06MB521432D807DDB1B3C494AD6AB5760@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <CAOyFVR1N8Oq7qMeo=8ANP1UkYRuBNGmhC0mhWJk2o47njkraow@mail.gmail.com>
Message-ID: <VI1PR06MB521439C7EA31EF31DE639205B5770@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hi Yi

Thank you!   I need to learn to read the instructions properly 😊

David

From: Yi Tseng <yi at opennetworking.org>
Sent: 24 July 2020 03:58
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
Cc: stratum-dev at lists.stratumproject.org; P4 brigade <brigade-p4 at onosproject.org>; Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS

Hi David,

Please try "locations": ["device:my-tofino-switch/136"]

Yi

On Thu, Jul 23, 2020 at 3:16 PM David Lake <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>> wrote:
Hi Yi

I’m making very good progress thanks to the excellent support here – thank you.

I have one problem.

One host I have does not “talk” first and therefore I need to configure the MAC address and port manually.

I’ve tried to do this by including the MAC address and IP address in the tofin-netcfg.json but I get this response from ONOS:

root at ONOS:~/fabric-tofino# make netcfg ONOS_HOST=localhost
*** Pushing tofino-netcfg.json to ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -H 'Content-Type:application/json' \
        http://localhost:8181/onos/v1/network/configuration -d at ./tofino-netcfg.json<mailto:-d at ./tofino-netcfg.json>
{"code":207,"message":["Error parsing config hosts/24:8A:07:B8:71:DB/None/basic: Field \"location\" is invalid: Field is not allowed"]}


This is the Tofino-netcfg.json file:

{
  "layouts" : { },
  "devices" : {
    "device:my-tofino-switch" : {
      "basic" : {
        "managementAddress" : "grpc://10.5.23.21:28000?device_id=1<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.5.23.21%3A28000%2F%3Fdevice_id%3D1&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900967579&sdata=1z6t5%2F0nEu6IesGD3v7Mlc3bygg2oX34e3gw4mqMcTo%3D&reserved=0>",
        "driver" : "stratum-tofino",
        "pipeconf" : "org.opencord.fabric-spgw.tofino.montara_sde_9_0_0"
      },
  "segmentrouting": {
    "name": "edge1",
    "ipv4NodeSid": 101,
    "ipv4Loopback": "192.168.1.1",
    "routerMac": "00:AA:00:00:00:01",
    "isEdgeRouter": true,
    "adjacencySids": []
  }
  }
  },
  "hosts" : {
    "24:8a:07:b8:71:db/None": {
      "basic":{
       "ips":["10.0.40.3"],
       "location": "device:my-tofino-switch/136"
      }
    }
  },
  "apps" : { },
  "ports" : {
  "device:my-tofino-switch/128" : {
      "interfaces" : [{
        "name" : "Port 1",
        "ips" : [ "10.0.30.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900967579&sdata=3tk7gqYbyPxyMo9kM%2B1BrwpCWEUVMK0oBpzuSOhJYxI%3D&reserved=0>"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/136" : {
      "interfaces" : [{
        "name" : "Port 2 ",
        "ips" : [ "10.0.40.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900977573&sdata=6nCu94l88slhrVcujMMgYeZpnitEHHXGciWWdtZIIqw%3D&reserved=0>"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/144" : {
      "interfaces" : [{
        "name" : "Port 3 ",
        "ips" : [ "10.0.10.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.10.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900977573&sdata=Cjm1K023GWBTRRdHlArhos9fgjMTcgExy2zAyCsl1NM%3D&reserved=0>"],
        "vlan-untagged": 10,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/152" : {
      "interfaces" : [{
        "name" : "Port 4 ",
        "ips" : [ "10.0.20.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.20.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900987567&sdata=Y2wmB76VXMC6fbHUvgIkyXV8pVgnpRBy9G9q%2Fj6BOtY%3D&reserved=0>"],
        "vlan-untagged": 20,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/12" : {
      "interfaces" : [{
        "name" : "Port 15/1",
        "ips" : [ "10.0.30.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900987567&sdata=xa23G3EIkwzMYm54B3DlgjsWKc3nuHVomSD9w9qGOIs%3D&reserved=0>"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
    "device:my-tofino-switch/48" : {
      "interfaces" : [{
        "name" : "Port 23/1",
        "ips" : [ "10.0.40.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=wozWawfrjihc%2FDVNMZXNlBIRPWyktdMnmLcGOq9xGYw%3D&reserved=0>"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    }
   },
  "regions" : { },
  "links" : { }
}

Thank you

David

From: Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>
Sent: 20 July 2020 19:13
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>; P4 brigade <brigade-p4 at onosproject.org<mailto:brigade-p4 at onosproject.org>>; Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk<mailto:s.vural at surrey.ac.uk>>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS

Hi David,

Please find the config file attached, and modify it based on your requirements.

Also, you can follow the Trellis Configuration Guide<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.trellisfabric.org%2F1.12%2Fconfiguration%2Fbridging-unicast.html&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=5Lb35r7ES7N6%2BZrlKS3VsuG405DwxaLYjDJtgtCsZ6g%3D&reserved=0> for more information about how to config the ONOS Trellis application.

Yi

On Sat, Jul 18, 2020 at 12:55 PM David Lake via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
Hello

Thank you for you help so far.  I now need some more guidance please.

I have a Wedge 100BF-32x running ONL and the Stratum Docker container with ONOS 2.2.3 and the fabric-tofino pipeconf.

When I set the CHASSIS_CONFIG for the switch and start the container, I see errors regarding the fan configuration from the switch (see “start-stratum2.txt” log file).

Eventually, these timeout and the switch becomes available (about 10 minutes to start).

However, when I add to ONOS using the netcfg command I see errors and the ports show as “Enabled – False” in ONOS.   My netfg log is attached as “necfg.txt.”

What I need to do is to set up the switch with 4 subnets across the 32 ports.  I’m trying to find an example configuration and some worked tutorials/user-guides.

Can someone please point me to some sample configs for similar environments please and tell me where I am going wrong with the configuration?

Thanks

David


_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=eIUfqyy6yKwX8j1jAFjmRaHnervOudHewT8zx6bAWc4%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562901007556&sdata=jbGuUi%2BAL39463kZb5vr%2F7%2F0jn8MT4HcDfFYSsKoiYo%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562901007556&sdata=jbGuUi%2BAL39463kZb5vr%2F7%2F0jn8MT4HcDfFYSsKoiYo%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200724/a1f10f87/attachment-0001.html>

From d.lake at surrey.ac.uk  Tue Jul 28 17:26:10 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Tue, 28 Jul 2020 17:26:10 +0000
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
In-Reply-To: <CAOyFVR1N8Oq7qMeo=8ANP1UkYRuBNGmhC0mhWJk2o47njkraow@mail.gmail.com>
References: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
 <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>
 <VI1PR06MB521432D807DDB1B3C494AD6AB5760@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <CAOyFVR1N8Oq7qMeo=8ANP1UkYRuBNGmhC0mhWJk2o47njkraow@mail.gmail.com>
Message-ID: <VI1PR06MB5214473B7D62190098D3C592B5730@VI1PR06MB5214.eurprd06.prod.outlook.com>

Hi Yi

I’ve changed to “locations” but I’m getting this message when I try to send the netcfg:

{"code":207,"message":["Error parsing config hosts/24:8A:07:B8:71:DB/None/basic: class com.fasterxml.jackson.databind.node.TextNode cannot be cast to class com.fasterxml.jackson.databind.node.ArrayNode (com.fasterxml.jackson.databind.node.TextNode and com.fasterxml.jackson.databind.node.ArrayNode are in unnamed module of loader org.apache.felix.framework.BundleWiringImpl$BundleClassLoader @9942f40)"]}

The “hosts” section is:

  "hosts" : {
    "24:8a:07:b8:71:db/None": {
      "basic":{
       "ips":["10.0.40.3"],
       "locations": "device:my-tofino-switch/136"
      }
    }
  },


Thanks

David

From: Yi Tseng <yi at opennetworking.org>
Sent: 24 July 2020 03:58
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
Cc: stratum-dev at lists.stratumproject.org; P4 brigade <brigade-p4 at onosproject.org>; Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS

Hi David,

Please try "locations": ["device:my-tofino-switch/136"]

Yi

On Thu, Jul 23, 2020 at 3:16 PM David Lake <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>> wrote:
Hi Yi

I’m making very good progress thanks to the excellent support here – thank you.

I have one problem.

One host I have does not “talk” first and therefore I need to configure the MAC address and port manually.

I’ve tried to do this by including the MAC address and IP address in the tofin-netcfg.json but I get this response from ONOS:

root at ONOS:~/fabric-tofino# make netcfg ONOS_HOST=localhost
*** Pushing tofino-netcfg.json to ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -H 'Content-Type:application/json' \
        http://localhost:8181/onos/v1/network/configuration -d at ./tofino-netcfg.json<mailto:-d at ./tofino-netcfg.json>
{"code":207,"message":["Error parsing config hosts/24:8A:07:B8:71:DB/None/basic: Field \"location\" is invalid: Field is not allowed"]}


This is the Tofino-netcfg.json file:

{
  "layouts" : { },
  "devices" : {
    "device:my-tofino-switch" : {
      "basic" : {
        "managementAddress" : "grpc://10.5.23.21:28000?device_id=1<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.5.23.21%3A28000%2F%3Fdevice_id%3D1&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900967579&sdata=1z6t5%2F0nEu6IesGD3v7Mlc3bygg2oX34e3gw4mqMcTo%3D&reserved=0>",
        "driver" : "stratum-tofino",
        "pipeconf" : "org.opencord.fabric-spgw.tofino.montara_sde_9_0_0"
      },
  "segmentrouting": {
    "name": "edge1",
    "ipv4NodeSid": 101,
    "ipv4Loopback": "192.168.1.1",
    "routerMac": "00:AA:00:00:00:01",
    "isEdgeRouter": true,
    "adjacencySids": []
  }
  }
  },
  "hosts" : {
    "24:8a:07:b8:71:db/None": {
      "basic":{
       "ips":["10.0.40.3"],
       "location": "device:my-tofino-switch/136"
      }
    }
  },
  "apps" : { },
  "ports" : {
  "device:my-tofino-switch/128" : {
      "interfaces" : [{
        "name" : "Port 1",
        "ips" : [ "10.0.30.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900967579&sdata=3tk7gqYbyPxyMo9kM%2B1BrwpCWEUVMK0oBpzuSOhJYxI%3D&reserved=0>"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/136" : {
      "interfaces" : [{
        "name" : "Port 2 ",
        "ips" : [ "10.0.40.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900977573&sdata=6nCu94l88slhrVcujMMgYeZpnitEHHXGciWWdtZIIqw%3D&reserved=0>"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/144" : {
      "interfaces" : [{
        "name" : "Port 3 ",
        "ips" : [ "10.0.10.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.10.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900977573&sdata=Cjm1K023GWBTRRdHlArhos9fgjMTcgExy2zAyCsl1NM%3D&reserved=0>"],
        "vlan-untagged": 10,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/152" : {
      "interfaces" : [{
        "name" : "Port 4 ",
        "ips" : [ "10.0.20.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.20.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900987567&sdata=Y2wmB76VXMC6fbHUvgIkyXV8pVgnpRBy9G9q%2Fj6BOtY%3D&reserved=0>"],
        "vlan-untagged": 20,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/12" : {
      "interfaces" : [{
        "name" : "Port 15/1",
        "ips" : [ "10.0.30.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900987567&sdata=xa23G3EIkwzMYm54B3DlgjsWKc3nuHVomSD9w9qGOIs%3D&reserved=0>"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
    "device:my-tofino-switch/48" : {
      "interfaces" : [{
        "name" : "Port 23/1",
        "ips" : [ "10.0.40.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=wozWawfrjihc%2FDVNMZXNlBIRPWyktdMnmLcGOq9xGYw%3D&reserved=0>"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    }
   },
  "regions" : { },
  "links" : { }
}

Thank you

David

From: Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>
Sent: 20 July 2020 19:13
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>; P4 brigade <brigade-p4 at onosproject.org<mailto:brigade-p4 at onosproject.org>>; Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk<mailto:s.vural at surrey.ac.uk>>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS

Hi David,

Please find the config file attached, and modify it based on your requirements.

Also, you can follow the Trellis Configuration Guide<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.trellisfabric.org%2F1.12%2Fconfiguration%2Fbridging-unicast.html&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=5Lb35r7ES7N6%2BZrlKS3VsuG405DwxaLYjDJtgtCsZ6g%3D&reserved=0> for more information about how to config the ONOS Trellis application.

Yi

On Sat, Jul 18, 2020 at 12:55 PM David Lake via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
Hello

Thank you for you help so far.  I now need some more guidance please.

I have a Wedge 100BF-32x running ONL and the Stratum Docker container with ONOS 2.2.3 and the fabric-tofino pipeconf.

When I set the CHASSIS_CONFIG for the switch and start the container, I see errors regarding the fan configuration from the switch (see “start-stratum2.txt” log file).

Eventually, these timeout and the switch becomes available (about 10 minutes to start).

However, when I add to ONOS using the netcfg command I see errors and the ports show as “Enabled – False” in ONOS.   My netfg log is attached as “necfg.txt.”

What I need to do is to set up the switch with 4 subnets across the 32 ports.  I’m trying to find an example configuration and some worked tutorials/user-guides.

Can someone please point me to some sample configs for similar environments please and tell me where I am going wrong with the configuration?

Thanks

David


_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=eIUfqyy6yKwX8j1jAFjmRaHnervOudHewT8zx6bAWc4%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562901007556&sdata=jbGuUi%2BAL39463kZb5vr%2F7%2F0jn8MT4HcDfFYSsKoiYo%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562901007556&sdata=jbGuUi%2BAL39463kZb5vr%2F7%2F0jn8MT4HcDfFYSsKoiYo%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200728/0197012d/attachment-0001.html>

From davidgengenbach at gmx.de  Tue Jul 28 17:59:47 2020
From: davidgengenbach at gmx.de (David Gengenbach)
Date: Tue, 28 Jul 2020 19:59:47 +0200
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
In-Reply-To: <010101739675e63d-2e337869-9b15-4520-b407-900b3772fad9-000000@us-west-2.amazonses.com>
References: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
 <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>
 <VI1PR06MB521432D807DDB1B3C494AD6AB5760@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <CAOyFVR1N8Oq7qMeo=8ANP1UkYRuBNGmhC0mhWJk2o47njkraow@mail.gmail.com>
 <010101739675e63d-2e337869-9b15-4520-b407-900b3772fad9-000000@us-west-2.amazonses.com>
Message-ID: <c9899aa2-85cd-3053-4bbb-5cae08c7a04c@gmx.de>

Try doing it with an array (as described by Yi Tseng):

"locations": ["device:my-tofino-switch/136"]

On 7/28/20 7:26 PM, David Lake via stratum-dev wrote:
>
> Hi Yi
>
> I’ve changed to “locations” but I’m getting this message when I try to
> send the netcfg:
>
> {"code":207,"message":["Error parsing config
> hosts/24:8A:07:B8:71:DB/None/basic: class
> com.fasterxml.jackson.databind.node.TextNode cannot be cast to class
> com.fasterxml.jackson.databind.node.ArrayNode
> (com.fasterxml.jackson.databind.node.TextNode and
> com.fasterxml.jackson.databind.node.ArrayNode are in unnamed module of
> loader org.apache.felix.framework.BundleWiringImpl$BundleClassLoader
> @9942f40)"]}
>
> The “hosts” section is:
>
> "hosts" : {
>
> "24:8a:07:b8:71:db/None": {
>
> "basic":{
>
> "ips":["10.0.40.3"],
>
> "locations": "device:my-tofino-switch/136"
>
> }
>
> }
>
> },
>
> Thanks
>
> David
>
> *From:*Yi Tseng <yi at opennetworking.org>
> *Sent:* 24 July 2020 03:58
> *To:* Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>
> *Cc:* stratum-dev at lists.stratumproject.org; P4 brigade
> <brigade-p4 at onosproject.org>; Vural, Serdar Dr (Elec Electronic Eng)
> <s.vural at surrey.ac.uk>
> *Subject:* Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x
> with ONOS
>
> Hi David,
>
> Please try *"locations": ["device:my-tofino-switch/136"]*
>
> Yi
>
> On Thu, Jul 23, 2020 at 3:16 PM David Lake <d.lake at surrey.ac.uk
> <mailto:d.lake at surrey.ac.uk>> wrote:
>
>     Hi Yi
>
>     I’m making very good progress thanks to the excellent support here
>     – thank you.
>
>     I have one problem.
>
>     One host I have does not “talk” first and therefore I need to
>     configure the MAC address and port manually.
>
>     I’ve tried to do this by including the MAC address and IP address
>     in the tofin-netcfg.json but I get this response from ONOS:
>
>     root at ONOS:~/fabric-tofino# make netcfg ONOS_HOST=localhost
>
>     *** Pushing tofino-netcfg.json to ONOS at localhost...
>
>     curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -H
>     'Content-Type:application/json' \
>
>     http://localhost:8181/onos/v1/network/configuration
>     -d at ./tofino-netcfg.json <mailto:-d at ./tofino-netcfg.json>
>
>     {"code":207,"message":["Error parsing config
>     hosts/24:8A:07:B8:71:DB/None/basic: Field \"location\" is invalid:
>     Field is not allowed"]}
>
>     This is the Tofino-netcfg.json file:
>
>     {
>
>     "layouts" : { },
>
>     "devices" : {
>
>     "device:my-tofino-switch" : {
>
>     "basic" : {
>
>     "managementAddress" : "grpc://10.5.23.21:28000?device_id=1
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.5.23.21%3A28000%2F%3Fdevice_id%3D1&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900967579&sdata=1z6t5%2F0nEu6IesGD3v7Mlc3bygg2oX34e3gw4mqMcTo%3D&reserved=0>",
>
>     "driver" : "stratum-tofino",
>
>     "pipeconf" : "org.opencord.fabric-spgw.tofino.montara_sde_9_0_0"
>
>     },
>
>     "segmentrouting": {
>
>     "name": "edge1",
>
>     "ipv4NodeSid": 101,
>
>     "ipv4Loopback": "192.168.1.1",
>
>     "routerMac": "00:AA:00:00:00:01",
>
>     "isEdgeRouter": true,
>
>     "adjacencySids": []
>
>     }
>
>     }
>
>     },
>
>     "hosts" : {
>
>     "24:8a:07:b8:71:db/None": {
>
>     "basic":{
>
>     "ips":["10.0.40.3"],
>
>     "location": "device:my-tofino-switch/136"
>
>     }
>
>     }
>
>     },
>
>     "apps" : { },
>
>     "ports" : {
>
>     "device:my-tofino-switch/128" : {
>
>     "interfaces" : [{
>
>     "name" : "Port 1",
>
>     "ips" : [ "10.0.30.254/24
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900967579&sdata=3tk7gqYbyPxyMo9kM%2B1BrwpCWEUVMK0oBpzuSOhJYxI%3D&reserved=0>"],
>
>     "vlan-untagged": 30,
>
>        "mac" : "00:AA:00:00:00:01"
>
>     }]
>
>     },
>
>     "device:my-tofino-switch/136" : {
>
>     "interfaces" : [{
>
>     "name" : "Port 2 ",
>
>     "ips" : [ "10.0.40.254/24
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900977573&sdata=6nCu94l88slhrVcujMMgYeZpnitEHHXGciWWdtZIIqw%3D&reserved=0>"],
>
>     "vlan-untagged": 40,
>
>     "mac" : "00:AA:00:00:00:01"
>
>     }]
>
>     },
>
>     "device:my-tofino-switch/144" : {
>
>     "interfaces" : [{
>
>     "name" : "Port 3 ",
>
>     "ips" : [ "10.0.10.254/24
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.10.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900977573&sdata=Cjm1K023GWBTRRdHlArhos9fgjMTcgExy2zAyCsl1NM%3D&reserved=0>"],
>
>     "vlan-untagged": 10,
>
>     "mac" : "00:AA:00:00:00:01"
>
>     }]
>
>     },
>
>     "device:my-tofino-switch/152" : {
>
>     "interfaces" : [{
>
>     "name" : "Port 4 ",
>
>     "ips" : [ "10.0.20.254/24
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.20.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900987567&sdata=Y2wmB76VXMC6fbHUvgIkyXV8pVgnpRBy9G9q%2Fj6BOtY%3D&reserved=0>"],
>
>     "vlan-untagged": 20,
>
>     "mac" : "00:AA:00:00:00:01"
>
>     }]
>
>     },
>
>     "device:my-tofino-switch/12" : {
>
>     "interfaces" : [{
>
>     "name" : "Port 15/1",
>
>     "ips" : [ "10.0.30.254/24
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900987567&sdata=xa23G3EIkwzMYm54B3DlgjsWKc3nuHVomSD9w9qGOIs%3D&reserved=0>"],
>
>     "vlan-untagged": 30,
>
>     "mac" : "00:AA:00:00:00:01"
>
>     }]
>
>     },
>
>     "device:my-tofino-switch/48" : {
>
>     "interfaces" : [{
>
>     "name" : "Port 23/1",
>
>     "ips" : [ "10.0.40.254/24
>     <https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=wozWawfrjihc%2FDVNMZXNlBIRPWyktdMnmLcGOq9xGYw%3D&reserved=0>"],
>
>     "vlan-untagged": 40,
>
>     "mac" : "00:AA:00:00:00:01"
>
>     }]
>
>     }
>
>     },
>
>     "regions" : { },
>
>     "links" : { }
>
>     }
>
>     Thank you
>
>     David
>
>     *From:*Yi Tseng <yi at opennetworking.org
>     <mailto:yi at opennetworking.org>>
>     *Sent:* 20 July 2020 19:13
>     *To:* Lake, David (PG/R - Elec Electronic Eng)
>     <d.lake at surrey.ac.uk <mailto:d.lake at surrey.ac.uk>>
>     *Cc:* stratum-dev at lists.stratumproject.org
>     <mailto:stratum-dev at lists.stratumproject.org>; P4 brigade
>     <brigade-p4 at onosproject.org <mailto:brigade-p4 at onosproject.org>>;
>     Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk
>     <mailto:s.vural at surrey.ac.uk>>
>     *Subject:* Re: [stratum-dev] Issues with Configuring Wedge
>     100bf-32x with ONOS
>
>     Hi David,
>
>     Please find the config file attached, and modify it based on your
>     requirements.
>
>     Also, you can follow the Trellis Configuration Guide
>     <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.trellisfabric.org%2F1.12%2Fconfiguration%2Fbridging-unicast.html&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=5Lb35r7ES7N6%2BZrlKS3VsuG405DwxaLYjDJtgtCsZ6g%3D&reserved=0> for
>     more information about how to config the ONOS Trellis application.
>
>     Yi
>
>     On Sat, Jul 18, 2020 at 12:55 PM David Lake via stratum-dev
>     <stratum-dev at lists.stratumproject.org
>     <mailto:stratum-dev at lists.stratumproject.org>> wrote:
>
>         Hello
>
>         Thank you for you help so far. I now need some more guidance
>         please.
>
>         I have a Wedge 100BF-32x running ONL and the Stratum Docker
>         container with ONOS 2.2.3 and the fabric-tofino pipeconf.
>
>         When I set the CHASSIS_CONFIG for the switch and start the
>         container, I see errors regarding the fan configuration from
>         the switch (see “start-stratum2.txt” log file).
>
>         Eventually, these timeout and the switch becomes available
>         (about 10 minutes to start).
>
>
>         However, when I add to ONOS using the netcfg command I see
>         errors and the ports show as “Enabled – False” in ONOS.   My
>         netfg log is attached as “necfg.txt.”
>
>         What I need to do is to set up the switch with 4 subnets
>         across the 32 ports.  I’m trying to find an example
>         configuration and some worked tutorials/user-guides.
>
>         Can someone please point me to some sample configs for similar
>         environments please and tell me where I am going wrong with
>         the configuration?
>
>
>         Thanks
>
>         David
>
>         _______________________________________________
>         stratum-dev mailing list
>         stratum-dev at lists.stratumproject.org
>         <mailto:stratum-dev at lists.stratumproject.org>
>         https://lists.stratumproject.org/listinfo/stratum-dev
>         <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562900997561&sdata=eIUfqyy6yKwX8j1jAFjmRaHnervOudHewT8zx6bAWc4%3D&reserved=0>
>
>
>     --
>
>     Yi Tseng
>
>     Member of Technical Staff
>
>     Open Networking Foundation
>
>     https://www.opennetworking.org/
>     <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562901007556&sdata=jbGuUi%2BAL39463kZb5vr%2F7%2F0jn8MT4HcDfFYSsKoiYo%3D&reserved=0>
>
>
> --
>
> Yi Tseng
>
> Member of Technical Staff
>
> Open Networking Foundation
>
> https://www.opennetworking.org/
> <https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C35708559811f4952248d08d82f7d6486%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637311562901007556&sdata=jbGuUi%2BAL39463kZb5vr%2F7%2F0jn8MT4HcDfFYSsKoiYo%3D&reserved=0>
>
>
> N�n�r����)em�h�yhiם�w^���
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200728/eed69e6b/attachment-0001.html>

From d.lake at surrey.ac.uk  Tue Jul 28 18:10:59 2020
From: d.lake at surrey.ac.uk (David Lake)
Date: Tue, 28 Jul 2020 18:10:59 +0000
Subject: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS
In-Reply-To: <c9899aa2-85cd-3053-4bbb-5cae08c7a04c@gmx.de>
References: <01010173637f0d62-1e929819-a329-4a92-a7c0-7ee897eccc6c-000000@us-west-2.amazonses.com>
 <CAOyFVR2byLofiuWy6XpQDvNThKE3vm90AKPz-P=zzYEK44Lyig@mail.gmail.com>
 <VI1PR06MB521432D807DDB1B3C494AD6AB5760@VI1PR06MB5214.eurprd06.prod.outlook.com>
 <CAOyFVR1N8Oq7qMeo=8ANP1UkYRuBNGmhC0mhWJk2o47njkraow@mail.gmail.com>
 <010101739675e63d-2e337869-9b15-4520-b407-900b3772fad9-000000@us-west-2.amazonses.com>
 <c9899aa2-85cd-3053-4bbb-5cae08c7a04c@gmx.de>
Message-ID: <VI1PR06MB52149371E16A234FDCE0045EB5730@VI1PR06MB5214.eurprd06.prod.outlook.com>

Thank you – I missed that completely!

David

From: David Gengenbach <davidgengenbach at gmx.de>
Sent: 28 July 2020 19:00
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk>; Yi Tseng <yi at opennetworking.org>
Cc: Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk>; stratum-dev at lists.stratumproject.org; P4 brigade <brigade-p4 at onosproject.org>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS


Try doing it with an array (as described by Yi Tseng):

"locations": ["device:my-tofino-switch/136"]
On 7/28/20 7:26 PM, David Lake via stratum-dev wrote:
Hi Yi

I’ve changed to “locations” but I’m getting this message when I try to send the netcfg:

{"code":207,"message":["Error parsing config hosts/24:8A:07:B8:71:DB/None/basic: class com.fasterxml.jackson.databind.node.TextNode cannot be cast to class com.fasterxml.jackson.databind.node.ArrayNode (com.fasterxml.jackson.databind.node.TextNode and com.fasterxml.jackson.databind.node.ArrayNode are in unnamed module of loader org.apache.felix.framework.BundleWiringImpl$BundleClassLoader @9942f40)"]}

The “hosts” section is:

  "hosts" : {
    "24:8a:07:b8:71:db/None": {
      "basic":{
       "ips":["10.0.40.3"],
       "locations": "device:my-tofino-switch/136"
      }
    }
  },


Thanks

David

From: Yi Tseng <yi at opennetworking.org><mailto:yi at opennetworking.org>
Sent: 24 July 2020 03:58
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk><mailto:d.lake at surrey.ac.uk>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>; P4 brigade <brigade-p4 at onosproject.org><mailto:brigade-p4 at onosproject.org>; Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk><mailto:s.vural at surrey.ac.uk>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS

Hi David,

Please try "locations": ["device:my-tofino-switch/136"]

Yi

On Thu, Jul 23, 2020 at 3:16 PM David Lake <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>> wrote:
Hi Yi

I’m making very good progress thanks to the excellent support here – thank you.

I have one problem.

One host I have does not “talk” first and therefore I need to configure the MAC address and port manually.

I’ve tried to do this by including the MAC address and IP address in the tofin-netcfg.json but I get this response from ONOS:

root at ONOS:~/fabric-tofino# make netcfg ONOS_HOST=localhost
*** Pushing tofino-netcfg.json to ONOS at localhost...
curl --fail -sSL --user onos:rocks --noproxy localhost -X POST -H 'Content-Type:application/json' \
        http://localhost:8181/onos/v1/network/configuration -d at ./tofino-netcfg.json<mailto:-d at ./tofino-netcfg.json>
{"code":207,"message":["Error parsing config hosts/24:8A:07:B8:71:DB/None/basic: Field \"location\" is invalid: Field is not allowed"]}


This is the Tofino-netcfg.json file:

{
  "layouts" : { },
  "devices" : {
    "device:my-tofino-switch" : {
      "basic" : {
        "managementAddress" : "grpc://10.5.23.21:28000?device_id=1<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.5.23.21%3A28000%2F%3Fdevice_id%3D1&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940222314&sdata=FRPfFuYmGak9Zmc%2B3fJ%2BFovqBW0nbyV0IrjTWJLs0mw%3D&reserved=0>",
        "driver" : "stratum-tofino",
        "pipeconf" : "org.opencord.fabric-spgw.tofino.montara_sde_9_0_0"
      },
  "segmentrouting": {
    "name": "edge1",
    "ipv4NodeSid": 101,
    "ipv4Loopback": "192.168.1.1",
    "routerMac": "00:AA:00:00:00:01",
    "isEdgeRouter": true,
    "adjacencySids": []
  }
  }
  },
  "hosts" : {
    "24:8a:07:b8:71:db/None": {
      "basic":{
       "ips":["10.0.40.3"],
       "location": "device:my-tofino-switch/136"
      }
    }
  },
  "apps" : { },
  "ports" : {
  "device:my-tofino-switch/128" : {
      "interfaces" : [{
        "name" : "Port 1",
        "ips" : [ "10.0.30.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940232307&sdata=Qe4hdzGW9epgjnJPLYAFr6VZsvAV8OfnV%2BAdlwcIQOo%3D&reserved=0>"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/136" : {
      "interfaces" : [{
        "name" : "Port 2 ",
        "ips" : [ "10.0.40.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940242300&sdata=QY3M22cI6Kf5GNDZUrcEpLTw9beZw1XjBXlloWhDpeY%3D&reserved=0>"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/144" : {
      "interfaces" : [{
        "name" : "Port 3 ",
        "ips" : [ "10.0.10.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.10.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940242300&sdata=mRX80FjLMflN7xMBDBFB6oK1uFs5uHKK%2FZbBFItuv8Y%3D&reserved=0>"],
        "vlan-untagged": 10,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/152" : {
      "interfaces" : [{
        "name" : "Port 4 ",
        "ips" : [ "10.0.20.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.20.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940252293&sdata=i89%2FSDdFgDTBkS5agOz1cGUhn2nOW3IvhV6og5UgbAs%3D&reserved=0>"],
        "vlan-untagged": 20,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
  "device:my-tofino-switch/12" : {
      "interfaces" : [{
        "name" : "Port 15/1",
        "ips" : [ "10.0.30.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.30.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940252293&sdata=Z%2BgrKryrlkqgTkvEi3rNbmSDORbeForuUyA4peQwcUE%3D&reserved=0>"],
        "vlan-untagged": 30,
        "mac" : "00:AA:00:00:00:01"
      }]
    },
    "device:my-tofino-switch/48" : {
      "interfaces" : [{
        "name" : "Port 23/1",
        "ips" : [ "10.0.40.254/24<https://eur02.safelinks.protection.outlook.com/?url=http%3A%2F%2F10.0.40.254%2F24&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940262288&sdata=y%2FhffX0RnBDKX22f2sWpJiZhN%2BPW1VXPfE0W14teUAI%3D&reserved=0>"],
        "vlan-untagged": 40,
        "mac" : "00:AA:00:00:00:01"
      }]
    }
   },
  "regions" : { },
  "links" : { }
}

Thank you

David

From: Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>
Sent: 20 July 2020 19:13
To: Lake, David (PG/R - Elec Electronic Eng) <d.lake at surrey.ac.uk<mailto:d.lake at surrey.ac.uk>>
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>; P4 brigade <brigade-p4 at onosproject.org<mailto:brigade-p4 at onosproject.org>>; Vural, Serdar Dr (Elec Electronic Eng) <s.vural at surrey.ac.uk<mailto:s.vural at surrey.ac.uk>>
Subject: Re: [stratum-dev] Issues with Configuring Wedge 100bf-32x with ONOS

Hi David,

Please find the config file attached, and modify it based on your requirements.

Also, you can follow the Trellis Configuration Guide<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.trellisfabric.org%2F1.12%2Fconfiguration%2Fbridging-unicast.html&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940262288&sdata=THD19MzWYpZ5enAzUf0cei45Hdrlf9woOAejXFaSdJQ%3D&reserved=0> for more information about how to config the ONOS Trellis application.

Yi

On Sat, Jul 18, 2020 at 12:55 PM David Lake via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
Hello

Thank you for you help so far.  I now need some more guidance please.

I have a Wedge 100BF-32x running ONL and the Stratum Docker container with ONOS 2.2.3 and the fabric-tofino pipeconf.

When I set the CHASSIS_CONFIG for the switch and start the container, I see errors regarding the fan configuration from the switch (see “start-stratum2.txt” log file).

Eventually, these timeout and the switch becomes available (about 10 minutes to start).

However, when I add to ONOS using the netcfg command I see errors and the ports show as “Enabled – False” in ONOS.   My netfg log is attached as “necfg.txt.”

What I need to do is to set up the switch with 4 subnets across the 32 ports.  I’m trying to find an example configuration and some worked tutorials/user-guides.

Can someone please point me to some sample configs for similar environments please and tell me where I am going wrong with the configuration?

Thanks

David


_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flists.stratumproject.org%2Flistinfo%2Fstratum-dev&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940272283&sdata=ZV7bIei%2F5g091nB9vsUloyKZ3ZoLg34DQ%2Brlrv9rr1A%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940272283&sdata=5hE%2B6RUPbwymLxD7zws%2Fx7hdlnsMdamRPmZyhTY%2FpKc%3D&reserved=0>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/<https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.opennetworking.org%2F&data=02%7C01%7Cd.lake%40surrey.ac.uk%7C1459e90c0bee4318950f08d8332006a0%7C6b902693107440aa9e21d89446a2ebb5%7C0%7C0%7C637315559940272283&sdata=5hE%2B6RUPbwymLxD7zws%2Fx7hdlnsMdamRPmZyhTY%2FpKc%3D&reserved=0>



N�n�r����)em�h�yhiם�w^���
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200728/d7409e9c/attachment-0001.html>

