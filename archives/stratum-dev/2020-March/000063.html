<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [stratum-dev] Update Bazel version to 2.2.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:stratum-dev%40lists.stratumproject.org?Subject=Re%3A%20%5Bstratum-dev%5D%20Update%20Bazel%20version%20to%202.2.0&In-Reply-To=%3Caf63ef5e59324f66b4688b18bd9c9f27%40kau.se%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000062.html">
   <LINK REL="Next"  HREF="000064.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[stratum-dev] Update Bazel version to 2.2.0</H1>
    <B>Deval Bhamare</B> 
    <A HREF="mailto:stratum-dev%40lists.stratumproject.org?Subject=Re%3A%20%5Bstratum-dev%5D%20Update%20Bazel%20version%20to%202.2.0&In-Reply-To=%3Caf63ef5e59324f66b4688b18bd9c9f27%40kau.se%3E"
       TITLE="[stratum-dev] Update Bazel version to 2.2.0">Deval.Bhamare at kau.se
       </A><BR>
    <I>Thu Mar 26 22:53:01 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000062.html">[stratum-dev] Update Bazel version to 2.2.0
</A></li>
        <LI>Next message (by thread): <A HREF="000064.html">[stratum-dev] Update Bazel version to 2.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63">[ date ]</a>
              <a href="thread.html#63">[ thread ]</a>
              <a href="subject.html#63">[ subject ]</a>
              <a href="author.html#63">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Yi,


I am running both ONOS and stratum container on the same machine, that is the tofino switch with public IP 192.168.60.131.


So I tried with <A HREF="grpc://192.168.60.131:28000?device_id=1&lt;http://192.168.0.101:28000/?device_id=1">grpc://192.168.60.131:28000?device_id=1&lt;http://192.168.0.101:28000/?device_id=1</A>&gt;&quot;, as well now. This time message is connection refused and still no connectivity.




2020-03-26T22:41:19,713 | WARN  | onos-device-manager-background | DeviceManager                    | 193 - org.onosproject.onos-core-net - 2.4.0.SNAPSHOT | Node was instructed to be MASTER role for device:tofino, but this node cannot reach the device.  Relinquishing role.

2020-03-26T22:41:19,716 | INFO  | onos-gdp-0       | StreamClientImpl                 | 237 - org.onosproject.onos-protocols-p4runtime-ctl - 2.4.0.SNAPSHOT | Setting mastership on device:tofino... master=true, newElectionId=20, masterElectionId=null, sessionOpen=false

2020-03-26T22:41:19,718 | WARN  | onos-event-dispatch-default0 | ModelCache                       | 211 - org.onosproject._onos-gui2-base-jar - 2.4.0.SNAPSHOT | DeviceID device:tofino not found as a UiDevice

2020-03-26T22:41:19,718 | WARN  | onos-event-dispatch-default0 | ModelCache                       | 211 - org.onosproject._onos-gui2-base-jar - 2.4.0.SNAPSHOT | DeviceID device:tofino not found as a UiDevice

2020-03-26T22:41:19,718 | WARN  | onos-event-dispatch-default0 | ModelCache                       | 211 - org.onosproject._onos-gui2-base-jar - 2.4.0.SNAPSHOT | DeviceID device:tofino not found as a UiDevice

2020-03-26T22:41:19,737 | INFO  | onos-topo-build-1 | TopologyManager                  | 193 - org.onosproject.onos-core-net - 2.4.0.SNAPSHOT | Topology DefaultTopology{time=2264511977012, creationTime=1585262479736, computeCost=117691, clusters=0, devices=0, links=0} changed

2020-03-26T22:41:19,763 | INFO  | onos-gdp-0       | DeviceManager                    | 193 - org.onosproject.onos-core-net - 2.4.0.SNAPSHOT | Device device:tofino registered

2020-03-26T22:41:19,764 | WARN  | grpc-default-executor-0 | StreamClientImpl                 | 237 - org.onosproject.onos-protocols-p4runtime-ctl - 2.4.0.SNAPSHOT | device:tofino is unreachable (Connection refused: /192.168.60.131:28000)

2020-03-26T22:41:19,774 | INFO  | onos-topo-build-2 | TopologyManager                  | 193 - org.onosproject.onos-core-net - 2.4.0.SNAPSHOT | Topology DefaultTopology{time=2264549921343, creationTime=1585262479774, computeCost=101378, clusters=0, devices=0, links=0} changed


With <A HREF="grpc://127.0.0.1:28000?device_id=1&lt;http://192.168.0.101:28000/?device_id=1">grpc://127.0.0.1:28000?device_id=1&lt;http://192.168.0.101:28000/?device_id=1</A>&gt;&quot;, the error is


onosproject.onos-protocols-p4runtime-ctl - 2.4.0.SNAPSHOT | Error on StreamChannel RPC for device:tofino: UNAVAILABLE: Network closed for unknown reason


Also Stratum logs say


bf_switchd: processing P4 configuration...

P4 profile for dev_id 0


while starting, so I doubt device ID maybe 0 and hence tried with both device_id=1&lt;<A HREF="http://192.168.0.101:28000/?device_id=1">http://192.168.0.101:28000/?device_id=1</A>&gt; and device_id=&lt;<A HREF="http://192.168.0.101:28000/?device_id=1">http://192.168.0.101:28000/?device_id=1</A>&gt;0 but no luck.



Thanks,


Deval.

________________________________
From: Yi Tseng &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">yi at opennetworking.org</A>&gt;
Sent: Thursday, March 26, 2020 9:10:49 PM
To: Deval Bhamare
Cc: <A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>
Subject: Re: [stratum-dev] Update Bazel version to 2.2.0

Hi Deval,

Where you are running the ONOS controller? If you are running the ONOS controller on a server, you need to set the management address to your switch IP address.

For example, you run the ONOS on a server with IP address 192.168.0.100 and running the Stratum on a switch with IP address 192.168.0.101. (And I assume that you have connectivity between the server and the switch)

The netcfg.json will look like:

{
  &quot;devices&quot;: {
    &quot;device:tofino&quot;: {
      &quot;basic&quot;: {
        &quot;managementAddress&quot;: &quot;<A HREF="grpc://192.168.0.101:28000?device_id=1&lt;http://192.168.0.101:28000?device_id=1">grpc://192.168.0.101:28000?device_id=1&lt;http://192.168.0.101:28000?device_id=1</A>&gt;&quot;,
        &quot;driver&quot;: &quot;stratum-tofino&quot;,
        &quot;pipeconf&quot;: &quot;[your pipeconf name]&quot;
       }
    }
   }
}

Please also note that the device ID is 1 in the Stratum

Yi


On Thu, Mar 26, 2020 at 6:13 AM Deval Bhamare &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">Deval.Bhamare at kau.se</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">Deval.Bhamare at kau.se</A>&gt;&gt; wrote:

Hello Yi,


We have received a reply from Stordis and as per their suggestion, we can ignore the syseeprom error


You see only syseeprom errorr please ignore that :
Tcl server: listen socket created
Tcl server: bind done on port 8008, listening...
Tcl server: waiting for incoming connections...
sh: 1: onie-syseeprom: not found &lt;Ignore this error&gt;
Health monitor started
Operational mode set to ASIC



So, now when I try to push the netcfg.json for our device to Onos, I get following message:


2020-03-25T21:59:01,255 | INFO  | onos-gdp-0       | StreamClientImpl                 | 237 - org.onosproject.onos-protocols-p4runtime-ctl - 2.4.0.SNAPSHOT | Setting mastership on device:tofino... master=true, newElectionId=20, masterElectionId=null, sessionOpen=false

2020-03-25T21:59:01,258 | WARN  | onos-event-dispatch-default0 | ModelCache                       | 211 - org.onosproject._onos-gui2-base-jar - 2.4.0.SNAPSHOT | DeviceID device:tofino not found as a UiDevice

2020-03-25T21:59:01,258 | WARN  | onos-event-dispatch-default0 | ModelCache                       | 211 - org.onosproject._onos-gui2-base-jar - 2.4.0.SNAPSHOT | DeviceID device:tofino not found as a UiDevice

2020-03-25T21:59:01,263 | WARN  | onos-event-dispatch-default0 | ModelCache                       | 211 - org.onosproject._onos-gui2-base-jar - 2.4.0.SNAPSHOT | DeviceID device:tofino not found as a UiDevice

2020-03-25T21:59:01,276 | INFO  | onos-topo-build-1 | TopologyManager                  | 193 - org.onosproject.onos-core-net - 2.4.0.SNAPSHOT | Topology DefaultTopology{time=20452353961040, creationTime=1585173541276, computeCost=427068, clusters=0, devices=0, links=0} changed

2020-03-25T21:59:01,308 | INFO  | onos-gdp-0       | DeviceManager                    | 193 - org.onosproject.onos-core-net - 2.4.0.SNAPSHOT | Device device:tofino registered

2020-03-25T21:59:01,317 | WARN  | grpc-default-executor-1 | StreamClientImpl                 | 237 - org.onosproject.onos-protocols-p4runtime-ctl - 2.4.0.SNAPSHOT | Error on StreamChannel RPC for device:tofino: UNAVAILABLE: Network closed for unknown reason

2020-03-25T21:59:01,319 | INFO  | onos-topo-build-2 | TopologyManager                  | 193 - org.onosproject.onos-core-net - 2.4.0.SNAPSHOT | Topology DefaultTopology{time=20452397561034, creationTime=1585173541319, computeCost=112832, clusters=0, devices=0, links=0} changed



ONOS CLI show, device available=false.


<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">tofino at root</A> &gt; devices                                                        21:58:49

id=device:tofino, available=false, local-status=disconnected 37s ago, role=NONE, type=SWITCH, mfr=Barefoot Networks, hw=Tofino, sw=Stratum, serial=unknown, chassis=0, driver=stratum-tofino:vepg-pipeconf, locType=none, managementAddress=<A HREF="grpc://127.0.0.1:28000?device_id=0&lt;http://127.0.0.1:28000?device_id=0">grpc://127.0.0.1:28000?device_id=0&lt;http://127.0.0.1:28000?device_id=0</A>&gt;, name=device:tofino, p4DeviceId=0, protocol=P4Runtime, gNMI, gNOI



Netcfg.json contents are:

{
        &quot;devices&quot;: {
        &quot;device:tofino&quot;: {
        &quot;basic&quot;: {
        &quot;managementAddress&quot;: &quot;<A HREF="grpc://127.0.0.1?device_id=0&lt;http://127.0.0.1?device_id=0">grpc://127.0.0.1?device_id=0&lt;http://127.0.0.1?device_id=0</A>&gt;&quot;,
        &quot;driver&quot;: &quot;stratum-tofino&quot;,
        &quot;pipeconf&quot;: &quot;vepg-pipeconf&quot;
        }
        }
        }
        }


Command is:


curl --fail -sSL --user onos:rocks --noproxy localhost -v -X POST -H 'Content-Type:application/json' '<A HREF="http://localhost:8181/onos/v1/network/configuration">http://localhost:8181/onos/v1/network/configuration</A>' <A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">-d at .</A>/netcfg.json



Any idea what may be the issue?


Thanks,

Deval.


________________________________
From: Yi Tseng &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">yi at opennetworking.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">yi at opennetworking.org</A>&gt;&gt;
Sent: Tuesday, March 24, 2020 3:25:06 PM
To: Deval Bhamare
Cc: <A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&gt;
Subject: Re: [stratum-dev] Update Bazel version to 2.2.0

Hi Deval,

I am now working on updating the script to support the custom platform parameter&lt;<A HREF="https://github.com/stratum/stratum/pull/150">https://github.com/stratum/stratum/pull/150</A>&gt; since the Stratum cannot detect the platform without the ONLP.

Should be merged soon.

On Sat, Mar 21, 2020 at 1:28 AM Deval Bhamare &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">Deval.Bhamare at kau.se</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">Deval.Bhamare at kau.se</A>&gt;&gt; wrote:

Hello Yi,


I tried with the new image stratum-bf:8.9.1-3.16.56-OpenNetworkLinux, however, the error still persists:


+ KERNEL_VERSION=3.16.64-OpenNetworkLinux

+ DOCKER_IMAGE=stratumproject/stratum-bf

+ DOCKER_IMAGE_TAG=9.0.0-3.16.64-OpenNetworkLinux

++ uname -r

++ uname -r

+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux -v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so -v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1 -v /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so -v /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1 -v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so -v /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1 -v /lib/platform-config:/lib/platform-config -v /etc/onl:/etc/onl -p 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs stratumproject/stratum-bf:8.9.1-3.16.56-OpenNetworkLinux

Use default flag file

Cannot find /usr/local/share/stratum/x86-64-stordis-bf2556x-1t-r0.json



I also had peek at the script start-stratum-container.sh and found an option of ONLP_ARG=&quot;--env WITH_ONLP=false&quot;
. So I wanted to ask whether I can set this option with Docker to force BSP usage, let us say, by hard-coding it in the script itself (also similar approach to set PORT_MAP in stratume_entrypoint.sh). I tried this and the error message in this case is:


Use default flag file

Cannot find /usr/local/share/stratum/.json

Please suggest.

Thanks,
Deval.

________________________________
From: Yi Tseng &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">yi at opennetworking.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">yi at opennetworking.org</A>&gt;&gt;
Sent: Thursday, March 12, 2020 6:57 AM
To: Deval Bhamare
Cc: Narada Hess; <A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&gt;
Subject: Re: [stratum-dev] Update Bazel version to 2.2.0

Hi Deval,

We don't support Barefoot thrift APIs in Stratum. We support some Barefoot API like port API via gNMI and the chassis config.

For missing JSON file, I can confirm that our internal CI did not include the latest Stratum with kernel 3.16.56

I just rebuild it and uploaded the new container image to the Docker hub&lt;<A HREF="https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-c9d64c1a7c2853150532a5d3e14dac94aa79b63a4dffba16018322d971d65300?context=explore">https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-c9d64c1a7c2853150532a5d3e14dac94aa79b63a4dffba16018322d971d65300?context=explore</A>&gt;, feel free to let me know if the issue still exists.

About the missing library, can you run this command in your shell?

LD_LIBRARY_PATH=$BF_SDE_INSTALL/lib ldd ./bazel-bin/stratum/hal/bin/barefoot/stratum_bf

I think the system linker may have some issue to find the library.

The libavago.so.0 is a symbolic link to libavago.so. the libavago.so must also exists.
ls -al $BF_SDE_INSTALL/lib/libavago*
-rwxr-xr-x 1 root root 1185264 Mar 12 04:19 libavago.so
lrwxrwxrwx 1 root root      11 Mar 12 04:19 libavago.so.0 -&gt; libavago.so
lrwxrwxrwx 1 root root      11 Mar 12 04:19 libavago.so.0.0.0 -&gt; libavago.so




--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
<A HREF="https://www.opennetworking.org/">https://www.opennetworking.org/</A>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
<A HREF="https://www.opennetworking.org/">https://www.opennetworking.org/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.stratumproject.org/archives/stratum-dev/attachments/20200326/97c16ac9/attachment-0001.html">https://lists.stratumproject.org/archives/stratum-dev/attachments/20200326/97c16ac9/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000062.html">[stratum-dev] Update Bazel version to 2.2.0
</A></li>
	<LI>Next message (by thread): <A HREF="000064.html">[stratum-dev] Update Bazel version to 2.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63">[ date ]</a>
              <a href="thread.html#63">[ thread ]</a>
              <a href="subject.html#63">[ subject ]</a>
              <a href="author.html#63">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.stratumproject.org/listinfo/stratum-dev">More information about the stratum-dev
mailing list</a><br>
</body></html>
