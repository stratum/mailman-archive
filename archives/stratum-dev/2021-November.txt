From bocon at opennetworking.org  Thu Nov  4 21:08:04 2021
From: bocon at opennetworking.org (bocon at opennetworking.org)
Date: Thu, 04 Nov 2021 21:08:04 +0000
Subject: [stratum-dev] Canceled event with note: Stratum TST Meeting @ Thu
 Nov 11, 2021 1:30pm - 2pm (PST) (stratum-dev@lists.stratumproject.org)
Message-ID: <00000000000030647905cffcece5@google.com>

This event has been canceled with this note:
"ONF conflict next week. See you on Nov 18."

Title: Stratum TST Meeting
Stratum Technical Steering Team MeetingJoin Zoom  
Meetinghttps://onf.zoom.us/j/787501745?pwd=OHdtQVA3eXdoeThxZ0UzS1VVWEtxQT09Meeting  
ID: 787 501 745Passcode: 258532One tap mobile+13126266799,,787501745# US  
(Chicago)+19292056099,,787501745# US (New York)Agenda and Meeting  
Noteshttps://docs.google.com/document/d/1ret8Vbnl-xbLgNsnDEH-jWP2_WwDYym4zDn6me3tiTA/editThe  
plan is to reserve the 1st and 3rd Thursdays of each month for  
presentations and community updates. If you can only attend some of these  
meetings, those will be more interesting. The other meetings will be more  
informal&nbsp;sync ups to discuss current issues, progress, and status. You  
can see what presentations are planned by checking the agenda  
above.Supporting Slides and Previous  
Recordingshttps://drive.google.com/drive/folders/1ZeYp6RwIGYi9VnIctvnKF1c1NxiAXeOT----------------------------------------------------------------Dial  
by your location&nbsp; &nbsp; &nbsp; &nbsp; +1 312 626 6799 US  
(Chicago)&nbsp; &nbsp; &nbsp; &nbsp; +1 929 205 6099 US (New York)&nbsp;  
&nbsp; &nbsp; &nbsp; +1 301 715 8592 US (Germantown)&nbsp; &nbsp; &nbsp;  
&nbsp; +1 346 248 7799 US (Houston)&nbsp; &nbsp; &nbsp; &nbsp; +1 669 900  
6833 US (San Jose)&nbsp; &nbsp; &nbsp; &nbsp; +1 253 215 8782 US  
(Tacoma)&nbsp; &nbsp; &nbsp; &nbsp; 888 788 0099 US Toll-free&nbsp; &nbsp;  
&nbsp; &nbsp; 877 853 5247 US Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +61 2  
8015 6011 Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 3 7018 2005  
Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 7 3185 3730 Australia&nbsp; &nbsp;  
&nbsp; &nbsp; +61 8 6119 3900 Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 8  
7150 1149 Australia&nbsp; &nbsp; &nbsp; &nbsp; 1800 945 157 Australia  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 1800 893 423 Australia Toll-free&nbsp;  
&nbsp; &nbsp; &nbsp; +81 363 628 317 Japan&nbsp; &nbsp; &nbsp; &nbsp; +81  
524 564 439 Japan&nbsp; &nbsp; &nbsp; &nbsp; +81 3 4578 1488 Japan&nbsp;  
&nbsp; &nbsp; &nbsp; 0 800 100 5040 Japan Toll-free&nbsp; &nbsp; &nbsp;  
&nbsp; 00 663 381 4092 Japan Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +49 69  
7104 9922 Germany&nbsp; &nbsp; &nbsp; &nbsp; +49 30 5679 5800 Germany&nbsp;  
&nbsp; &nbsp; &nbsp; +49 69 3807 9883 Germany&nbsp; &nbsp; &nbsp; &nbsp;  
+49 695 050 2596 Germany&nbsp; &nbsp; &nbsp; &nbsp; 0 800 1800 150 Germany  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 0 800 000 6954 Germany Toll-free&nbsp;  
&nbsp; &nbsp; &nbsp; +886 (2) 7741 7473 Taiwan&nbsp; &nbsp; &nbsp; &nbsp;  
08 0909 9864 Taiwan Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +48 22 307 3488  
Poland&nbsp; &nbsp; &nbsp; &nbsp; +48 22 398 7356 Poland&nbsp; &nbsp;  
&nbsp; &nbsp; +48 22 306 5342 Poland&nbsp; &nbsp; &nbsp; &nbsp; 00 800 321  
1464 Poland Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 00 800 112 5171 Poland  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +44 208 080 6592 United Kingdom&nbsp;  
&nbsp; &nbsp; &nbsp; +44 330 088 5830 United Kingdom&nbsp; &nbsp; &nbsp;  
&nbsp; +44 131 460 1196 United Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203  
481 5237 United Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203 481 5240 United  
Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203 901 7895 United Kingdom&nbsp;  
&nbsp; &nbsp; &nbsp; +44 208 080 6591 United Kingdom&nbsp; &nbsp; &nbsp;  
&nbsp; 0 800 260 5801 United Kingdom Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 0  
800 031 5717 United Kingdom Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +353 1 536  
9320 Ireland&nbsp; &nbsp; &nbsp; &nbsp; +353 1 653 3895 Ireland&nbsp;  
&nbsp; &nbsp; &nbsp; +353 1 653 3897 Ireland&nbsp; &nbsp; &nbsp; &nbsp;  
+353 1 653 3898 Ireland&nbsp; &nbsp; &nbsp; &nbsp; +353 6 163 9031  
Ireland&nbsp; &nbsp; &nbsp; &nbsp; +353 1 240 8941 Ireland&nbsp; &nbsp;  
&nbsp; &nbsp; 1800 949 238 Ireland Toll-free&nbsp; &nbsp; &nbsp; &nbsp;  
1800 901 561 Ireland Toll-freeMeeting ID: 787 501 745Find your local  
number:  
https://onf.zoom.us/u/ad1osSbywU----------------------------------------------------------------If  
you would like to get added to the calendar invite, please ask Brian.
When: Thu Nov 11, 2021 1:30pm – 2pm Pacific Time - Los Angeles
Where: (Online conference room)-Zoom-3, MP-1-Large Conference Room (25)
Calendar: stratum-dev at lists.stratumproject.org
Who:
     * bocon at opennetworking.org - creator
     * max at opennetworking.org
     * bill at opennetworking.org
     * mohammed.habeeb at inventec.com
     * yi at opennetworking.org
     * carmelo at opennetworking.org
     * xiao.david at inventec.com
     * Rich Renner
     * Devjit Gopalpur
     * Alireza Ghaffarkhah
     * Leonid Khedyk
     * niloofar at opennetworking.org
     * hsuanchung.lee at qct.io
     * Arkadiy Shapiro
     * you at opennetworking.org
     * abhilash at opennetworking.org
     * David Gengenbach
     * siddesh at opennetworking.org
     * craig.stevens at dell.com
     * asydney007 at gmail.com
     * stratum-dev at lists.stratumproject.org
     * maksym.kovaliov at plvision.eu
     * maksym.tropets at plvision.eu
     * jeff_catlin at edge-core.com
     * chris.sommers at keysight.com
     * John L
     * cmace at extremenetworks.com
     * Poongovan Ponnavaikko


Invitation from Google Calendar: https://calendar.google.com/calendar/

You are receiving this courtesy email at the account  
stratum-dev at lists.stratumproject.org because you are an attendee of this  
event.

To stop receiving future updates for this event, decline this event.  
Alternatively you can sign up for a Google account at  
https://calendar.google.com/calendar/ and control your notification  
settings for your entire calendar.

Forwarding this invitation could allow any recipient to send a response to  
the organizer and be added to the guest list, or invite others regardless  
of their own invitation status, or to modify your RSVP. Learn more at  
https://support.google.com/calendar/answer/37135#forwarding
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211104/c42dedc6/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/calendar
Size: 10331 bytes
Desc: not available
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211104/c42dedc6/attachment-0001.ics>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: invite.ics
Type: application/ics
Size: 10498 bytes
Desc: not available
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211104/c42dedc6/attachment-0001.bin>

From aquispe at cttc.es  Tue Nov  9 09:34:00 2021
From: aquispe at cttc.es (Andy Nazario Quispe)
Date: Tue, 9 Nov 2021 10:34:00 +0100
Subject: [stratum-dev] Stratum on Cassini Edgecore AS7716-24SC
In-Reply-To: <12ca3d11-b7fe-ffd2-e062-68daa24954cd@cttc.es>
References: <0101017c08fb1e80-ae018d58-410d-4f97-a34b-781b27109366-000000@us-west-2.amazonses.com>
 <CACKOpDnqnTOP6HLvtDYXhDf6KXt6PsMFtjFjaFBaOsyN6NPHGg@mail.gmail.com>
 <12ca3d11-b7fe-ffd2-e062-68daa24954cd@cttc.es>
Message-ID: <adaa256f-ff8d-1cd4-af4e-4a79eec63207@cttc.es>

Helo team,

Ive just installed stratum from the edgecore customer page as suggested, 
i just want to know if the log that im having is expected, because i 
have a transceiver connected o the switch but is not comming up. Since i 
am able to interact with the stratum command line maybe its necessary to 
activate it somehow.

also i can see some stratum services

stratum_b 30547        root    7u  IPv6 547185      0t0  TCP 
localhost:28003 (LISTEN)
stratum_b 30547        root   18u  IPv6 560340      0t0  TCP 
localhost:28000 (LISTEN)
stratum_b 30547        root   19u  IPv6 560341      0t0  TCP *:28000 
(LISTEN)
stratum_b 30547        root   20u  IPv6 560342      0t0  TCP *:9339 (LISTEN)
stratum_b 30547        root   21u  IPv6 560343      0t0  TCP *:9559 (LISTEN)


start-stratum.shstratum_bcm_sdk6

---------------------------------------

root at localhost:/usr/bin# ./start-stratum.sh

+ rmmod linux_ngknet

rmmod: ERROR: Module linux_ngknet is not currently loaded

+ true

+ rmmod linux_ngbde

rmmod: ERROR: Module linux_ngbde is not currently loaded

+ true

+ rmmod linux_bcm_knet

rmmod: ERROR: Module linux_bcm_knet is not currently loaded

+ true

+ rmmod linux_user_bde

rmmod: ERROR: Module linux_user_bde is not currently loaded

+ true

+ rmmod linux_kernel_bde

rmmod: ERROR: Module linux_kernel_bde is not currently loaded

+ true

+ pushd /usr/lib/stratum/

/usr/lib/stratum /usr/bin

+ insmod linux-kernel-bde.ko

+ insmod linux-user-bde.ko

+ insmod linux-bcm-knet.ko default_mtu=3000

+ popd

/usr/bin

+ mknod /dev/linux-bcm-knet c 122 0

+ mknod /dev/linux-bcm-net c 123 0

+ mknod /dev/linux-bcm-diag c 124 0

+ ln -sf /dev/linux-bcm-diag /dev/linux-bcm-diag-full

+ mknod /dev/linux-uk-proxy c 125 0

+ mknod /dev/linux-bcm-core c 126 0

+ mknod /dev/linux-kernel-bde c 127 0

+ ln -sf /dev/linux-bcm-core /dev/linux-user-bde

+ sleep 1

+ mkdir -p /var/run/stratum /var/log/stratum

++ cat /etc/onl/platform

+ PLATFORM=x86-64-accton-as7716-24sc-r0

+ exec stratum_bcm_sdk6 
-base_bcm_chassis_map_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/base_bcm_chassis_map.pb.txt 
-chassis_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt 
-bcm_sdk_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/config.bcm 
-phal_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/phal_config.pb.txt 
-bcm_sdk_checkpoint_dir=/tmp/bcm_chkpt -log_dir=/var/log/stratum -v=0

I20211108 10:04:59.012786 12329 main.cc:75] Starting Stratum in 
STANDALONE mode for a Broadcom-based switch...

W20211108 10:04:59.012897 12329 credentials_manager.cc:45] Using 
insecure server credentials

I20211108 10:04:59.013089 12329 hal.cc:122] HAL sanity checks all passed.

I20211108 10:04:59.013103 12329 hal.cc:128] Setting up HAL in COLDBOOT 
mode...

I20211108 10:04:59.013156 12329 config_monitoring_service.cc:94] Pushing 
the saved chassis config read from 
/etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt...

I20211108 10:04:59.018501 12329 bcm_switch.cc:548] Chassis config 
verified successfully.

I20211108 10:04:59.019773 12329 onlp_wrapper.cc:99] Initializing ONLP.

I20211108 10:05:00.619822 12329 attribute_database.cc:213] PhalDB 
service is listening to localhost:28003...

I20211108 10:05:00.625010 12329 bcm_chassis_manager.cc:1082] Portmap:

Panel, logical (PORT_ID), physical (PC_PHYS_PORT_ID)

1,68,65

2,72,69

3,76,73

4,80,77

5,96,93

6, 106, 101

7, 110, 105

8, 114, 109

9, 118, 113

10, 122, 117

11, 126, 121

12, 130, 125

13,84,81

14,88,85

15,92,89

16, 102,97

17,38,37

18,34,33

19,46,45

20,42,41

21,54,53

22,50,49

23,62,61

24,58,57

25,5,5

26,1,1

27,13,13

28,9,9

29,21,21

30,17,17

31,25,25

32,29,29

Broadcom Command Monitor: Copyright (c) 1998-2020 Broadcom

Release: sdk-6.5.17 built 20200212 (Wed Feb 12 11:25:25 2020)

>From onlbuilder at buildsrv:/home/onlbuilder/bcm6/sdk-all-6.5.17

Platform: X86

OS: Unix (Posix)

DMA pool size: 33554432

Broadcom Command Monitor: Copyright (c) 1998-2020 Broadcom

Release: sdk-6.5.17 built 20200212 (Wed Feb 12 11:25:25 2020)

>From onlbuilder at buildsrv:/home/onlbuilder/bcm6/sdk-all-6.5.17

Platform: X86

OS: Unix (Posix)

I20211108 10:05:00.713551 12329 bcm_sdk_wrapper.cc:1152] Unit 0 is 
assigned to SOC device BCM56965_A1 found on PCI bus 1, PCI slot 0.

SOC unit 0 attached to PCI device BCM56965_A1

0:bcmi_xgs5_bfd_init: uKernel BFD application not available

0:bcmi_xgs5_bfd_init: uKernel BFD application not available

I20211108 10:05:02.680828 12329 bcm_sdk_wrapper.cc:1249] Unit 0 
initialized successfully (warm_boot: NO).

BCM.0> I20211108 10:05:02.795511 12404 bcm_sdk_wrapper.cc:446] Unit: 0 
Port: 1 Link: changed.

I20211108 10:05:02.796408 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 5 
Link: changed.

I20211108 10:05:02.797266 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 9 
Link: changed.

I20211108 10:05:02.798141 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 13 
Link: changed.

I20211108 10:05:02.799026 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 17 
Link: changed.

I20211108 10:05:02.799875 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 21 
Link: changed.

I20211108 10:05:02.800729 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 25 
Link: changed.

I20211108 10:05:02.801584 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 29 
Link: changed.

I20211108 10:05:02.802441 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 34 
Link: changed.

I20211108 10:05:02.803309 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 38 
Link: changed.

I20211108 10:05:02.804167 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 42 
Link: changed.

I20211108 10:05:02.805011 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 46 
Link: changed.

I20211108 10:05:02.805864 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 50 
Link: changed.

I20211108 10:05:02.806718 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 54 
Link: changed.

I20211108 10:05:02.807564 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 58 
Link: changed.

I20211108 10:05:02.808248 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 62 
Link: changed.

I20211108 10:05:02.808933 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 68 
Link: changed.

I20211108 10:05:02.809625 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 72 
Link: changed.

I20211108 10:05:02.810310 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 76 
Link: changed.

I20211108 10:05:02.810999 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 80 
Link: changed.

I20211108 10:05:02.811687 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 84 
Link: changed.

I20211108 10:05:02.812368 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 88 
Link: changed.

I20211108 10:05:02.813050 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 92 
Link: changed.

I20211108 10:05:02.813736 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 96 
Link: changed.

I20211108 10:05:02.814421 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
102 Link: changed.

I20211108 10:05:02.815111 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
106 Link: changed.

I20211108 10:05:02.815794 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
110 Link: changed.

I20211108 10:05:02.816483 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
114 Link: changed.

I20211108 10:05:02.817173 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
118 Link: changed.

I20211108 10:05:02.817863 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
122 Link: changed.

I20211108 10:05:02.818547 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
126 Link: changed.

I20211108 10:05:02.819236 12404 bcm_sdk_wrapper.cc:446] Unit: 0 Port: 
130 Link: changed.

W20211108 10:05:02.859207 12329 bcm_sdk_wrapper.cc:2750] Currently not 
explicitly enabling/disabling ACL stages for packets ingressing on 
internal and external ports.

I20211108 10:05:02.859934 12329 bcm_acl_manager.cc:370] ACL manager 
successfully configured ACLs for node with ID 1 mapped to unit 0.

I20211108 10:05:02.861675 12329 bcm_packetio_manager.cc:751] KNET 
interface knet-0-0 created for node with ID 1 (unit: 0, purpose: 
BCM_KNET_INTF_PURPOSE_CONTROLLER, vlan: 1, cpu_queue: 0, netif_id: 1, 
netif_index: 14, rx_thread_id: 140360019224320).

I20211108 10:05:02.861709 12329 bcm_switch.cc:64] Chassis config pushed 
successfully.

I20211108 10:05:02.861920 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 1, slot: 1, port: 26, unit: 0, 
logical_port: 1, speed: 100G): DOWN

I20211108 10:05:02.862005 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 5, slot: 1, port: 25, unit: 0, 
logical_port: 5, speed: 100G): DOWN

I20211108 10:05:02.862049 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 9, slot: 1, port: 28, unit: 0, 
logical_port: 9, speed: 100G): DOWN

I20211108 10:05:02.862088 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 13, slot: 1, port: 27, unit: 0, 
logical_port: 13, speed: 100G): DOWN

I20211108 10:05:02.862128 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 17, slot: 1, port: 30, unit: 0, 
logical_port: 17, speed: 100G): DOWN

I20211108 10:05:02.862165 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 21, slot: 1, port: 29, unit: 0, 
logical_port: 21, speed: 100G): DOWN

I20211108 10:05:02.862205 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 25, slot: 1, port: 31, unit: 0, 
logical_port: 25, speed: 100G): DOWN

I20211108 10:05:02.862243 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 29, slot: 1, port: 32, unit: 0, 
logical_port: 29, speed: 100G): DOWN

I20211108 10:05:02.862280 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 34, slot: 1, port: 18, unit: 0, 
logical_port: 34, speed: 100G): DOWN

I20211108 10:05:02.862318 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 38, slot: 1, port: 17, unit: 0, 
logical_port: 38, speed: 100G): DOWN

I20211108 10:05:02.862354 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 42, slot: 1, port: 20, unit: 0, 
logical_port: 42, speed: 100G): DOWN

I20211108 10:05:02.862390 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 46, slot: 1, port: 19, unit: 0, 
logical_port: 46, speed: 100G): DOWN

I20211108 10:05:02.862427 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 50, slot: 1, port: 22, unit: 0, 
logical_port: 50, speed: 100G): DOWN

I20211108 10:05:02.862464 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 54, slot: 1, port: 21, unit: 0, 
logical_port: 54, speed: 100G): DOWN

I20211108 10:05:02.862504 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 58, slot: 1, port: 24, unit: 0, 
logical_port: 58, speed: 100G): DOWN

I20211108 10:05:02.862542 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 62, slot: 1, port: 23, unit: 0, 
logical_port: 62, speed: 100G): DOWN

I20211108 10:05:02.862581 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 68, slot: 1, port: 1, unit: 0, 
logical_port: 68, speed: 100G): DOWN

I20211108 10:05:02.862619 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 72, slot: 1, port: 2, unit: 0, 
logical_port: 72, speed: 100G): DOWN

I20211108 10:05:02.862655 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 76, slot: 1, port: 3, unit: 0, 
logical_port: 76, speed: 100G): DOWN

I20211108 10:05:02.862692 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 80, slot: 1, port: 4, unit: 0, 
logical_port: 80, speed: 100G): DOWN

I20211108 10:05:02.862731 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 84, slot: 1, port: 13, unit: 0, 
logical_port: 84, speed: 100G): DOWN

I20211108 10:05:02.862771 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 88, slot: 1, port: 14, unit: 0, 
logical_port: 88, speed: 100G): DOWN

I20211108 10:05:02.862808 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 92, slot: 1, port: 15, unit: 0, 
logical_port: 92, speed: 100G): DOWN

I20211108 10:05:02.862845 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 96, slot: 1, port: 5, unit: 0, 
logical_port: 96, speed: 100G): DOWN

I20211108 10:05:02.862916 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 102, slot: 1, port: 16, unit: 0, 
logical_port: 102, speed: 100G): DOWN

I20211108 10:05:02.862951 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 106, slot: 1, port: 6, unit: 0, 
logical_port: 106, speed: 100G): DOWN

I20211108 10:05:02.862975 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 110, slot: 1, port: 7, unit: 0, 
logical_port: 110, speed: 100G): DOWN

I20211108 10:05:02.863004 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 114, slot: 1, port: 8, unit: 0, 
logical_port: 114, speed: 100G): DOWN

I20211108 10:05:02.863029 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 118, slot: 1, port: 9, unit: 0, 
logical_port: 118, speed: 100G): DOWN

I20211108 10:05:02.863051 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 122, slot: 1, port: 10, unit: 0, 
logical_port: 122, speed: 100G): DOWN

I20211108 10:05:02.863075 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 126, slot: 1, port: 11, unit: 0, 
logical_port: 126, speed: 100G): DOWN

I20211108 10:05:02.863098 12403 bcm_chassis_manager.cc:1865] State of 
SingletonPort (node_id: 1, port_id: 130, slot: 1, port: 12, unit: 0, 
logical_port: 130, speed: 100G): DOWN

I20211108 10:05:02.876415 12329 p4_service.cc:121] Pushing the saved 
forwarding pipeline configs read from 
/var/run/stratum/pipeline_cfg.pb.txt...

E20211108 10:05:02.876453 12329 utils.cc:110] 
StratumErrorSpace::ERR_FILE_NOT_FOUND: 
/var/run/stratum/pipeline_cfg.pb.txt not found.

E20211108 10:05:02.876721 12329 utils.cc:66] Return Error: 
ReadFileToString(filename, &text) failed with 
StratumErrorSpace::ERR_FILE_NOT_FOUND: 
/var/run/stratum/pipeline_cfg.pb.txt not found.

W20211108 10:05:02.876734 12329 p4_service.cc:130] No saved forwarding 
pipeline config found at /var/run/stratum/pipeline_cfg.pb.txt. This is 
normal when the switch is just installed and no master controller is 
connected yet.

E20211108 10:05:02.877027 12329 hal.cc:221] Stratum external facing 
services are listening to 0.0.0.0:28000, 0.0.0.0:9339, 0.0.0.0:9559, 
localhost:28000...

E20211108 10:05:02.890136 12329 hal.cc:363] 
StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed 
to connect to all addresses

E20211108 10:05:02.890266 12329 hal.cc:231] Error when checking in with 
procmon: Failed to check in with procmon: failed to connect to all 
addresses.

Thank you for your help.

On 23/09/2021 12:23, Andy Nazario Quispe wrote:
>
> Thank you for your help Brian, we are going to analyze what is the 
> best way to make it work.
>
> i will try to submit a PR as you suggested.
>
> Andy
>
> On 21/09/2021 18:00, Brian O'Connor wrote:
>> Hi Andy,
>>
>> Thanks for reaching out. Most of our testing was done on the first 
>> version of Cassini (AS7716-24*XC*) which has a Broadcom Tomahawk 
>> ASIC, so it works with both SDKLT and OpenNSA. However, I understand 
>> that all of the boxes shipping now are the -24*SC*, which has a 
>> Tomahawk+ ASIC. As I understand it, it's basically the same ASIC but 
>> with some minor differences (e.g. buffer size). Unfortunately, SDKLT 
>> and OpenNSA are not compiled with support for Tomahawk+. At least for 
>> OpenNSA, this is just a compiler flag when the binary is built by 
>> Broadcom that isn't enabled.
>>
>> We have a few options:
>>
>> 1) If you have access to the Broadcom SDK 6.5.x, you can compile the 
>> SDK with support for Tomahawk+ and use that instead of OpenNSA when 
>> you build Stratum. We have some instructions that could help you with 
>> this part if you need them. This is a good option if you plan to make 
>> modifications to Stratum or the SDE, and you already have an SDK 
>> agreement with Broadcom.
>>
>> 2) We have worked with Edgecore to create a Stratum container that 
>> supports Cassini for Stratum release. It can be downloaded from the 
>> Edgecore customer portal. This is probably the easiest approach to 
>> get started, but will make it somewhat difficult to build new 
>> versions of Stratum yourself (if you want to do that).
>>
>> 3) OpenBCM 
>> (https://github.com/Broadcom-Network-Switching-Software/OpenBCM) 
>> seems to contain the SDK sources (not just binary libraries), and we 
>> may be able to compile it with Tomahawk+ support. We haven't tried 
>> this yet, but it appears to share the same API as OpenNSA. This 
>> option would be good for making modifications to Stratum and the SDE, 
>> and it would not require an SDK agreement. It could be an interesting 
>> project if you want to try to tackle it.
>>
>> Either way, could you create an issue in the Stratum Github with the 
>> error? At a minimum, we should probably update the documentation to 
>> reflect this, and please feel free to submit a PR to that effect. :)
>>
>> Regarding the procmon log entries, these can be ignored. We already 
>> have an issue open to suppress these: 
>> https://github.com/stratum/stratum/issues/492
>> Procmon is a custom service that lets the Stratum process report its 
>> status and health; we don't run the service by default, so Stratum 
>> cannot connect to check in.
>>
>> Thanks!
>> Brian
>>
>> On Tue, Sep 21, 2021 at 11:30 AM Andy Nazario Quispe via stratum-dev 
>> <stratum-dev at lists.stratumproject.org> wrote:
>>
>>     Good day team.,
>>
>>     I am trying to install stratum on a Edgecore AS7716-24SC Cassini,
>>     i've installed ONLv2
>>
>>     root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     uname -a
>>     Linux localhost 4.14.49-OpenNetworkLinux #1 SMP Fri Jul 16
>>     22:03:27 UTC 2021 x86_64 GNU/Linux
>>     root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     cat /etc/onl/SWI
>>     images:ONL-onf-ONLPv2_ONL-OS_2021-07-16.2159-5195444_AMD64.swi
>>
>>     from the (https://github.com/stratum/stratum) it supports using
>>     SDKLT and OpenNSA
>>
>>           * Edgecore AS7716-24SC Cassini
>>
>>     root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     cat /etc/onl/platform
>>     x86-64-accton-as7716-24sc-r0
>>
>>     /But when running Stratum using docker it appears that only
>>     support openNSA but still having problems, i attach below some logs:/
>>
>>     //////////////////////    LOG ///////////////////////////////////
>>
>>     /root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     DOCKER_IMAGE_TAG=20.12-sdklt ./start-stratum-container.sh
>>     ++ awk '{print "-v " $1 ":" $1 " " }'
>>     ++ ls /lib/x86_64-linux-gnu/libonlp-platform-defaults.so
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
>>     /lib/x86_64-linux-gnu/libonlp-platform.so
>>     /lib/x86_64-linux-gnu/libonlp-platform.so.1
>>     /lib/x86_64-linux-gnu/libonlp.so /lib/x86_64-linux-gnu/libonlp.so.1
>>     + ONLP_MOUNT='-v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1
>>     -v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1
>>     '
>>     + LOG_DIR=/var/log/stratum
>>     ++ uname -r
>>     + KERNEL_VERSION=4.14.49-OpenNetworkLinux
>>     + DOCKER_IMAGE=stratumproject/stratum-bcm
>>     + DOCKER_IMAGE_TAG=20.12-sdklt
>>     ++ cat /etc/onl/platform
>>     + PLATFORM=x86-64-accton-as7716-24sc-r0
>>     + '[' -n '' ']'
>>     ++ uname -r
>>     ++ uname -r
>>     + docker run -it --rm --privileged --cap-add ALL --shm-size=512m
>>     --network host -v /dev:/dev -v /sys:/sys -v /run:/run -v
>>     /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1
>>     -v /lib/platform-config:/lib/platform-config -v /etc/onl:/etc/onl
>>     -v /var/log/stratum:/var/log/stratum
>>     stratumproject/stratum-bcm:20.12-sdklt
>>     + rmmod linux_bcm_knet
>>     + rmmod linux_user_bde
>>     + rmmod linux_kernel_bde
>>     + rmmod linux_ngknet
>>     rmmod: ERROR: Module linux_ngknet is not currently loaded
>>     + true
>>     + rmmod linux_ngbde
>>     rmmod: ERROR: Module linux_ngbde is not currently loaded
>>     + true
>>     + pushd /usr/lib/stratum/
>>     /usr/lib/stratum /
>>     + insmod linux_ngbde.ko
>>     + insmod linux_ngknet.ko default_mtu=3000
>>     + popd
>>     /
>>     + sleep 1
>>     + mkdir -p /var/run/stratum /var/log/stratum
>>     ++ cat /etc/onl/platform
>>     + PLATFORM=x86-64-accton-as7716-24sc-r0
>>     + exec stratum_bcm_sdklt
>>     -base_bcm_chassis_map_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/base_bcm_chassis_map.pb.txt
>>     -chassis_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt
>>     -bcm_sdk_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/SDKLT.yml
>>     -phal_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/phal_config.pb.txt
>>     -bcm_sdk_checkpoint_dir=/tmp/bcm_chkpt -log_dir=/var/log/stratum -v=0
>>     I20210921 10:56:45.051519     1 main.cc:75] Starting Stratum in
>>     STANDALONE mode for a Broadcom-based switch...
>>     W20210921 10:56:45.051666     1 credentials_manager.cc:45] Using
>>     insecure server credentials
>>     I20210921 10:56:45.051842     1 hal.cc:122] HAL sanity checks all
>>     passed.
>>     I20210921 10:56:45.051857     1 hal.cc:128] Setting up HAL in
>>     COLDBOOT mode...
>>     I20210921 10:56:45.051929     1 config_monitoring_service.cc:94]
>>     Pushing the saved chassis config read from
>>     /etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt...
>>     I20210921 10:56:45.055892     1 bcm_switch.cc:548] Chassis config
>>     verified successfully.
>>     I20210921 10:56:45.056475     1 onlp_wrapper.cc:99] Initializing
>>     ONLP.
>>     I20210921 10:56:47.094169     1 attribute_database.cc:213] PhalDB
>>     service is listening to localhost:28003...
>>     I20210921 10:56:47.100003     1 bcm_chassis_manager.cc:1080] Portmap:
>>     Panel, logical (PORT_ID), physical (PC_PHYS_PORT_ID)
>>       1,  68,  65
>>       2,  72,  69
>>       3,  76,  73
>>       4,  80,  77
>>       5,  96,  93
>>       6, 106, 101
>>       7, 110, 105
>>       8, 114, 109
>>       9, 118, 113
>>      10, 122, 117
>>      11, 126, 121
>>      12, 130, 125
>>      13,  84,  81
>>      14,  88,  85
>>      15,  92,  89
>>      16, 102,  97
>>      17,  38,  37
>>      18,  34,  33
>>      19,  46,  45
>>      20,  42,  41
>>      21,  54,  53
>>      22,  50,  49
>>      23,  62,  61
>>      24,  58,  57
>>      25,   5,   5
>>      26,   1,   1
>>      27,  13,  13
>>      28,   9,   9
>>      29,  21,  21
>>      30,  17,  17
>>      31,  25,  25
>>      32,  29,  29
>>     [<nounit>] bcma/sys/probe/ngbde/bcma_sys_probe.c:721
>>     bcma_sys_probe(): Warn: No devices found.
>>     E20210921 10:56:47.106837     1 bcm_sdk_wrapper.cc:985]
>>     StratumErrorSpace::ERR_INTERNAL: Could not find any supported device.
>>     E20210921 10:56:47.107417     1 bcm_chassis_manager.cc:1093]
>>     Return Error: bcm_sdk_interface_->InitializeSdk(
>>     FLAGS_bcm_sdk_config_file, FLAGS_bcm_sdk_config_flush_file,
>>     FLAGS_bcm_sdk_shell_log_file) failed with
>>     StratumErrorSpace::ERR_INTERNAL: Could not find any supported device.
>>     E20210921 10:56:47.107460     1 bcm_chassis_manager.cc:163]
>>     Return Error: InitializeBcmChips(base_bcm_chassis_map,
>>     target_bcm_chassis_map) failed with
>>     StratumErrorSpace::ERR_INTERNAL: Could not find any supported device.
>>     E20210921 10:56:47.107530     1 bcm_switch.cc:52] Return Error:
>>     bcm_chassis_manager_->PushChassisConfig(config) failed with
>>     StratumErrorSpace::ERR_INTERNAL: Could not find any supported device.
>>     E20210921 10:56:47.107575     1 error_buffer.cc:30]
>>     (config_monitoring_service.cc:124): Pushing saved chassis config
>>     failed: Could not find any supported device.
>>     E20210921 10:56:47.107643     1 hal.cc:136] Return Error:
>>     config_monitoring_service_->Setup(FLAGS_warmboot) failed with
>>     StratumErrorSpace::ERR_INTERNAL: Could not find any supported device.
>>     E20210921 10:56:47.107697     1 main.cc:115] Error when setting
>>     up Stratum HAL (but we will continue running): Could not find any
>>     supported device.
>>     E20210921 10:56:47.108387     1 hal.cc:221] Stratum external
>>     facing services are listening to 0.0.0.0:28000
>>     <http://0.0.0.0:28000>, 0.0.0.0:9339 <http://0.0.0.0:9339>,
>>     0.0.0.0:9559 <http://0.0.0.0:9559>, localhost:28000...
>>     E20210921 10:56:47.121865     1 hal.cc:363]
>>     StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon:
>>     failed to connect to all addresses
>>     E20210921 10:56:47.122002     1 hal.cc:231] Error when checking
>>     in with procmon: Failed to check in with procmon: failed to
>>     connect to all addresses.
>>
>>     /////////////////////////////////////////////////////////////////////////////////////////
>>
>>     root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     docker ps
>>     CONTAINER ID IMAGE COMMAND              CREATED
>>     STATUS              PORTS               NAMES
>>     749ea4456822 stratumproject/stratum-bcm:opennsa
>>     "start-stratum.sh"   45 seconds ago      Up 44
>>     seconds                           wizardly_mclean
>>
>>     root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     DOCKER_IMAGE_TAG=opennsa ./start-stratum-container.sh
>>     ++ awk '{print "-v " $1 ":" $1 " " }'
>>     ++ ls /lib/x86_64-linux-gnu/libonlp-platform-defaults.so
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
>>     /lib/x86_64-linux-gnu/libonlp-platform.so
>>     /lib/x86_64-linux-gnu/libonlp-platform.so.1
>>     /lib/x86_64-linux-gnu/libonlp.so /lib/x86_64-linux-gnu/libonlp.so.1
>>     + ONLP_MOUNT='-v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1
>>     -v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1
>>     '
>>     + LOG_DIR=/var/log/stratum
>>     ++ uname -r
>>     + KERNEL_VERSION=4.14.49-OpenNetworkLinux
>>     + DOCKER_IMAGE=stratumproject/stratum-bcm
>>     + DOCKER_IMAGE_TAG=opennsa
>>     ++ cat /etc/onl/platform
>>     + PLATFORM=x86-64-accton-as7716-24sc-r0
>>     + '[' -n '' ']'
>>     ++ uname -r
>>     ++ uname -r
>>     + docker run -it --rm --privileged --cap-add ALL --shm-size=512m
>>     --network host -v /dev:/dev -v /sys:/sys -v /run:/run -v
>>     /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so
>>     -v
>>     /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1
>>     -v /lib/platform-config:/lib/platform-config -v /etc/onl:/etc/onl
>>     -v /var/log/stratum:/var/log/stratum
>>     stratumproject/stratum-bcm:opennsa
>>     + rmmod linux_ngknet
>>     rmmod: ERROR: Module linux_ngknet is not currently loaded
>>     + true
>>     + rmmod linux_ngbde
>>     rmmod: ERROR: Module linux_ngbde is not currently loaded
>>     + true
>>     + rmmod linux_bcm_knet
>>     + rmmod linux_user_bde
>>     + rmmod linux_kernel_bde
>>     + pushd /usr/lib/stratum/
>>     /usr/lib/stratum /
>>     + insmod linux-kernel-bde.ko
>>     + insmod linux-user-bde.ko
>>     + insmod linux-bcm-knet.ko default_mtu=3000
>>     + popd
>>     /
>>     + mknod /dev/linux-bcm-knet c 122 0
>>     mknod: /dev/linux-bcm-knet: File exists
>>     + true
>>     + mknod /dev/linux-bcm-net c 123 0
>>     mknod: /dev/linux-bcm-net: File exists
>>     + true
>>     + mknod /dev/linux-bcm-diag c 124 0
>>     mknod: /dev/linux-bcm-diag: File exists
>>     + true
>>     + ln -sf /dev/linux-bcm-diag /dev/linux-bcm-diag-full
>>     + mknod /dev/linux-uk-proxy c 125 0
>>     mknod: /dev/linux-uk-proxy: File exists
>>     + true
>>     + mknod /dev/linux-bcm-core c 126 0
>>     mknod: /dev/linux-bcm-core: File exists
>>     + true
>>     + mknod /dev/linux-kernel-bde c 127 0
>>     mknod: /dev/linux-kernel-bde: File exists
>>     + true
>>     + ln -sf /dev/linux-bcm-core /dev/linux-user-bde
>>     + sleep 1
>>     + mkdir -p /var/run/stratum /var/log/stratum
>>     ++ cat /etc/onl/platform
>>     + PLATFORM=x86-64-accton-as7716-24sc-r0
>>     + exec stratum_bcm_opennsa
>>     -base_bcm_chassis_map_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/base_bcm_chassis_map.pb.txt
>>     -chassis_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt
>>     -bcm_sdk_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/SDKLT.yml
>>     -phal_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/phal_config.pb.txt
>>     -bcm_sdk_checkpoint_dir=/tmp/bcm_chkpt -log_dir=/var/log/stratum -v=0
>>     I20210921 10:51:41.514292     1 logging.cc:63] Stratum version 0
>>     built at 1970-01-01T00:00:00+00:00 on host redacted by user redacted.
>>     I20210921 10:51:41.514493     1 main.cc:75] Starting Stratum in
>>     STANDALONE mode for a Broadcom-based switch...
>>     W20210921 10:51:41.514609     1 credentials_manager.cc:44] Using
>>     insecure server credentials
>>     I20210921 10:51:41.515112     1 hal.cc:132] HAL sanity checks all
>>     passed.
>>     I20210921 10:51:41.515130     1 hal.cc:138] Setting up HAL in
>>     COLDBOOT mode...
>>     I20210921 10:51:41.515214     1 config_monitoring_service.cc:94]
>>     Pushing the saved chassis config read from
>>     /etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt...
>>     I20210921 10:51:41.529116     1 bcm_switch.cc:550] Chassis config
>>     verified successfully.
>>     I20210921 10:51:41.531240     1 onlp_wrapper.cc:99] Initializing
>>     ONLP.
>>     I20210921 10:51:43.126675     1 attribute_database.cc:210] PhalDB
>>     service is listening to localhost:28003...
>>     I20210921 10:51:43.144853     1 bcm_chassis_manager.cc:1080] Portmap:
>>     Panel, logical (PORT_ID), physical (PC_PHYS_PORT_ID)
>>       1,  68,  65
>>       2,  72,  69
>>       3,  76,  73
>>       4,  80,  77
>>       5,  96,  93
>>       6, 106, 101
>>       7, 110, 105
>>       8, 114, 109
>>       9, 118, 113
>>      10, 122, 117
>>      11, 126, 121
>>      12, 130, 125
>>      13,  84,  81
>>      14,  88,  85
>>      15,  92,  89
>>      16, 102,  97
>>      17,  38,  37
>>      18,  34,  33
>>      19,  46,  45
>>      20,  42,  41
>>      21,  54,  53
>>      22,  50,  49
>>      23,  62,  61
>>      24,  58,  57
>>      25,   5,   5
>>      26,   1,   1
>>      27,  13,  13
>>      28,   9,   9
>>      29,  21,  21
>>      30,  17,  17
>>      31,  25,  25
>>      32,  29,  29
>>     DMA pool size: 16777216
>>     Broadcom Command Monitor: Copyright (c) 1998-2020 Broadcom
>>     Release: opennsa-6.5.19 built 20200910 (Thu Sep 10 18:16:19 2020)
>>     From root at lc-sj1-5908:/projects/ntsw_sw18_scratch/sdkrel/openbcm/sdk
>>     Platform: X86
>>     OS: Unix (Posix)
>>     E20210921 10:51:43.176681     1 bcm_sdk_wrapper.cc:1152]
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:51:43.177083     1 bcm_chassis_manager.cc:1100]
>>     Return Error: bcm_sdk_interface_->FindUnit(bcm_chip.unit(),
>>     bcm_chip.pci_bus(), bcm_chip.pci_slot(), bcm_chip.type()) failed
>>     with StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:51:43.177101     1 bcm_chassis_manager.cc:163]
>>     Return Error: InitializeBcmChips(base_bcm_chassis_map,
>>     target_bcm_chassis_map) failed with
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:51:43.177136     1 bcm_switch.cc:52] Return Error:
>>     bcm_chassis_manager_->PushChassisConfig(config) failed with
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:51:43.177158     1 error_buffer.cc:30]
>>     (config_monitoring_service.cc:124): Pushing saved chassis config
>>     failed: 'soc_cm_device_supported(dev->device, dev->rev)' failed
>>     with error message: Feature unavailable.
>>     E20210921 10:51:43.177199     1 hal.cc:146] Return Error:
>>     config_monitoring_service_->Setup(FLAGS_warmboot) failed with
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:51:43.177212     1 main.cc:115] Error when setting
>>     up Stratum HAL (but we will continue running):
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:51:43.177973     1 hal.cc:231] Stratum external
>>     facing services are listening to 0.0.0.0:9339
>>     <http://0.0.0.0:9339>, 0.0.0.0:9559 <http://0.0.0.0:9559>,
>>     localhost:9559...
>>     E20210921 10:51:43.192323     1 hal.cc:386]
>>     StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon:
>>     failed to connect to all addresses
>>     E20210921 10:51:43.192685     1 hal.cc:241] Error when checking
>>     in with procmon: Failed to check in with procmon: failed to
>>     connect to all addresses.
>>
>>     //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
>>
>>     root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     docker ps
>>     CONTAINER ID IMAGE COMMAND              CREATED
>>     STATUS              PORTS               NAMES
>>     33acae8744da stratumproject/stratum-bcm:21.06-opennsa
>>     "start-stratum.sh"   8 minutes ago       Up 8
>>     minutes                            nifty_keller
>>
>>
>>     root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker#
>>     docker logs 33acae8744da
>>     + rmmod linux_ngknet
>>     rmmod: ERROR: Module linux_ngknet is not currently loaded
>>     + true
>>     + rmmod linux_ngbde
>>     rmmod: ERROR: Module linux_ngbde is not currently loaded
>>     + true
>>     + rmmod linux_bcm_knet
>>     + rmmod linux_user_bde
>>     + rmmod linux_kernel_bde
>>     + pushd /usr/lib/stratum/
>>     /usr/lib/stratum /
>>     + insmod linux-kernel-bde.ko
>>     + insmod linux-user-bde.ko
>>     + insmod linux-bcm-knet.ko default_mtu=3000
>>     + popd
>>     /
>>     + mknod /dev/linux-bcm-knet c 122 0
>>     mknod: /dev/linux-bcm-knet: File exists
>>     + true
>>     + mknod /dev/linux-bcm-net c 123 0
>>     mknod: /dev/linux-bcm-net: File exists
>>     + true
>>     + mknod /dev/linux-bcm-diag c 124 0
>>     mknod: /dev/linux-bcm-diag: File exists
>>     + true
>>     + ln -sf /dev/linux-bcm-diag /dev/linux-bcm-diag-full
>>     + mknod /dev/linux-uk-proxy c 125 0
>>     mknod: /dev/linux-uk-proxy: File exists
>>     + true
>>     + mknod /dev/linux-bcm-core c 126 0
>>     mknod: /dev/linux-bcm-core: File exists
>>     + true
>>     + mknod /dev/linux-kernel-bde c 127 0
>>     mknod: /dev/linux-kernel-bde: File exists
>>     + true
>>     + ln -sf /dev/linux-bcm-core /dev/linux-user-bde
>>     + sleep 1
>>     + mkdir -p /var/run/stratum /var/log/stratum
>>     ++ cat /etc/onl/platform
>>     + PLATFORM=x86-64-accton-as7716-24sc-r0
>>     + exec stratum_bcm_opennsa
>>     -base_bcm_chassis_map_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/base_bcm_chassis_map.pb.txt
>>     -chassis_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt
>>     -bcm_sdk_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/SDKLT.yml
>>     -phal_config_file=/etc/stratum/x86-64-accton-as7716-24sc-r0/phal_config.pb.txt
>>     -bcm_sdk_checkpoint_dir=/tmp/bcm_chkpt -log_dir=/var/log/stratum -v=0
>>     I20210921 10:38:53.986915     1 main.cc:75] Starting Stratum in
>>     STANDALONE mode for a Broadcom-based switch...
>>     W20210921 10:38:53.987057     1 credentials_manager.cc:45] Using
>>     insecure server credentials
>>     I20210921 10:38:53.987232     1 hal.cc:122] HAL sanity checks all
>>     passed.
>>     I20210921 10:38:53.987246     1 hal.cc:128] Setting up HAL in
>>     COLDBOOT mode...
>>     I20210921 10:38:53.987311     1 config_monitoring_service.cc:94]
>>     Pushing the saved chassis config read from
>>     /etc/stratum/x86-64-accton-as7716-24sc-r0/chassis_config.pb.txt...
>>     I20210921 10:38:53.991032     1 bcm_switch.cc:548] Chassis config
>>     verified successfully.
>>     I20210921 10:38:53.991549     1 onlp_wrapper.cc:99] Initializing
>>     ONLP.
>>     I20210921 10:38:56.135704     1 attribute_database.cc:213] PhalDB
>>     service is listening to localhost:28003...
>>     I20210921 10:38:56.141291     1 bcm_chassis_manager.cc:1080] Portmap:
>>     Panel, logical (PORT_ID), physical (PC_PHYS_PORT_ID)
>>       1,  68,  65
>>       2,  72,  69
>>       3,  76,  73
>>       4,  80,  77
>>       5,  96,  93
>>       6, 106, 101
>>       7, 110, 105
>>       8, 114, 109
>>       9, 118, 113
>>      10, 122, 117
>>      11, 126, 121
>>      12, 130, 125
>>      13,  84,  81
>>      14,  88,  85
>>      15,  92,  89
>>      16, 102,  97
>>      17,  38,  37
>>      18,  34,  33
>>      19,  46,  45
>>      20,  42,  41
>>      21,  54,  53
>>      22,  50,  49
>>      23,  62,  61
>>      24,  58,  57
>>      25,   5,   5
>>      26,   1,   1
>>      27,  13,  13
>>      28,   9,   9
>>      29,  21,  21
>>      30,  17,  17
>>      31,  25,  25
>>      32,  29,  29
>>     DMA pool size: 16777216
>>     Broadcom Command Monitor: Copyright (c) 1998-2020 Broadcom
>>     Release: opennsa-6.5.19 built 20200910 (Thu Sep 10 18:16:19 2020)
>>     From root at lc-sj1-5908:/projects/ntsw_sw18_scratch/sdkrel/openbcm/sdk
>>     Platform: X86
>>     OS: Unix (Posix)
>>     E20210921 10:38:56.175861     1 bcm_sdk_wrapper.cc:1151]
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:38:56.176177     1 bcm_chassis_manager.cc:1100]
>>     Return Error: bcm_sdk_interface_->FindUnit(bcm_chip.unit(),
>>     bcm_chip.pci_bus(), bcm_chip.pci_slot(), bcm_chip.type()) failed
>>     with StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:38:56.176189     1 bcm_chassis_manager.cc:163]
>>     Return Error: InitializeBcmChips(base_bcm_chassis_map,
>>     target_bcm_chassis_map) failed with
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:38:56.176213     1 bcm_switch.cc:52] Return Error:
>>     bcm_chassis_manager_->PushChassisConfig(config) failed with
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:38:56.176230     1 error_buffer.cc:30]
>>     (config_monitoring_service.cc:124): Pushing saved chassis config
>>     failed: 'soc_cm_device_supported(dev->device, dev->rev)' failed
>>     with error message: Feature unavailable.
>>     E20210921 10:38:56.176254     1 hal.cc:136] Return Error:
>>     config_monitoring_service_->Setup(FLAGS_warmboot) failed with
>>     StratumErrorSpace::ERR_FEATURE_UNAVAILABLE:
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:38:56.176263     1 main.cc:115] Error when setting
>>     up Stratum HAL (but we will continue running):
>>     'soc_cm_device_supported(dev->device, dev->rev)' failed with
>>     error message: Feature unavailable.
>>     E20210921 10:38:56.176653     1 hal.cc:221] Stratum external
>>     facing services are listening to 0.0.0.0:28000
>>     <http://0.0.0.0:28000>, 0.0.0.0:9339 <http://0.0.0.0:9339>,
>>     0.0.0.0:9559 <http://0.0.0.0:9559>, localhost:28000...
>>     E20210921 10:38:56.190089     1 hal.cc:363]
>>     StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon:
>>     failed to connect to all addresses
>>     E20210921 10:38:56.190270     1 hal.cc:231] Error when checking
>>     in with procmon: Failed to check in with procmon: failed to
>>     connect to all addresses.
>>     /
>>
>>     ////////////////////////////////////////////////////////
>>
>>     /also all the modules are added in the kermel :
>>     /
>>
>>     /root at localhost:/stratum/stratum/hal/bin/bcm/standalone/docker# lsmod
>>     Module                  Size  Used by
>>     linux_ngknet          356352  0
>>     linux_ngbde            36864  1 linux_ngknet
>>     /
>>
>>     /If you guys can help me why is it not running properly in any
>>     case it will be helpfull, from the logs i can tell that opoenNSA
>>     recgnizases the shipset at least but still having problems when
>>     running the code./
>>
>>     /Thanks in advance guys.
>>     /
>>
>>     /Andy/
>>     _______________________________________________
>>     stratum-dev mailing list
>>     stratum-dev at lists.stratumproject.org
>>     https://lists.stratumproject.org/listinfo/stratum-dev
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211109/e013ed92/attachment-0001.html>

From john.cheng at oprueba.com  Thu Nov 18 04:39:31 2021
From: john.cheng at oprueba.com (=?utf-8?B?6YSt5Luy57+U?=)
Date: Thu, 18 Nov 2021 04:39:31 +0000
Subject: [stratum-dev] Problems regarding the installation of stratum & SDE
 9.4.0 on Tofino switch
Message-ID: <HK0PR06MB3233C5CE1F8546A60E138E34819B9@HK0PR06MB3233.apcprd06.prod.outlook.com>

Hello everyone,

I encountered some problems during the installation of stratum & SDE 9.4.0 on Tofino switch and was unable to run stratum smoothly.

Environment:
Switch: Netberg Aurora 610
root at localhost:~# cat /etc/onl/platform
x86-64-netberg-aurora-610-r0

root at localhost:~# uname -a
Linux localhost 4.19.81-OpenNetworkLinux #1 SMP Wed Apr 21 09:25:49 UTC 2021 x86_64 GNU/Linux

root at localhost:~# lsmod
Module                  Size  Used by
bf_kdrv                28672  0
at24                   20480  0
x86_pkg_temp_thermal    16384  0
intel_pch_thermal      16384  0
optoe                  20480  0
vpd                    24576  0
swps                  147456  0
net_cpld               16384  0
net_psoc               24576  0
net_platform           16384  0
i2c_gpio               16384  0
lpc_ich                28672  0
gpio_ich               16384  3

I tried two ways to run ONOS + Stratum + Tofino, the steps are as followed:
• Pre-built Stratum binaries:
        On switch:
        1. Install ONL on Tofino Switch
        2. Install stratum on Tofino Switch by stratum_bf_deb.deb
        3. Start stratum using start-stratum.sh

        On ONOS server:
        1. Start ONOS Server
        2. Build and install my app to ONOS server
        (My app can work on stratum + bmv2. To run on physical switch, I just modify PipeconfLoader.java)
        3. Put network configuration to ONOS server

        So far, ONOS can connect to Tofino Switch with stratum. But for Install rule, Stratum returned an error:
        [libprotobuf FATAL external/com_google_protobuf/src/google/protobuf/repeated_field.h:1694] CHECK failed: (index) < (current_size_):
        I saw the solution and want to build a new stratum_bf_deb.deb by myself: https://github.com/stratum/stratum/pull/687

• Build Stratum Source code:
        It cannot compile stratum on Tofino Switch, so I tried to build the STRATUM package on another Debian machine.

        Prepare package:
                Stratum Packet: https://github.com/stratum/stratum
                P4-SDE: 9.4.0
                BSP: 9.4.0
                Linux-kernel-4.19.81

        On Debian:
        1. Download Stratum Source Code
        2. Start a temporary container by setup_dev_env.sh
        3. Copy require packages into a container (SDE, BSP, Linux-kernel)
        4. Compile SDE:
        ./p4studio_build.py -up profiles/stratum_profile.yaml -shc -kdir <path/to/linux/sources> --bsp-path $BSP_PATH
        5. Get Stratum package:
        bazel build --sandbox_debug --verbose_failures //stratum/hal/bin/barefoot:stratum_bf_deb

        In this step it returned the following error:
        Repository rule http_archive defined at:
                /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/bazel_tools/tools/build_defs/repo/http.bzl:336:31: in <toplevel>
        ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such target '@local_barefoot_bin//:bf_library_files': target 'bf_library_files' not declared in package '' defined by   /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
        ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such target '@local_barefoot_bin//:bf_shareable_files': target 'bf_shareable_files' not declared in package '' defined by       /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
        ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such target '@local_barefoot_bin//:kernel_module': target 'kernel_module' not declared in package '' defined by         /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
        ERROR: Analysis of target '//stratum/hal/bin/barefoot:stratum_bf_deb' failed; build aborted: Analysis failed
        INFO: Elapsed time: 0.148s
        INFO: 0 processes.
        FAILED: Build did NOT complete successfully (0 packages loaded, 0 targets configured)

        I am not sure how to solve the problem. Can anyone offer me your insight?

Thanks

John
Confidentiality Note
本郵件含有詮隼科技股份有限公司機密資訊、或受法律保護之資料，惟有原發信人指定之收信人得閱讀或使用本郵件之內容。如您並非被指定之收信人，請立即將本郵件及所有附件予以刪除；請勿揭露、儲存或使用本郵件之任何資訊，並請您立即告知原發信人本郵件的傳遞錯誤。謝謝您的合作。
This e-mail transmission and any attachments contain information from O'Prueba Technology Inc. The information is confidential and/or privileged and intended to be solely for the use of the individuals or entity named in this e-mail transmission. If you are not the intended recipient, be aware that any disclosure, saving or use of the contents of this e-mail transmission and attachments is strictly prohibited. If you have received this email transmission in error, please notify us immediately, and delete the e-mail and attachments. We greatly appreciate your cooperation.

From max at opennetworking.org  Thu Nov 18 05:08:40 2021
From: max at opennetworking.org (Maximilian Pudelko)
Date: Wed, 17 Nov 2021 21:08:40 -0800
Subject: [stratum-dev] Problems regarding the installation of stratum &
 SDE 9.4.0 on Tofino switch
In-Reply-To: <0101017d3157ca16-8cecf896-87c6-4182-b034-d9c5894d2d4f-000000@us-west-2.amazonses.com>
References: <0101017d3157ca16-8cecf896-87c6-4182-b034-d9c5894d2d4f-000000@us-west-2.amazonses.com>
Message-ID: <CAFh9Y_M2TNEXdcEGCZTn4jVmJArPOd6eg2fMSPDqxL9wKpFWxw@mail.gmail.com>

Hi John,

That bug you linked should be fixed by now and has been included in a few
releases. Can you verify
you're running the latest 2021-10-09 release from the release page
<https://github.com/stratum/stratum/releases>?
If this (or another) error still exists, that's worth investigating and
probably a new bug.

If you still want to build Stratum yourself, you should check out the
Stratum on Tofino build instructions here
<https://github.com/stratum/stratum/blob/main/stratum/hal/bin/barefoot/README.build.md#method-2-pre-build-the-sde-then-build-stratum-with-docker-recommended>
.
Method 2 or 3 seem close to what you're looking for.


Best,
Max


On Wed, Nov 17, 2021 at 8:39 PM 鄭仲翔 via stratum-dev <
stratum-dev at lists.stratumproject.org> wrote:

> Hello everyone,
>
> I encountered some problems during the installation of stratum & SDE 9.4.0
> on Tofino switch and was unable to run stratum smoothly.
>
> Environment:
> Switch: Netberg Aurora 610
> root at localhost:~# cat /etc/onl/platform
> x86-64-netberg-aurora-610-r0
>
> root at localhost:~# uname -a
> Linux localhost 4.19.81-OpenNetworkLinux #1 SMP Wed Apr 21 09:25:49 UTC
> 2021 x86_64 GNU/Linux
>
> root at localhost:~# lsmod
> Module                  Size  Used by
> bf_kdrv                28672  0
> at24                   20480  0
> x86_pkg_temp_thermal    16384  0
> intel_pch_thermal      16384  0
> optoe                  20480  0
> vpd                    24576  0
> swps                  147456  0
> net_cpld               16384  0
> net_psoc               24576  0
> net_platform           16384  0
> i2c_gpio               16384  0
> lpc_ich                28672  0
> gpio_ich               16384  3
>
> I tried two ways to run ONOS + Stratum + Tofino, the steps are as followed:
> • Pre-built Stratum binaries:
>         On switch:
>         1. Install ONL on Tofino Switch
>         2. Install stratum on Tofino Switch by stratum_bf_deb.deb
>         3. Start stratum using start-stratum.sh
>
>         On ONOS server:
>         1. Start ONOS Server
>         2. Build and install my app to ONOS server
>         (My app can work on stratum + bmv2. To run on physical switch, I
> just modify PipeconfLoader.java)
>         3. Put network configuration to ONOS server
>
>         So far, ONOS can connect to Tofino Switch with stratum. But for
> Install rule, Stratum returned an error:
>         [libprotobuf FATAL
> external/com_google_protobuf/src/google/protobuf/repeated_field.h:1694]
> CHECK failed: (index) < (current_size_):
>         I saw the solution and want to build a new stratum_bf_deb.deb by
> myself: https://github.com/stratum/stratum/pull/687
>
> • Build Stratum Source code:
>         It cannot compile stratum on Tofino Switch, so I tried to build
> the STRATUM package on another Debian machine.
>
>         Prepare package:
>                 Stratum Packet: https://github.com/stratum/stratum
>                 P4-SDE: 9.4.0
>                 BSP: 9.4.0
>                 Linux-kernel-4.19.81
>
>         On Debian:
>         1. Download Stratum Source Code
>         2. Start a temporary container by setup_dev_env.sh
>         3. Copy require packages into a container (SDE, BSP, Linux-kernel)
>         4. Compile SDE:
>         ./p4studio_build.py -up profiles/stratum_profile.yaml -shc -kdir
> <path/to/linux/sources> --bsp-path $BSP_PATH
>         5. Get Stratum package:
>         bazel build --sandbox_debug --verbose_failures
> //stratum/hal/bin/barefoot:stratum_bf_deb
>
>         In this step it returned the following error:
>         Repository rule http_archive defined at:
>
> /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/bazel_tools/tools/build_defs/repo/http.bzl:336:31:
> in <toplevel>
>         ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such
> target '@local_barefoot_bin//:bf_library_files': target 'bf_library_files'
> not declared in package '' defined by
>  /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD
> and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
>         ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such
> target '@local_barefoot_bin//:bf_shareable_files': target
> 'bf_shareable_files' not declared in package '' defined by
>  /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD
> and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
>         ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such
> target '@local_barefoot_bin//:kernel_module': target 'kernel_module' not
> declared in package '' defined by
>  /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD
> and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
>         ERROR: Analysis of target
> '//stratum/hal/bin/barefoot:stratum_bf_deb' failed; build aborted: Analysis
> failed
>         INFO: Elapsed time: 0.148s
>         INFO: 0 processes.
>         FAILED: Build did NOT complete successfully (0 packages loaded, 0
> targets configured)
>
>         I am not sure how to solve the problem. Can anyone offer me your
> insight?
>
> Thanks
>
> John
> Confidentiality Note
>
> 本郵件含有詮隼科技股份有限公司機密資訊、或受法律保護之資料，惟有原發信人指定之收信人得閱讀或使用本郵件之內容。如您並非被指定之收信人，請立即將本郵件及所有附件予以刪除；請勿揭露、儲存或使用本郵件之任何資訊，並請您立即告知原發信人本郵件的傳遞錯誤。謝謝您的合作。
> This e-mail transmission and any attachments contain information from
> O'Prueba Technology Inc. The information is confidential and/or privileged
> and intended to be solely for the use of the individuals or entity named in
> this e-mail transmission. If you are not the intended recipient, be aware
> that any disclosure, saving or use of the contents of this e-mail
> transmission and attachments is strictly prohibited. If you have received
> this email transmission in error, please notify us immediately, and delete
> the e-mail and attachments. We greatly appreciate your cooperation.
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211117/b4563951/attachment-0001.html>

From john.cheng at oprueba.com  Fri Nov 19 15:12:09 2021
From: john.cheng at oprueba.com (=?utf-8?B?6YSt5Luy57+U?=)
Date: Fri, 19 Nov 2021 15:12:09 +0000
Subject: [stratum-dev] Problems regarding the installation of stratum &
 SDE 9.4.0 on Tofino switch
In-Reply-To: <CAFh9Y_M2TNEXdcEGCZTn4jVmJArPOd6eg2fMSPDqxL9wKpFWxw@mail.gmail.com>
References: <0101017d3157ca16-8cecf896-87c6-4182-b034-d9c5894d2d4f-000000@us-west-2.amazonses.com>
 <CAFh9Y_M2TNEXdcEGCZTn4jVmJArPOd6eg2fMSPDqxL9wKpFWxw@mail.gmail.com>
Message-ID: <HK0PR06MB3233CB333A066E89BE348C13819C9@HK0PR06MB3233.apcprd06.prod.outlook.com>

Hi Max,

Thanks for your information. It works for me.

I use latest Stratum source code and it can work now.

Best Regards,
John
From: Maximilian Pudelko <max at opennetworking.org>
Sent: Thursday, November 18, 2021 1:09 PM
To: 鄭仲翔 <john.cheng at oprueba.com>
Cc: stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Problems regarding the installation of stratum & SDE 9.4.0 on Tofino switch

Hi John,

That bug you linked should be fixed by now and has been included in a few releases. Can you verify
you're running the latest 2021-10-09 release from the release page<https://github.com/stratum/stratum/releases>?
If this (or another) error still exists, that's worth investigating and probably a new bug.

If you still want to build Stratum yourself, you should check out the Stratum on Tofino build instructions here<https://github.com/stratum/stratum/blob/main/stratum/hal/bin/barefoot/README.build.md#method-2-pre-build-the-sde-then-build-stratum-with-docker-recommended>.
Method 2 or 3 seem close to what you're looking for.


Best,
Max


On Wed, Nov 17, 2021 at 8:39 PM 鄭仲翔 via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
Hello everyone,

I encountered some problems during the installation of stratum & SDE 9.4.0 on Tofino switch and was unable to run stratum smoothly.

Environment:
Switch: Netberg Aurora 610
root at localhost:~# cat /etc/onl/platform
x86-64-netberg-aurora-610-r0

root at localhost:~# uname -a
Linux localhost 4.19.81-OpenNetworkLinux #1 SMP Wed Apr 21 09:25:49 UTC 2021 x86_64 GNU/Linux

root at localhost:~# lsmod
Module                  Size  Used by
bf_kdrv                28672  0
at24                   20480  0
x86_pkg_temp_thermal    16384  0
intel_pch_thermal      16384  0
optoe                  20480  0
vpd                    24576  0
swps                  147456  0
net_cpld               16384  0
net_psoc               24576  0
net_platform           16384  0
i2c_gpio               16384  0
lpc_ich                28672  0
gpio_ich               16384  3

I tried two ways to run ONOS + Stratum + Tofino, the steps are as followed:
• Pre-built Stratum binaries:
        On switch:
        1. Install ONL on Tofino Switch
        2. Install stratum on Tofino Switch by stratum_bf_deb.deb
        3. Start stratum using start-stratum.sh

        On ONOS server:
        1. Start ONOS Server
        2. Build and install my app to ONOS server
        (My app can work on stratum + bmv2. To run on physical switch, I just modify PipeconfLoader.java)
        3. Put network configuration to ONOS server

        So far, ONOS can connect to Tofino Switch with stratum. But for Install rule, Stratum returned an error:
        [libprotobuf FATAL external/com_google_protobuf/src/google/protobuf/repeated_field.h:1694] CHECK failed: (index) < (current_size_):
        I saw the solution and want to build a new stratum_bf_deb.deb by myself: https://github.com/stratum/stratum/pull/687

• Build Stratum Source code:
        It cannot compile stratum on Tofino Switch, so I tried to build the STRATUM package on another Debian machine.

        Prepare package:
                Stratum Packet: https://github.com/stratum/stratum
                P4-SDE: 9.4.0
                BSP: 9.4.0
                Linux-kernel-4.19.81

        On Debian:
        1. Download Stratum Source Code
        2. Start a temporary container by setup_dev_env.sh
        3. Copy require packages into a container (SDE, BSP, Linux-kernel)
        4. Compile SDE:
        ./p4studio_build.py -up profiles/stratum_profile.yaml -shc -kdir <path/to/linux/sources> --bsp-path $BSP_PATH
        5. Get Stratum package:
        bazel build --sandbox_debug --verbose_failures //stratum/hal/bin/barefoot:stratum_bf_deb

        In this step it returned the following error:
        Repository rule http_archive defined at:
                /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/bazel_tools/tools/build_defs/repo/http.bzl:336:31: in <toplevel>
        ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such target '@local_barefoot_bin//:bf_library_files': target 'bf_library_files' not declared in package '' defined by   /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
        ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such target '@local_barefoot_bin//:bf_shareable_files': target 'bf_shareable_files' not declared in package '' defined by       /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
        ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:85:8: no such target '@local_barefoot_bin//:kernel_module': target 'kernel_module' not declared in package '' defined by         /root/.cache/bazel/_bazel_root/1b07b1db06ec9ee22c71eac6f0bd4549/external/local_barefoot_bin/BUILD and referenced by '//stratum/hal/bin/barefoot:stratum_bf_data'
        ERROR: Analysis of target '//stratum/hal/bin/barefoot:stratum_bf_deb' failed; build aborted: Analysis failed
        INFO: Elapsed time: 0.148s
        INFO: 0 processes.
        FAILED: Build did NOT complete successfully (0 packages loaded, 0 targets configured)

        I am not sure how to solve the problem. Can anyone offer me your insight?

Thanks

John
Confidentiality Note
本郵件含有詮隼科技股份有限公司機密資訊、或受法律保護之資料，惟有原發信人指定之收信人得閱讀或使用本郵件之內容。如您並非被指定之收信人，請立即將本郵件及所有附件予以刪除；請勿揭露、儲存或使用本郵件之任何資訊，並請您立即告知原發信人本郵件的傳遞錯誤。謝謝您的合作。
This e-mail transmission and any attachments contain information from O'Prueba Technology Inc. The information is confidential and/or privileged and intended to be solely for the use of the individuals or entity named in this e-mail transmission. If you are not the intended recipient, be aware that any disclosure, saving or use of the contents of this e-mail transmission and attachments is strictly prohibited. If you have received this email transmission in error, please notify us immediately, and delete the e-mail and attachments. We greatly appreciate your cooperation.
_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev
Confidentiality Note
本郵件含有詮隼科技股份有限公司機密資訊、或受法律保護之資料，惟有原發信人指定之收信人得閱讀或使用本郵件之內容。如您並非被指定之收信人，請立即將本郵件及所有附件予以刪除；請勿揭露、儲存或使用本郵件之任何資訊，並請您立即告知原發信人本郵件的傳遞錯誤。謝謝您的合作。
This e-mail transmission and any attachments contain information from O'Prueba Technology Inc. The information is confidential and/or privileged and intended to be solely for the use of the individuals or entity named in this e-mail transmission. If you are not the intended recipient, be aware that any disclosure, saving or use of the contents of this e-mail transmission and attachments is strictly prohibited. If you have received this email transmission in error, please notify us immediately, and delete the e-mail and attachments. We greatly appreciate your cooperation.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211119/b922a338/attachment-0001.html>

From bocon at opennetworking.org  Mon Nov 22 06:16:34 2021
From: bocon at opennetworking.org (bocon at opennetworking.org)
Date: Mon, 22 Nov 2021 06:16:34 +0000
Subject: [stratum-dev] Canceled event with note: Stratum TST Meeting @ Thu
 Nov 25, 2021 4:30pm - 5pm (EST) (stratum-dev@lists.stratumproject.org)
Message-ID: <0000000000001066b605d15a91d1@google.com>

This event has been canceled with this note:
"Canceled for Thanksgiving"

Title: Stratum TST Meeting
Stratum Technical Steering Team MeetingJoin Zoom  
Meetinghttps://onf.zoom.us/j/787501745?pwd=OHdtQVA3eXdoeThxZ0UzS1VVWEtxQT09Meeting  
ID: 787 501 745Passcode: 258532One tap mobile+13126266799,,787501745# US  
(Chicago)+19292056099,,787501745# US (New York)Agenda and Meeting  
Noteshttps://docs.google.com/document/d/1ret8Vbnl-xbLgNsnDEH-jWP2_WwDYym4zDn6me3tiTA/editThe  
plan is to reserve the 1st and 3rd Thursdays of each month for  
presentations and community updates. If you can only attend some of these  
meetings, those will be more interesting. The other meetings will be more  
informal&nbsp;sync ups to discuss current issues, progress, and status. You  
can see what presentations are planned by checking the agenda  
above.Supporting Slides and Previous  
Recordingshttps://drive.google.com/drive/folders/1ZeYp6RwIGYi9VnIctvnKF1c1NxiAXeOT----------------------------------------------------------------Dial  
by your location&nbsp; &nbsp; &nbsp; &nbsp; +1 312 626 6799 US  
(Chicago)&nbsp; &nbsp; &nbsp; &nbsp; +1 929 205 6099 US (New York)&nbsp;  
&nbsp; &nbsp; &nbsp; +1 301 715 8592 US (Germantown)&nbsp; &nbsp; &nbsp;  
&nbsp; +1 346 248 7799 US (Houston)&nbsp; &nbsp; &nbsp; &nbsp; +1 669 900  
6833 US (San Jose)&nbsp; &nbsp; &nbsp; &nbsp; +1 253 215 8782 US  
(Tacoma)&nbsp; &nbsp; &nbsp; &nbsp; 888 788 0099 US Toll-free&nbsp; &nbsp;  
&nbsp; &nbsp; 877 853 5247 US Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +61 2  
8015 6011 Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 3 7018 2005  
Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 7 3185 3730 Australia&nbsp; &nbsp;  
&nbsp; &nbsp; +61 8 6119 3900 Australia&nbsp; &nbsp; &nbsp; &nbsp; +61 8  
7150 1149 Australia&nbsp; &nbsp; &nbsp; &nbsp; 1800 945 157 Australia  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 1800 893 423 Australia Toll-free&nbsp;  
&nbsp; &nbsp; &nbsp; +81 363 628 317 Japan&nbsp; &nbsp; &nbsp; &nbsp; +81  
524 564 439 Japan&nbsp; &nbsp; &nbsp; &nbsp; +81 3 4578 1488 Japan&nbsp;  
&nbsp; &nbsp; &nbsp; 0 800 100 5040 Japan Toll-free&nbsp; &nbsp; &nbsp;  
&nbsp; 00 663 381 4092 Japan Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +49 69  
7104 9922 Germany&nbsp; &nbsp; &nbsp; &nbsp; +49 30 5679 5800 Germany&nbsp;  
&nbsp; &nbsp; &nbsp; +49 69 3807 9883 Germany&nbsp; &nbsp; &nbsp; &nbsp;  
+49 695 050 2596 Germany&nbsp; &nbsp; &nbsp; &nbsp; 0 800 1800 150 Germany  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 0 800 000 6954 Germany Toll-free&nbsp;  
&nbsp; &nbsp; &nbsp; +886 (2) 7741 7473 Taiwan&nbsp; &nbsp; &nbsp; &nbsp;  
08 0909 9864 Taiwan Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +48 22 307 3488  
Poland&nbsp; &nbsp; &nbsp; &nbsp; +48 22 398 7356 Poland&nbsp; &nbsp;  
&nbsp; &nbsp; +48 22 306 5342 Poland&nbsp; &nbsp; &nbsp; &nbsp; 00 800 321  
1464 Poland Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 00 800 112 5171 Poland  
Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +44 208 080 6592 United Kingdom&nbsp;  
&nbsp; &nbsp; &nbsp; +44 330 088 5830 United Kingdom&nbsp; &nbsp; &nbsp;  
&nbsp; +44 131 460 1196 United Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203  
481 5237 United Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203 481 5240 United  
Kingdom&nbsp; &nbsp; &nbsp; &nbsp; +44 203 901 7895 United Kingdom&nbsp;  
&nbsp; &nbsp; &nbsp; +44 208 080 6591 United Kingdom&nbsp; &nbsp; &nbsp;  
&nbsp; 0 800 260 5801 United Kingdom Toll-free&nbsp; &nbsp; &nbsp; &nbsp; 0  
800 031 5717 United Kingdom Toll-free&nbsp; &nbsp; &nbsp; &nbsp; +353 1 536  
9320 Ireland&nbsp; &nbsp; &nbsp; &nbsp; +353 1 653 3895 Ireland&nbsp;  
&nbsp; &nbsp; &nbsp; +353 1 653 3897 Ireland&nbsp; &nbsp; &nbsp; &nbsp;  
+353 1 653 3898 Ireland&nbsp; &nbsp; &nbsp; &nbsp; +353 6 163 9031  
Ireland&nbsp; &nbsp; &nbsp; &nbsp; +353 1 240 8941 Ireland&nbsp; &nbsp;  
&nbsp; &nbsp; 1800 949 238 Ireland Toll-free&nbsp; &nbsp; &nbsp; &nbsp;  
1800 901 561 Ireland Toll-freeMeeting ID: 787 501 745Find your local  
number:  
https://onf.zoom.us/u/ad1osSbywU----------------------------------------------------------------If  
you would like to get added to the calendar invite, please ask Brian.
When: Thu Nov 25, 2021 4:30pm – 5pm Eastern Time - New York
Where: (Online conference room)-Zoom-3, MP-1-Large Conference Room (25)
Calendar: stratum-dev at lists.stratumproject.org
Who:
     * bocon at opennetworking.org - creator
     * max at opennetworking.org
     * bill at opennetworking.org
     * mohammed.habeeb at inventec.com
     * yi at opennetworking.org
     * carmelo at opennetworking.org
     * xiao.david at inventec.com
     * Rich Renner
     * Devjit Gopalpur
     * Alireza Ghaffarkhah
     * Leonid Khedyk
     * niloofar at opennetworking.org
     * hsuanchung.lee at qct.io
     * Arkadiy Shapiro
     * you at opennetworking.org
     * abhilash at opennetworking.org
     * David Gengenbach
     * siddesh at opennetworking.org
     * craig.stevens at dell.com
     * asydney007 at gmail.com
     * stratum-dev at lists.stratumproject.org
     * maksym.kovaliov at plvision.eu
     * maksym.tropets at plvision.eu
     * jeff_catlin at edge-core.com
     * chris.sommers at keysight.com
     * John L
     * cmace at extremenetworks.com
     * Poongovan Ponnavaikko


Invitation from Google Calendar: https://calendar.google.com/calendar/

You are receiving this courtesy email at the account  
stratum-dev at lists.stratumproject.org because you are an attendee of this  
event.

To stop receiving future updates for this event, decline this event.  
Alternatively you can sign up for a Google account at  
https://calendar.google.com/calendar/ and control your notification  
settings for your entire calendar.

Forwarding this invitation could allow any recipient to send a response to  
the organizer and be added to the guest list, or invite others regardless  
of their own invitation status, or to modify your RSVP. Learn more at  
https://support.google.com/calendar/answer/37135#forwarding
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211122/7163f52b/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: text/calendar
Size: 10331 bytes
Desc: not available
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211122/7163f52b/attachment-0001.ics>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: invite.ics
Type: application/ics
Size: 10498 bytes
Desc: not available
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20211122/7163f52b/attachment-0001.bin>

