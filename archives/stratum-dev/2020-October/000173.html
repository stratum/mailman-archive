<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:stratum-dev%40lists.stratumproject.org?Subject=Re%3A%20%5Bstratum-dev%5D%20Questions%20regarding%20pushing%20pipeline%20configs%20to%0A%20barefoot%20Tofino%20switch&In-Reply-To=%3CMW2PR0102MB3580F33840FAC25EF054E11490190%40MW2PR0102MB3580.prod.exchangelabs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000172.html">
   <LINK REL="Next"  HREF="000174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch</H1>
    <B>zzha</B> 
    <A HREF="mailto:stratum-dev%40lists.stratumproject.org?Subject=Re%3A%20%5Bstratum-dev%5D%20Questions%20regarding%20pushing%20pipeline%20configs%20to%0A%20barefoot%20Tofino%20switch&In-Reply-To=%3CMW2PR0102MB3580F33840FAC25EF054E11490190%40MW2PR0102MB3580.prod.exchangelabs.com%3E"
       TITLE="[stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch">zzha at masonlive.gmu.edu
       </A><BR>
    <I>Mon Oct 26 23:29:08 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000172.html">[stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch
</A></li>
        <LI>Next message (by thread): <A HREF="000174.html">[stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#173">[ date ]</a>
              <a href="thread.html#173">[ thread ]</a>
              <a href="subject.html#173">[ subject ]</a>
              <a href="author.html#173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Max and Yi,

Thanks a lot for the explanation. I will definitely try out the stratum_bfrt target. FYI, the seg fault message from stratum is as below if I tried to push configs generated without --p4runtime-force-std-externs during compilation.
------------------------------------------------------------------------------------------------------------------------
I20201026 22:34:10.255018  6773 bf_chassis_manager.cc:716] State of port 64 in node 1: UP.
I20201026 22:34:10.256922  6773 bf_chassis_manager.cc:716] State of port 65 in node 1: UP.
I20201026 22:34:10.565280  6773 bf_chassis_manager.cc:716] State of port 66 in node 1: UP.
I20201026 22:34:10.586470  6773 bf_chassis_manager.cc:716] State of port 67 in node 1: UP.
I20201026 22:34:36.289355  6778 p4_service.cc:698] Controller (connection_id: 1, election_id: 1, uri: ipv4:192.168.100.13:34090) is connected as MASTER for node (aka device) with ID 1.
bf_switchd: starting warm init for dev_id 0 mode 1 serdes_upgrade 0
|<i>2020-10-26 22:34:36.571587 BF_PI ERROR - get_table_state: error when retrieving table state 33580535 for device 0
</I>*** Aborted at 1603751676 (unix time) try &quot;date -d @1603751676&quot; if you are using GNU date ***
PC: @                0x0 (unknown)
*** SIGSEGV (@0x0) received by PID 6732 (TID 0x7f099e7dc700) from PID 0; stack trace: ***
    @     0x7f09b72cf0e0 (unknown)
    @     0x7f09b8e24459 pi_state_table_id_to_handle
    @     0x7f09b8e1d2ab _pi_update_device_start
    @           0xcb1e24 pi_update_device_start
    @           0xb99d24 pi::fe::proto::DeviceMgrImp::pipeline_config_set()
    @           0xb921cd pi::fe::proto::DeviceMgr::pipeline_config_set()
    @           0xac7719 stratum::hal::pi::PINode::PushForwardingPipelineConfig()
    @           0x43deaa stratum::hal::barefoot::BFSwitch::PushForwardingPipelineConfig()
    @           0x94b501 stratum::hal::P4Service::SetForwardingPipelineConfig()
    @           0xc28e50 std::_Mem_fn&lt;&gt;::operator()&lt;&gt;()
    @           0xc26099 std::_Function_handler&lt;&gt;::_M_invoke()
    @           0xc3aed4 std::function&lt;&gt;::operator()()
    @           0xc31aa2 _ZZN9grpc_impl8internal16RpcMethodHandlerIN2p42v19P4Runtime7ServiceENS3_34SetForwardingPipelineConfigRequestENS3_35SetForwardingPipelineConfigResponseEE10RunHandlerERKN4grpc8internal13MethodHandler16HandlerParameterEENKUlvE_clEv
    @           0xc3af09 _ZN9grpc_impl8internal23CatchingFunctionHandlerIZNS0_16RpcMethodHandlerIN2p42v19P4Runtime7ServiceENS4_34SetForwardingPipelineConfigRequestENS4_35SetForwardingPipelineConfigResponseEE10RunHandlerERKN4grpc8internal13MethodHandler16HandlerParameterEEUlvE_EENSA_6StatusEOT_
    @           0xc31b57 grpc_impl::internal::RpcMethodHandler&lt;&gt;::RunHandler()
    @           0xe07a48 grpc_impl::Server::SyncRequest::CallData::ContinueRunAfterInterception()
    @           0xe07877 grpc_impl::Server::SyncRequest::CallData::Run()
    @           0xe08013 grpc_impl::Server::SyncRequestThreadManager::DoWork()
    @           0xe24429 grpc::ThreadManager::MainWorkLoop()
    @           0xe23a9b grpc::ThreadManager::WorkerThread::Run()
    @           0xe2395a _ZZN4grpc13ThreadManager12WorkerThreadC4EPS0_ENKUlPvE_clES3_
    @           0xe23979 _ZZN4grpc13ThreadManager12WorkerThreadC4EPS0_ENUlPvE_4_FUNES3_
    @          0x1016b54 _ZZN9grpc_core12_GLOBAL__N_120ThreadInternalsPosixC4EPKcPFvPvES4_PbRKNS_6Thread7OptionsEENKUlS4_E_clES4_
    @          0x1016b99 _ZZN9grpc_core12_GLOBAL__N_120ThreadInternalsPosixC4EPKcPFvPvES4_PbRKNS_6Thread7OptionsEENUlS4_E_4_FUNES4_
    @     0x7f09b72c54a4 start_thread
    @     0x7f09b6bedd0f clone
    @                0x0 (unknown)
Segmentation fault

Best regards,
Zoey
________________________________
From: Maximilian Pudelko &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">max at opennetworking.org</A>&gt;
Sent: Monday, October 26, 2020 6:10 PM
To: Yi Tseng &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">yi at opennetworking.org</A>&gt;
Cc: zzha &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">zzha at masonlive.gmu.edu</A>&gt;; <A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A> &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&gt;
Subject: Re: [stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch

Hi Zoey,

Yi summarized it pretty well. While the extern flag is required, Stratum should not segfault.
If you could post the error log we could see how to handle this better.

Max

On Mon, Oct 26, 2020 at 2:24 PM Yi Tseng via stratum-dev &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&gt;&gt; wrote:
Hi Zoey,

We believed that Barefoot will add support for converting Register extern to the standard one in the next Barefoot's SDE release.

Also, the current stratum_bf doesn't support register since the PI framework doesn't support it (Implementation here&lt;<A HREF="https://github.com/p4lang/PI/blob/master/proto/frontend/src/device_mgr.cpp#L2059-L2061">https://github.com/p4lang/PI/blob/master/proto/frontend/src/device_mgr.cpp#L2059-L2061</A>&gt;)

Currently, we are working on a new Stratum target called stratum_bfrt which is based on Barefoot's BfRt C++ API (Pull request here&lt;<A HREF="https://github.com/stratum/stratum/pull/337">https://github.com/stratum/stratum/pull/337</A>&gt;).
And it should support the native P4Runtime register messages.

Yi

On Mon, Oct 26, 2020 at 9:26 AM zzha via stratum-dev &lt;<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&gt;&gt; wrote:
Hi there,

I have built and started Stratum on a Tofino switch. But when I was trying to install a pipeline configuration through p4runtime-shell, Stratum reports a segmentation fault if the P4 program is compiled without &quot;--p4runtime-force-std-externs&quot; flag. However, with this p4c compilation flag, for programs that use Tofino specific externs like registers, the compiler will report a warning that says &quot;No known conversion to standard P4Info for 'Register' extern type&quot;. Any suggestions on how to fix this would be greatly appreciated!

Best regards,
Zoey
_______________________________________________
stratum-dev mailing list
<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&gt;
<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">https://lists.stratumproject.org/listinfo/stratum-dev</A>


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
<A HREF="https://www.opennetworking.org/">https://www.opennetworking.org/</A>
_______________________________________________
stratum-dev mailing list
<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&lt;mailto:<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">stratum-dev at lists.stratumproject.org</A>&gt;
<A HREF="https://lists.stratumproject.org/listinfo/stratum-dev">https://lists.stratumproject.org/listinfo/stratum-dev</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.stratumproject.org/archives/stratum-dev/attachments/20201026/0409dafe/attachment-0001.html">https://lists.stratumproject.org/archives/stratum-dev/attachments/20201026/0409dafe/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000172.html">[stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch
</A></li>
	<LI>Next message (by thread): <A HREF="000174.html">[stratum-dev] Questions regarding pushing pipeline configs to barefoot Tofino switch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#173">[ date ]</a>
              <a href="thread.html#173">[ thread ]</a>
              <a href="subject.html#173">[ subject ]</a>
              <a href="author.html#173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.stratumproject.org/listinfo/stratum-dev">More information about the stratum-dev
mailing list</a><br>
</body></html>
