From bocon at opennetworking.org  Wed May 13 07:17:56 2020
From: bocon at opennetworking.org (Brian O'Connor)
Date: Wed, 13 May 2020 00:17:56 -0700
Subject: [stratum-dev] Stratum TST Election Results
Message-ID: <CACKOpD=mcPU9qhSXTAZdNLJw+d6_SCzwX8rY-2t-_wgvWke9jg@mail.gmail.com>

Hi everyone,

We would like to congratulate the new members of the Stratum TST for 2020!
They will be responsible for overseeing and managing the Stratum project
for the coming year.

*Stratum TST*
Brian O’Connor (lead)
Alireza Ghaffarkhah (incumbent)
Craig Stevens (new)
Max Pudelko (new)
Yi Tseng (new)

We also want to thank Antonin Bas, our (now officially) retired member for
his service to the TST.

Thanks!
Brian

P.S. If you are wondering why you didn't receive a ballot, that is because
we had 3 open slots and 3 qualified nominees. An election would have just
been a formality, so we decided to skip it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200513/aafa9e94/attachment.html>

From aghaffar at google.com  Wed May 13 07:22:52 2020
From: aghaffar at google.com (Alireza Ghaffarkhah)
Date: Wed, 13 May 2020 00:22:52 -0700
Subject: [stratum-dev] [stratum-announce] Stratum TST Election Results
In-Reply-To: <010101720ce718c7-c6c47729-3d09-4ea6-b4f2-a54d323c77a7-000000@us-west-2.amazonses.com>
References: <010101720ce718c7-c6c47729-3d09-4ea6-b4f2-a54d323c77a7-000000@us-west-2.amazonses.com>
Message-ID: <CA+kiLHGSYGty9=HLL8tqNe-JMxSzbHTSaUOQ7i1JmEC8z4X-5w@mail.gmail.com>

Thanks Brian. Great news.

And welcome Graig, Max, and Yi.

--Ali

On Wed, May 13, 2020 at 12:19 AM Brian O'Connor via stratum-announce <
stratum-announce at lists.stratumproject.org> wrote:

> Hi everyone,
>
> We would like to congratulate the new members of the Stratum TST for 2020!
> They will be responsible for overseeing and managing the Stratum project
> for the coming year.
>
> *Stratum TST*
> Brian O’Connor (lead)
> Alireza Ghaffarkhah (incumbent)
> Craig Stevens (new)
> Max Pudelko (new)
> Yi Tseng (new)
>
> We also want to thank Antonin Bas, our (now officially) retired member for
> his service to the TST.
>
> Thanks!
> Brian
>
> P.S. If you are wondering why you didn't receive a ballot, that is because
> we had 3 open slots and 3 qualified nominees. An election would have just
> been a formality, so we decided to skip it.
> _______________________________________________
> stratum-announce mailing list
> stratum-announce at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-announce
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200513/d1c60454/attachment.html>

From Deval.Bhamare at kau.se  Thu May 14 14:56:08 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Thu, 14 May 2020 14:56:08 +0000
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
Message-ID: <61d3dc537ed44747a8b89d88bede753f@kau.se>

Hello Yi,


Sending a reminder.


Please let me know the cause of the error below in the newly updated container image  8.9.2-3.16.56-OpenNetworkLinux<https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore>


/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory


Note: I am using below values in the start_container script (which was working earlier)


--env WITH_ONLP=false \
--env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \


 With original  start_container script, however, I get error of


Cannot find flag file /etc/stratum/stratum.flags



Is it possible to get access to the earlier version of the container image? Also, I tried to build the container locally with old Docker.runtime, but it fails as well, with error log below.


PLease suggest.


ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:26:1: Linking of rule '//stratum/hal/bin/barefoot:stratum_bf' failed (Exit 1) gcc failed: error executing command /usr/bin/gcc @bazel-out/k8-fastbuild/bin/stratum/hal/bin/barefoot/stratum_bf-2.params


Use --sandbox_debug to see verbose messages from the sandbox

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi.pic.o:pi.c:function pi_port_status_get: error: undefined reference to '_pi_port_status_get'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_activate_mbr: error: undefined reference to '_pi_act_prof_grp_activate_mbr'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_deactivate_mbr: error: undefined reference to '_pi_act_prof_grp_deactivate_mbr'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_mbr_fetch: error: undefined reference to '_pi_act_prof_mbr_fetch'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_fetch: error: undefined reference to '_pi_act_prof_grp_fetch'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_default_action_get_handle: error: undefined reference to '_pi_table_default_action_get_handle'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_entries_fetch_one: error: undefined reference to '_pi_table_entries_fetch_one'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_entries_fetch_wkey: error: undefined reference to '_pi_table_entries_fetch_wkey'

collect2: error: ld returned 1 exit status

Target //stratum/hal/bin/barefoot:stratum_bf failed to build

Use --verbose_failures to see the command lines of failed build steps.

INFO: Elapsed time: 281.155s, Critical Path: 81.05s

INFO: 1513 processes: 1513 processwrapper-sandbox.

FAILED: Build did NOT complete successfully

FAILED: Build did NOT complete successfully

The command '/bin/sh -c bazel build //stratum/hal/bin/barefoot:stratum_bf     --define sde_ver=$(cat $SDE_INSTALL/share/VERSION)     --define phal_with_onlp=false &&     cp bazel-bin/stratum/hal/bin/barefoot/stratum_bf /tmp/stratum_bf_no_onlp' returned a non-zero code: 1



Thanks,


Deval

________________________________
From: Deval Bhamare
Sent: Wednesday, May 13, 2020 8:49:24 PM
To: Yi Tseng
Subject: Docker image older version for stratum


Hello Yi,


As I have mentioned earlier, the docker container image 8.9.2-3.16.56-OpenNetworkLinux<https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore> was working for our tofino switch, until I had to pull the image again, due to some crash. However, after pulling the new image, things have stopped working. I now get the error:


loading bf_kdrv_mod...
insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko: Invalid module format
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory



As I can see the docker image is build very recently and I doubt it may have changed something. Is it possible for you to provide the older version of this image (approx 2 months old, when the missing json issue was solved). Else, how can I fix the above problem?



Thanks,

Deval.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200514/2ca7b4a6/attachment.html>

From yi at opennetworking.org  Fri May 15 18:37:09 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Sat, 16 May 2020 02:37:09 +0800
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
	version for stratum
In-Reply-To: <61d3dc537ed44747a8b89d88bede753f@kau.se>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
Message-ID: <CAOyFVR14YxdeWRTObrgmK_pzBGDJ1hXhadddxnL+Zi7OjdgSTA@mail.gmail.com>

Hi Deval,

According to the log, you are trying to run the container on the system
which is not OpenNetworkingLinux with Linux kernel 3.16.56

The docker image with "-OpenNetworkingLinux" tag postfix is now only built
for OpenNetworkLinux (which requires ONLP library). If you want to use
other systems like Ubuntu or Fedora, you can use images without
"-OpenNetworkingLinux" postfix. For example
"stratumproject/stratum-bf:8.9.2"

Yi

On Thu, May 14, 2020 at 10:56 PM Deval Bhamare <Deval.Bhamare at kau.se> wrote:

> Hello Yi,
>
>
> Sending a reminder.
>
>
> Please let me know the cause of the error below in the newly updated
> container image  8.9.2-3.16.56-OpenNetworkLinux
> <https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore>
>
>
>
> */usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1:
> cannot open shared object file: No such file or directory*
>
>
> Note: I am using below values in the start_container script (which was
> working earlier)
>
>
> --env WITH_ONLP=false \
> --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \
>
>
>  With original  start_container script, however, I get error of
>
>
> *Cannot find flag file /etc/stratum/stratum.flags*
>
>
>
> Is it possible to get access to the earlier version of the container
> image? Also, I tried to build the container locally with old
> Docker.runtime, but it fails as well, with error log below.
>
>
> PLease suggest.
>
>
> ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:26:1: Linking of rule
> '//stratum/hal/bin/barefoot:stratum_bf' failed (Exit 1) gcc failed: error
> executing command /usr/bin/gcc
> @bazel-out/k8-fastbuild/bin/stratum/hal/bin/barefoot/stratum_bf-2.params
>
>
> Use --sandbox_debug to see verbose messages from the sandbox
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi.pic.o:pi.c:function
> pi_port_status_get: error: undefined reference to '_pi_port_status_get'
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
> pi_act_prof_grp_activate_mbr: error: undefined reference to
> '_pi_act_prof_grp_activate_mbr'
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
> pi_act_prof_grp_deactivate_mbr: error: undefined reference to
> '_pi_act_prof_grp_deactivate_mbr'
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
> pi_act_prof_mbr_fetch: error: undefined reference to
> '_pi_act_prof_mbr_fetch'
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
> pi_act_prof_grp_fetch: error: undefined reference to
> '_pi_act_prof_grp_fetch'
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
> pi_table_default_action_get_handle: error: undefined reference to
> '_pi_table_default_action_get_handle'
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
> pi_table_entries_fetch_one: error: undefined reference to
> '_pi_table_entries_fetch_one'
>
> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
> pi_table_entries_fetch_wkey: error: undefined reference to
> '_pi_table_entries_fetch_wkey'
>
> collect2: error: ld returned 1 exit status
>
> Target //stratum/hal/bin/barefoot:stratum_bf failed to build
>
> Use --verbose_failures to see the command lines of failed build steps.
>
> INFO: Elapsed time: 281.155s, Critical Path: 81.05s
>
> INFO: 1513 processes: 1513 processwrapper-sandbox.
>
> FAILED: Build did NOT complete successfully
>
> FAILED: Build did NOT complete successfully
>
> The command '/bin/sh -c bazel build //stratum/hal/bin/barefoot:stratum_bf
>   --define sde_ver=$(cat $SDE_INSTALL/share/VERSION)     --define
> phal_with_onlp=false &&     cp
> bazel-bin/stratum/hal/bin/barefoot/stratum_bf /tmp/stratum_bf_no_onlp'
> returned a non-zero code: 1
>
>
> Thanks,
>
>
> Deval
> ------------------------------
> *From:* Deval Bhamare
> *Sent:* Wednesday, May 13, 2020 8:49:24 PM
> *To:* Yi Tseng
> *Subject:* Docker image older version for stratum
>
>
> Hello Yi,
>
>
> As I have mentioned earlier, the docker container image
> 8.9.2-3.16.56-OpenNetworkLinux
> <https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore> was
> working for our tofino switch, until I had to pull the image again, due to
> some crash. However, after pulling the new image, things have stopped
> working. I now get the error:
>
>
> *loading bf_kdrv_mod...*
> *insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko:
> Invalid module format*
> */usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1:
> cannot open shared object file: No such file or directory*
>
>
> As I can see the docker image is build very recently and I doubt it may
> have changed something. Is it possible for you to provide the older version
> of this image (approx 2 months old, when the missing json issue was
> solved). Else, how can I fix the above problem?
>
>
>
> Thanks,
>
> Deval.
>
>
>


-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200516/8a9f0f58/attachment.html>

From Deval.Bhamare at kau.se  Fri May 15 18:56:38 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Fri, 15 May 2020 18:56:38 +0000
Subject: [stratum-dev] Docker image older version for stratum
In-Reply-To: <CAOyFVR2AzRCE3tMDu1tk4_SSH3qcD=FeQEi4dqviy0CJTHn=9w@mail.gmail.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>,
 <CAOyFVR2AzRCE3tMDu1tk4_SSH3qcD=FeQEi4dqviy0CJTHn=9w@mail.gmail.com>
Message-ID: <66b00cc1ec08478f928881c92ccee216@kau.se>

Hi,


thanks for your reply.


Below is the output of uname -r command:


3.16.64-OpenNetworkLinux


I installed it using  ONL-HEAD_ONL-OS8_2019-07-17.1445-8b1dfdb_AMD64 installer from stordis.


Now, I updated stratum and docker image again and tried it with both options  stratumproject/stratum-bf:8.9.2 and stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux, but now I get the error.


Error:

Cannot find flag file /etc/stratum/stratum.flags



Also, I tried on Ubuntu with latest stratum with docker image 8.9.2 and I get same error


Error:

Cannot find flag file /etc/stratum/stratum.flags


Thanks,
Deval.




________________________________
From: Yi Tseng <yi at opennetworking.org>
Sent: Friday, May 15, 2020 8:53:34 PM
To: Deval Bhamare
Subject: Re: Docker image older version for stratum

Hi Deval,

According to the log, you are trying to run the container on the system which is not OpenNetworkingLinux with Linux kernel 3.16.56

The docker image with "-OpenNetworkingLinux" tag postfix is now only built for OpenNetworkLinux (which requires ONLP library). If you want to use other systems like Ubuntu or Fedora, you can use images without "-OpenNetworkingLinux" postfix. For example "stratumproject/stratum-bf:8.9.2"

Yi

On Thu, May 14, 2020 at 1:49 AM Deval Bhamare <Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>> wrote:

Hello Yi,


As I have mentioned earlier, the docker container image 8.9.2-3.16.56-OpenNetworkLinux<https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore> was working for our tofino switch, until I had to pull the image again, due to some crash. However, after pulling the new image, things have stopped working. I now get the error:


loading bf_kdrv_mod...
insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko: Invalid module format
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory



As I can see the docker image is build very recently and I doubt it may have changed something. Is it possible for you to provide the older version of this image (approx 2 months old, when the missing json issue was solved). Else, how can I fix the above problem?



Thanks,

Deval.




--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200515/2f582c01/attachment-0001.html>

From max at opennetworking.org  Fri May 15 19:41:03 2020
From: max at opennetworking.org (Maximilian Pudelko)
Date: Fri, 15 May 2020 12:41:03 -0700
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
Message-ID: <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>

Hi Deval,

>
*Cannot find flag file /etc/stratum/stratum.flags*
I think this error comes from the way you start the container. Can you give
us the full command for `start-stratum-container.sh`?
By default the script will mount your /root folder to /etc/stratum, hiding
everything inside:
https://github.com/stratum/stratum/blob/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh#L19

@Yi Tseng <yi at opennetworking.org> Maybe we should revise this logic a bit
and only mount it if the env var is set.

Max

On Fri, May 15, 2020 at 11:37 AM Yi Tseng via stratum-dev <
stratum-dev at lists.stratumproject.org> wrote:

> Hi Deval,
>
> According to the log, you are trying to run the container on the system
> which is not OpenNetworkingLinux with Linux kernel 3.16.56
>
> The docker image with "-OpenNetworkingLinux" tag postfix is now only built
> for OpenNetworkLinux (which requires ONLP library). If you want to use
> other systems like Ubuntu or Fedora, you can use images without
> "-OpenNetworkingLinux" postfix. For example
> "stratumproject/stratum-bf:8.9.2"
>
> Yi
>
> On Thu, May 14, 2020 at 10:56 PM Deval Bhamare <Deval.Bhamare at kau.se>
> wrote:
>
>> Hello Yi,
>>
>>
>> Sending a reminder.
>>
>>
>> Please let me know the cause of the error below in the newly updated
>> container image  8.9.2-3.16.56-OpenNetworkLinux
>> <https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore>
>>
>>
>>
>> */usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1:
>> cannot open shared object file: No such file or directory*
>>
>>
>> Note: I am using below values in the start_container script (which was
>> working earlier)
>>
>>
>> --env WITH_ONLP=false \
>> --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \
>>
>>
>>  With original  start_container script, however, I get error of
>>
>>
>> *Cannot find flag file /etc/stratum/stratum.flags*
>>
>>
>>
>> Is it possible to get access to the earlier version of the container
>> image? Also, I tried to build the container locally with old
>> Docker.runtime, but it fails as well, with error log below.
>>
>>
>> PLease suggest.
>>
>>
>> ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:26:1: Linking of rule
>> '//stratum/hal/bin/barefoot:stratum_bf' failed (Exit 1) gcc failed: error
>> executing command /usr/bin/gcc
>> @bazel-out/k8-fastbuild/bin/stratum/hal/bin/barefoot/stratum_bf-2.params
>>
>>
>> Use --sandbox_debug to see verbose messages from the sandbox
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi.pic.o:pi.c:function
>> pi_port_status_get: error: undefined reference to '_pi_port_status_get'
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>> pi_act_prof_grp_activate_mbr: error: undefined reference to
>> '_pi_act_prof_grp_activate_mbr'
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>> pi_act_prof_grp_deactivate_mbr: error: undefined reference to
>> '_pi_act_prof_grp_deactivate_mbr'
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>> pi_act_prof_mbr_fetch: error: undefined reference to
>> '_pi_act_prof_mbr_fetch'
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>> pi_act_prof_grp_fetch: error: undefined reference to
>> '_pi_act_prof_grp_fetch'
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
>> pi_table_default_action_get_handle: error: undefined reference to
>> '_pi_table_default_action_get_handle'
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
>> pi_table_entries_fetch_one: error: undefined reference to
>> '_pi_table_entries_fetch_one'
>>
>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
>> pi_table_entries_fetch_wkey: error: undefined reference to
>> '_pi_table_entries_fetch_wkey'
>>
>> collect2: error: ld returned 1 exit status
>>
>> Target //stratum/hal/bin/barefoot:stratum_bf failed to build
>>
>> Use --verbose_failures to see the command lines of failed build steps.
>>
>> INFO: Elapsed time: 281.155s, Critical Path: 81.05s
>>
>> INFO: 1513 processes: 1513 processwrapper-sandbox.
>>
>> FAILED: Build did NOT complete successfully
>>
>> FAILED: Build did NOT complete successfully
>>
>> The command '/bin/sh -c bazel build //stratum/hal/bin/barefoot:stratum_bf
>>   --define sde_ver=$(cat $SDE_INSTALL/share/VERSION)     --define
>> phal_with_onlp=false &&     cp
>> bazel-bin/stratum/hal/bin/barefoot/stratum_bf /tmp/stratum_bf_no_onlp'
>> returned a non-zero code: 1
>>
>>
>> Thanks,
>>
>>
>> Deval
>> ------------------------------
>> *From:* Deval Bhamare
>> *Sent:* Wednesday, May 13, 2020 8:49:24 PM
>> *To:* Yi Tseng
>> *Subject:* Docker image older version for stratum
>>
>>
>> Hello Yi,
>>
>>
>> As I have mentioned earlier, the docker container image
>> 8.9.2-3.16.56-OpenNetworkLinux
>> <https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore> was
>> working for our tofino switch, until I had to pull the image again, due to
>> some crash. However, after pulling the new image, things have stopped
>> working. I now get the error:
>>
>>
>> *loading bf_kdrv_mod...*
>> *insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko:
>> Invalid module format*
>> */usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1:
>> cannot open shared object file: No such file or directory*
>>
>>
>> As I can see the docker image is build very recently and I doubt it may
>> have changed something. Is it possible for you to provide the older version
>> of this image (approx 2 months old, when the missing json issue was
>> solved). Else, how can I fix the above problem?
>>
>>
>>
>> Thanks,
>>
>> Deval.
>>
>>
>>
>
>
> --
> Yi Tseng
> Member of Technical Staff
> Open Networking Foundation
> https://www.opennetworking.org/
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200515/d6fb1d05/attachment.html>

From Deval.Bhamare at kau.se  Fri May 15 19:46:40 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Fri, 15 May 2020 19:46:40 +0000
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>,
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
Message-ID: <8ef97220c15d4c8eaa3c0b0a47dc920a@kau.se>

Hi,


Thanks for the reply. I just run the start-stratum-container.sh script from the stratum/stratum/hal/bin/barefoot/docker folder.


I updated the SDE_VERSION=${SDE_VERSION:-9.0.0} to SDE_VERSION=${SDE_VERSION:-8.92}


That's it. Am I missing something?


Thanks,


Deval.


________________________________
From: Maximilian Pudelko <max at opennetworking.org>
Sent: Friday, May 15, 2020 10:41:03 PM
To: Yi Tseng
Cc: Deval Bhamare; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

> Cannot find flag file /etc/stratum/stratum.flags
I think this error comes from the way you start the container. Can you give us the full command for `start-stratum-container.sh`?
By default the script will mount your /root folder to /etc/stratum, hiding everything inside: https://github.com/stratum/stratum/blob/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh#L19

@Yi Tseng<mailto:yi at opennetworking.org> Maybe we should revise this logic a bit and only mount it if the env var is set.

Max

On Fri, May 15, 2020 at 11:37 AM Yi Tseng via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
Hi Deval,

According to the log, you are trying to run the container on the system which is not OpenNetworkingLinux with Linux kernel 3.16.56

The docker image with "-OpenNetworkingLinux" tag postfix is now only built for OpenNetworkLinux (which requires ONLP library). If you want to use other systems like Ubuntu or Fedora, you can use images without "-OpenNetworkingLinux" postfix. For example "stratumproject/stratum-bf:8.9.2"

Yi

On Thu, May 14, 2020 at 10:56 PM Deval Bhamare <Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>> wrote:

Hello Yi,


Sending a reminder.


Please let me know the cause of the error below in the newly updated container image  8.9.2-3.16.56-OpenNetworkLinux<https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore>


/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory


Note: I am using below values in the start_container script (which was working earlier)


--env WITH_ONLP=false \
--env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \


 With original  start_container script, however, I get error of


Cannot find flag file /etc/stratum/stratum.flags



Is it possible to get access to the earlier version of the container image? Also, I tried to build the container locally with old Docker.runtime, but it fails as well, with error log below.


PLease suggest.


ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:26:1: Linking of rule '//stratum/hal/bin/barefoot:stratum_bf' failed (Exit 1) gcc failed: error executing command /usr/bin/gcc @bazel-out/k8-fastbuild/bin/stratum/hal/bin/barefoot/stratum_bf-2.params


Use --sandbox_debug to see verbose messages from the sandbox

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi.pic.o:pi.c:function pi_port_status_get: error: undefined reference to '_pi_port_status_get'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_activate_mbr: error: undefined reference to '_pi_act_prof_grp_activate_mbr'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_deactivate_mbr: error: undefined reference to '_pi_act_prof_grp_deactivate_mbr'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_mbr_fetch: error: undefined reference to '_pi_act_prof_mbr_fetch'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_fetch: error: undefined reference to '_pi_act_prof_grp_fetch'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_default_action_get_handle: error: undefined reference to '_pi_table_default_action_get_handle'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_entries_fetch_one: error: undefined reference to '_pi_table_entries_fetch_one'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_entries_fetch_wkey: error: undefined reference to '_pi_table_entries_fetch_wkey'

collect2: error: ld returned 1 exit status

Target //stratum/hal/bin/barefoot:stratum_bf failed to build

Use --verbose_failures to see the command lines of failed build steps.

INFO: Elapsed time: 281.155s, Critical Path: 81.05s

INFO: 1513 processes: 1513 processwrapper-sandbox.

FAILED: Build did NOT complete successfully

FAILED: Build did NOT complete successfully

The command '/bin/sh -c bazel build //stratum/hal/bin/barefoot:stratum_bf     --define sde_ver=$(cat $SDE_INSTALL/share/VERSION)     --define phal_with_onlp=false &&     cp bazel-bin/stratum/hal/bin/barefoot/stratum_bf /tmp/stratum_bf_no_onlp' returned a non-zero code: 1



Thanks,


Deval

________________________________
From: Deval Bhamare
Sent: Wednesday, May 13, 2020 8:49:24 PM
To: Yi Tseng
Subject: Docker image older version for stratum


Hello Yi,


As I have mentioned earlier, the docker container image 8.9.2-3.16.56-OpenNetworkLinux<https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore> was working for our tofino switch, until I had to pull the image again, due to some crash. However, after pulling the new image, things have stopped working. I now get the error:


loading bf_kdrv_mod...
insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko: Invalid module format
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory



As I can see the docker image is build very recently and I doubt it may have changed something. Is it possible for you to provide the older version of this image (approx 2 months old, when the missing json issue was solved). Else, how can I fix the above problem?



Thanks,

Deval.




--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200515/15f5e6b9/attachment-0001.html>

From yi at opennetworking.org  Sat May 16 17:21:00 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Sun, 17 May 2020 01:21:00 +0800
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <12eb0ed15a914d348f903194774b19f9@kau.se>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
Message-ID: <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>

Hi Deval,

I tried to run the container on my BF2556X device and it works fine. Here
is what I did (by following these steps
<https://github.com/stratum/stratum/tree/master/stratum/hal/bin/barefoot/docker#run-the-container-on-the-device>
):

1. Set up the huge page (only needs to be done once)



*sudo echo "vm.nr_hugepages = 128" >> /etc/sysctl.confsudo sysctl -p
/etc/sysctl.confsudo mkdir /mnt/hugesudo mount -t hugetlbfs nodev /mnt/huge*

2. Create a directory for configurations and logs and enter this dir:
*mkdir stratum-configs && cd stratum-configs*

3. Place start script, chassis config file and stratum flag file in this
directory.

*curl -o start-stratum-container.sh
https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh
<https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh>*
*chmod +x start-stratum-container.sh*
*curl -o chassis_config.pb.txt
https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/config/x86-64-stordis-bf2556x-1t-r0/chassis_config.pb.txt
<https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/config/x86-64-stordis-bf2556x-1t-r0/chassis_config.pb.txt>*

*curl -o stratum.flags
https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/deb/stratum.flags
<https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/deb/stratum.flags>*

4. Start Stratum with the script and some environment variable
*PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0
CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh*

*Note: Remove "-bf_switchd_background=true" from stratum.flags file if you
want to use the command line from bf_switchd*

Yi

On Sat, May 16, 2020 at 4:08 AM Deval Bhamare <Deval.Bhamare at kau.se> wrote:

> Hi ,
>
>
> I changed it, and this results into below error:
>
>
> /usr/bin/stratum_bf: symbol lookup error: /usr/bin/stratum_bf: undefined
> symbol: onlp_sw_init
>
>
> thanks,
>
> Deval.
>
>
> ------------------------------
> *From:* Maximilian Pudelko <max at opennetworking.org>
> *Sent:* Friday, May 15, 2020 11:03:04 PM
> *To:* Deval Bhamare
> *Cc:* Yi Tseng
> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
> older version for stratum
>
> > -v /root:/etc/stratum
>
> That's the issue. Unless you have a copy of the stratum config files in
> /root, this will overwrite them inside the container.
> You can remove this line
> <https://github.com/stratum/stratum/blob/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh#L32>
> for now, until we figure something out.
>
> Max
>
> On Fri, May 15, 2020 at 12:54 PM Deval Bhamare <Deval.Bhamare at kau.se>
> wrote:
>
>> The docker run command unfolds into below, if that might help.
>>
>>
>> Also, do I have to use the below options with modified container as well?
>>
>>
>>     --env WITH_ONLP=false \
>>     --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \
>>
>>
>> Docker run:
>>
>>
>>
>>  docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>> /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux
>> -v
>> /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so
>> -v
>> /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1
>> -v
>> /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so
>> -v
>> /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1
>> -v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so -v
>> /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1 -v
>> /lib/platform-config:/lib/platform-config -v /etc/onl:/etc/onl -p
>> 28000:28000 -p 9339:9339 -v /root:/etc/stratum -v /var/log:/var/log/stratum
>> stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux
>> ------------------------------
>> *From:* Maximilian Pudelko <max at opennetworking.org>
>> *Sent:* Friday, May 15, 2020 10:41:03 PM
>> *To:* Yi Tseng
>> *Cc:* Deval Bhamare; stratum-dev at lists.stratumproject.org
>> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
>> older version for stratum
>>
>> Hi Deval,
>>
>> >
>> *Cannot find flag file /etc/stratum/stratum.flags *
>> I think this error comes from the way you start the container. Can you
>> give us the full command for `start-stratum-container.sh`?
>> By default the script will mount your /root folder to /etc/stratum,
>> hiding everything inside:
>> https://github.com/stratum/stratum/blob/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh#L19
>>
>> @Yi Tseng <yi at opennetworking.org> Maybe we should revise this logic a
>> bit and only mount it if the env var is set.
>>
>> Max
>>
>> On Fri, May 15, 2020 at 11:37 AM Yi Tseng via stratum-dev <
>> stratum-dev at lists.stratumproject.org> wrote:
>>
>>> Hi Deval,
>>>
>>> According to the log, you are trying to run the container on the system
>>> which is not OpenNetworkingLinux with Linux kernel 3.16.56
>>>
>>> The docker image with "-OpenNetworkingLinux" tag postfix is now only
>>> built for OpenNetworkLinux (which requires ONLP library). If you want to
>>> use other systems like Ubuntu or Fedora, you can use images without
>>> "-OpenNetworkingLinux" postfix. For example
>>> "stratumproject/stratum-bf:8.9.2"
>>>
>>> Yi
>>>
>>> On Thu, May 14, 2020 at 10:56 PM Deval Bhamare <Deval.Bhamare at kau.se>
>>> wrote:
>>>
>>>> Hello Yi,
>>>>
>>>>
>>>> Sending a reminder.
>>>>
>>>>
>>>> Please let me know the cause of the error below in the newly updated
>>>> container image  8.9.2-3.16.56-OpenNetworkLinux
>>>> <https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore>
>>>>
>>>>
>>>>
>>>> */usr/bin/stratum_bf: error while loading shared libraries:
>>>> libonlp.so.1: cannot open shared object file: No such file or directory*
>>>>
>>>>
>>>> Note: I am using below values in the start_container script (which was
>>>> working earlier)
>>>>
>>>>
>>>> --env WITH_ONLP=false \
>>>> --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \
>>>>
>>>>
>>>>  With original  start_container script, however, I get error of
>>>>
>>>>
>>>> *Cannot find flag file /etc/stratum/stratum.flags*
>>>>
>>>>
>>>>
>>>> Is it possible to get access to the earlier version of the container
>>>> image? Also, I tried to build the container locally with old
>>>> Docker.runtime, but it fails as well, with error log below.
>>>>
>>>>
>>>> PLease suggest.
>>>>
>>>>
>>>> ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:26:1: Linking of rule
>>>> '//stratum/hal/bin/barefoot:stratum_bf' failed (Exit 1) gcc failed: error
>>>> executing command /usr/bin/gcc
>>>> @bazel-out/k8-fastbuild/bin/stratum/hal/bin/barefoot/stratum_bf-2.params
>>>>
>>>>
>>>> Use --sandbox_debug to see verbose messages from the sandbox
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi.pic.o:pi.c:function
>>>> pi_port_status_get: error: undefined reference to '_pi_port_status_get'
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>>>> pi_act_prof_grp_activate_mbr: error: undefined reference to
>>>> '_pi_act_prof_grp_activate_mbr'
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>>>> pi_act_prof_grp_deactivate_mbr: error: undefined reference to
>>>> '_pi_act_prof_grp_deactivate_mbr'
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>>>> pi_act_prof_mbr_fetch: error: undefined reference to
>>>> '_pi_act_prof_mbr_fetch'
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function
>>>> pi_act_prof_grp_fetch: error: undefined reference to
>>>> '_pi_act_prof_grp_fetch'
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
>>>> pi_table_default_action_get_handle: error: undefined reference to
>>>> '_pi_table_default_action_get_handle'
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
>>>> pi_table_entries_fetch_one: error: undefined reference to
>>>> '_pi_table_entries_fetch_one'
>>>>
>>>> bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function
>>>> pi_table_entries_fetch_wkey: error: undefined reference to
>>>> '_pi_table_entries_fetch_wkey'
>>>>
>>>> collect2: error: ld returned 1 exit status
>>>>
>>>> Target //stratum/hal/bin/barefoot:stratum_bf failed to build
>>>>
>>>> Use --verbose_failures to see the command lines of failed build steps.
>>>>
>>>> INFO: Elapsed time: 281.155s, Critical Path: 81.05s
>>>>
>>>> INFO: 1513 processes: 1513 processwrapper-sandbox.
>>>>
>>>> FAILED: Build did NOT complete successfully
>>>>
>>>> FAILED: Build did NOT complete successfully
>>>>
>>>> The command '/bin/sh -c bazel build
>>>> //stratum/hal/bin/barefoot:stratum_bf     --define sde_ver=$(cat
>>>> $SDE_INSTALL/share/VERSION)     --define phal_with_onlp=false &&     cp
>>>> bazel-bin/stratum/hal/bin/barefoot/stratum_bf /tmp/stratum_bf_no_onlp'
>>>> returned a non-zero code: 1
>>>>
>>>>
>>>> Thanks,
>>>>
>>>>
>>>> Deval
>>>> ------------------------------
>>>> *From:* Deval Bhamare
>>>> *Sent:* Wednesday, May 13, 2020 8:49:24 PM
>>>> *To:* Yi Tseng
>>>> *Subject:* Docker image older version for stratum
>>>>
>>>>
>>>> Hello Yi,
>>>>
>>>>
>>>> As I have mentioned earlier, the docker container image
>>>> 8.9.2-3.16.56-OpenNetworkLinux
>>>> <https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore> was
>>>> working for our tofino switch, until I had to pull the image again, due to
>>>> some crash. However, after pulling the new image, things have stopped
>>>> working. I now get the error:
>>>>
>>>>
>>>> *loading bf_kdrv_mod...*
>>>> *insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko:
>>>> Invalid module format*
>>>> */usr/bin/stratum_bf: error while loading shared libraries:
>>>> libonlp.so.1: cannot open shared object file: No such file or directory*
>>>>
>>>>
>>>> As I can see the docker image is build very recently and I doubt it may
>>>> have changed something. Is it possible for you to provide the older version
>>>> of this image (approx 2 months old, when the missing json issue was
>>>> solved). Else, how can I fix the above problem?
>>>>
>>>>
>>>>
>>>> Thanks,
>>>>
>>>> Deval.
>>>>
>>>>
>>>>
>>>
>>>
>>> --
>>> Yi Tseng
>>> Member of Technical Staff
>>> Open Networking Foundation
>>> https://www.opennetworking.org/
>>> _______________________________________________
>>> stratum-dev mailing list
>>> stratum-dev at lists.stratumproject.org
>>> https://lists.stratumproject.org/listinfo/stratum-dev
>>
>>

-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200517/c6a596c0/attachment-0001.html>

From Deval.Bhamare at kau.se  Sun May 17 07:24:27 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Sun, 17 May 2020 07:24:27 +0000
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>,
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
Message-ID: <9010ac690f4946989ba5bff342b6e94f@kau.se>

Hello Yi,


Thank you for the reply. So I tried the steps below on ONL 3.16.64-OpenNetworkLinux. I still get below error:


+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux

loading bf_kdrv_mod...

insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko: Invalid module format

/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory



In the end are detailed logs.


I have used BF-SDE 8.9.0. Also, I tried with both Docker images, 8.9.2-3.16.56-OpenNetworkLinux and 8.9.2 only, still the same error.


I also searched for libonlp.so.1 and below is the output:


find / -name libonlp.so.1
/lib/x86_64-linux-gnu/libonlp.so.1

ls -l /lib/x86_64-linux-gnu/libonlp.so.1
lrwxrwxrwx 1 root root 10 May 13 12:25 /lib/x86_64-linux-gnu/libonlp.so.1 -> libonlp.so


Also, I tried to load bf_kdrv_mod manually with command below and it was successful.


sudo $SDE_INSTALL/bin/bf_kdrv_mod_load $SDE_INSTALL



Thanks,

Deval.


Detailed stratum logs:


+ PLATFORM_ARGS=

+ '[' -n x86-64-stordis-bf2556x-1t-r0 ']'

+ PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'

+ CONFIG_DIR=/root/stratum/stratum-configs

+ LOG_DIR=/root/stratum/stratum-configs

+ SDE_VERSION=9.0.0

++ uname -r

+ KERNEL_VERSION=3.16.64-OpenNetworkLinux

+ DOCKER_IMAGE=stratumproject/stratum-bf

+ DOCKER_IMAGE_TAG=8.9.2

++ uname -r

++ uname -r

+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v /root/stratum/stratum-configs:/etc/stratum -v /root/stratum/stratum-configs:/var/log/stratum stratumproject/stratum-bf:8.9.2

Cannot find /usr/lib/modules/bf_kdrv.ko, skip installing the Kernel module.

/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory



________________________________
From: Yi Tseng <yi at opennetworking.org>
Sent: Saturday, May 16, 2020 8:21:00 PM
To: Deval Bhamare
Cc: Maximilian Pudelko; stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

I tried to run the container on my BF2556X device and it works fine. Here is what I did (by following these steps<https://github.com/stratum/stratum/tree/master/stratum/hal/bin/barefoot/docker#run-the-container-on-the-device>):

1. Set up the huge page (only needs to be done once)
sudo echo "vm.nr_hugepages = 128" >> /etc/sysctl.conf
sudo sysctl -p /etc/sysctl.conf
sudo mkdir /mnt/huge
sudo mount -t hugetlbfs nodev /mnt/huge

2. Create a directory for configurations and logs and enter this dir:
mkdir stratum-configs && cd stratum-configs

3. Place start script, chassis config file and stratum flag file in this directory.
curl -o start-stratum-container.sh https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh
chmod +x start-stratum-container.sh
curl -o chassis_config.pb.txt https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/config/x86-64-stordis-bf2556x-1t-r0/chassis_config.pb.txt
curl -o stratum.flags https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/deb/stratum.flags

4. Start Stratum with the script and some environment variable
PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh

Note: Remove "-bf_switchd_background=true" from stratum.flags file if you want to use the command line from bf_switchd

Yi

On Sat, May 16, 2020 at 4:08 AM Deval Bhamare <Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>> wrote:

Hi ,


I changed it, and this results into below error:


/usr/bin/stratum_bf: symbol lookup error: /usr/bin/stratum_bf: undefined symbol: onlp_sw_init


thanks,

Deval.


________________________________
From: Maximilian Pudelko <max at opennetworking.org<mailto:max at opennetworking.org>>
Sent: Friday, May 15, 2020 11:03:04 PM
To: Deval Bhamare
Cc: Yi Tseng
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

> -v /root:/etc/stratum

That's the issue. Unless you have a copy of the stratum config files in /root, this will overwrite them inside the container.
You can remove this line<https://github.com/stratum/stratum/blob/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh#L32> for now, until we figure something out.

Max

On Fri, May 15, 2020 at 12:54 PM Deval Bhamare <Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>> wrote:

The docker run command unfolds into below, if that might help.


Also, do I have to use the below options with modified container as well?


    --env WITH_ONLP=false \
    --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \



Docker run:



 docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux -v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so -v /lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1:/lib/x86_64-linux-gnu/libonlp-platform-defaults.so.1 -v /lib/x86_64-linux-gnu/libonlp-platform.so:/lib/x86_64-linux-gnu/libonlp-platform.so -v /lib/x86_64-linux-gnu/libonlp-platform.so.1:/lib/x86_64-linux-gnu/libonlp-platform.so.1 -v /lib/x86_64-linux-gnu/libonlp.so:/lib/x86_64-linux-gnu/libonlp.so -v /lib/x86_64-linux-gnu/libonlp.so.1:/lib/x86_64-linux-gnu/libonlp.so.1 -v /lib/platform-config:/lib/platform-config -v /etc/onl:/etc/onl -p 28000:28000 -p 9339:9339 -v /root:/etc/stratum -v /var/log:/var/log/stratum stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux

________________________________
From: Maximilian Pudelko <max at opennetworking.org<mailto:max at opennetworking.org>>
Sent: Friday, May 15, 2020 10:41:03 PM
To: Yi Tseng
Cc: Deval Bhamare; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

> Cannot find flag file /etc/stratum/stratum.flags
I think this error comes from the way you start the container. Can you give us the full command for `start-stratum-container.sh`?
By default the script will mount your /root folder to /etc/stratum, hiding everything inside: https://github.com/stratum/stratum/blob/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh#L19

@Yi Tseng<mailto:yi at opennetworking.org> Maybe we should revise this logic a bit and only mount it if the env var is set.

Max

On Fri, May 15, 2020 at 11:37 AM Yi Tseng via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:
Hi Deval,

According to the log, you are trying to run the container on the system which is not OpenNetworkingLinux with Linux kernel 3.16.56

The docker image with "-OpenNetworkingLinux" tag postfix is now only built for OpenNetworkLinux (which requires ONLP library). If you want to use other systems like Ubuntu or Fedora, you can use images without "-OpenNetworkingLinux" postfix. For example "stratumproject/stratum-bf:8.9.2"

Yi

On Thu, May 14, 2020 at 10:56 PM Deval Bhamare <Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>> wrote:

Hello Yi,


Sending a reminder.


Please let me know the cause of the error below in the newly updated container image  8.9.2-3.16.56-OpenNetworkLinux<https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore>


/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory


Note: I am using below values in the start_container script (which was working earlier)


--env WITH_ONLP=false \
--env PLATFORM=x86-64-stordis-bf2556x-1t-r0 \


 With original  start_container script, however, I get error of


Cannot find flag file /etc/stratum/stratum.flags



Is it possible to get access to the earlier version of the container image? Also, I tried to build the container locally with old Docker.runtime, but it fails as well, with error log below.


PLease suggest.


ERROR: /stratum/stratum/hal/bin/barefoot/BUILD:26:1: Linking of rule '//stratum/hal/bin/barefoot:stratum_bf' failed (Exit 1) gcc failed: error executing command /usr/bin/gcc @bazel-out/k8-fastbuild/bin/stratum/hal/bin/barefoot/stratum_bf-2.params


Use --sandbox_debug to see verbose messages from the sandbox

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi.pic.o:pi.c:function pi_port_status_get: error: undefined reference to '_pi_port_status_get'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_activate_mbr: error: undefined reference to '_pi_act_prof_grp_activate_mbr'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_deactivate_mbr: error: undefined reference to '_pi_act_prof_grp_deactivate_mbr'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_mbr_fetch: error: undefined reference to '_pi_act_prof_mbr_fetch'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_act_prof.pic.o:pi_act_prof.c:function pi_act_prof_grp_fetch: error: undefined reference to '_pi_act_prof_grp_fetch'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_default_action_get_handle: error: undefined reference to '_pi_table_default_action_get_handle'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_entries_fetch_one: error: undefined reference to '_pi_table_entries_fetch_one'

bazel-out/k8-fastbuild/bin/external/com_github_p4lang_PI_bf_9_1_0/_objs/pi/pi_tables.pic.o:pi_tables.c:function pi_table_entries_fetch_wkey: error: undefined reference to '_pi_table_entries_fetch_wkey'

collect2: error: ld returned 1 exit status

Target //stratum/hal/bin/barefoot:stratum_bf failed to build

Use --verbose_failures to see the command lines of failed build steps.

INFO: Elapsed time: 281.155s, Critical Path: 81.05s

INFO: 1513 processes: 1513 processwrapper-sandbox.

FAILED: Build did NOT complete successfully

FAILED: Build did NOT complete successfully

The command '/bin/sh -c bazel build //stratum/hal/bin/barefoot:stratum_bf     --define sde_ver=$(cat $SDE_INSTALL/share/VERSION)     --define phal_with_onlp=false &&     cp bazel-bin/stratum/hal/bin/barefoot/stratum_bf /tmp/stratum_bf_no_onlp' returned a non-zero code: 1



Thanks,


Deval

________________________________
From: Deval Bhamare
Sent: Wednesday, May 13, 2020 8:49:24 PM
To: Yi Tseng
Subject: Docker image older version for stratum


Hello Yi,


As I have mentioned earlier, the docker container image 8.9.2-3.16.56-OpenNetworkLinux<https://hub.docker.com/layers/stratumproject/stratum-bf/8.9.2-3.16.56-OpenNetworkLinux/images/sha256-3a52ec68005041b4d69b676c9584133a34652910514272165f09f443fb2975d8?context=explore> was working for our tofino switch, until I had to pull the image again, due to some crash. However, after pulling the new image, things have stopped working. I now get the error:


loading bf_kdrv_mod...
insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko: Invalid module format
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory



As I can see the docker image is build very recently and I doubt it may have changed something. Is it possible for you to provide the older version of this image (approx 2 months old, when the missing json issue was solved). Else, how can I fix the above problem?



Thanks,

Deval.




--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev


--
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200517/2515c930/attachment-0001.html>

From yi at opennetworking.org  Sun May 17 10:48:54 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Sun, 17 May 2020 18:48:54 +0800
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <f46998c904f844ea8896623183b8d920@kau.se>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
Message-ID: <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>

Hi Deval,

Based on the email you send:

> Hello Yi,
>>
>> Thank you for the reply. So I tried the steps below on *ONL *
>> *3.16.64-OpenNetworkLinux*. I still get below error:
>>
>>
>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>> /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux
>> --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p
>> 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs
>> stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux
>>
>
We are no longer using "WITH_ONLP" variable and we expose additional TCP
port 9339

For SDE 8.9.0, we tested it several months ago and moved to version 8.9.2
since Barefoot upgraded the version.

Are you still getting the ONLP library issue when you are using the
container image "stratumproject/stratum-bf:8.9.2" ?
Can you try delete your local container image cache and pull it again?

Yi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200517/f8daab5d/attachment.html>

From Deval.Bhamare at kau.se  Sun May 17 18:42:24 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Sun, 17 May 2020 18:42:24 +0000
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>,
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
Message-ID: <3a8c8fc202844552bebc28aac508e626@kau.se>

Hello Yi,


I downloaded the image again and this time it looks like working. Below are the logs.


However, as you suggested, I modified stratum.flags  to remove "-bf_switchd_background=true" from stratum.flags file to use the command line from bf_switchd.


But command prompt doesn't appear. Any suggestions?


Thanks,

Deval.


Logs:


bf_switchd: dev_id 0 initialized

bf_switchd: initialized 1 devices
Skip p4 lib init
Skip mav diag lib init
bf_switchd: spawning cli server thread
bf_switchd: running in background; driver shell is disabled
bf_switchd: server started - listening on port 9999
E0517 18:08:29.853154     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853606     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853675     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.853701     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.854777685       8 server_chttp2.cc:40]        {"created":"@1589738909.854734733","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28000"}]}
E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
E0517 18:08:29.855722     8 hal.cc:365] StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to connect to all addresses
E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with procmon: Failed to check in with procmon: failed to connect to all addresses.





________________________________
From: Yi Tseng <yi at opennetworking.org>
Sent: Sunday, May 17, 2020 1:48:54 PM
To: Deval Bhamare
Cc: stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

Based on the email you send:

Hello Yi,

Thank you for the reply. So I tried the steps below on ONL 3.16.64-OpenNetworkLinux. I still get below error:


+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux

We are no longer using "WITH_ONLP" variable and we expose additional TCP port 9339

For SDE 8.9.0, we tested it several months ago and moved to version 8.9.2 since Barefoot upgraded the version.

Are you still getting the ONLP library issue when you are using the container image "stratumproject/stratum-bf:8.9.2" ?
Can you try delete your local container image cache and pull it again?

Yi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200517/1d652f85/attachment.html>

From dvelben at gmail.com  Mon May 18 14:18:31 2020
From: dvelben at gmail.com (Daniel Velasco)
Date: Mon, 18 May 2020 16:18:31 +0200
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <0101017223f1e6a4-8e14e916-4b59-4331-a2b6-7e15ca30d562-000000@us-west-2.amazonses.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
 <0101017223f1e6a4-8e14e916-4b59-4331-a2b6-7e15ca30d562-000000@us-west-2.amazonses.com>
Message-ID: <CACXs9cPcXfidLfNHUTSvqBLbBU1g4Mv4RmwWuzNn-7P9zzt+QA@mail.gmail.com>

Hi,

we are doing out first tests with stratum and we are getting same failure
with 9.1.0, are we missing something?

root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0
SDE_VERSION=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
+ PLATFORM_ARGS=
+ '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
+ PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
+ CONFIG_DIR=/root/stratum-configs
+ LOG_DIR=/root/stratum-configs
+ SDE_VERSION=9.1.0
++ uname -r
+ KERNEL_VERSION=4.14.49-OpenNetworkLinux
+ DOCKER_IMAGE=stratumproject/stratum-bf
+ DOCKER_IMAGE_TAG=9.1.0-4.14.49-OpenNetworkLinux
++ uname -r
++ uname -r
+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
/lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux
--env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v
/root/stratum-configs:/etc/stratum -v
/root/stratum-configs:/var/log/stratum
stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
Unable to find image
'stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux' locally
9.1.0-4.14.49-OpenNetworkLinux: Pulling from stratumproject/stratum-bf
3401a574d84f: Pull complete
26b758f54741: Pull complete
97d203f02ea3: Pull complete
Digest:
sha256:6c372f84b3ba56cd877afd2f049a80d7b97425b45c21358a6edf2396c5d11e19
Status: Downloaded newer image for
stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
bf_kdrv_mod found! Unloading first...
loading bf_kdrv_mod...
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1:
cannot open shared object file: No such file or directory
root at localhost:~/stratum-configs#

Thanks a lot!

BR / Dani

El dom., 17 may. 2020 a las 20:42, Deval Bhamare via stratum-dev (<
stratum-dev at lists.stratumproject.org>) escribió:

> Hello Yi,
>
>
> I downloaded the image again and this time it looks like working. Below
> are the logs.
>
>
> However, as you suggested, I modified *stratum.flags  to r*emove
> "-bf_switchd_background=true" from stratum.flags file to use the command
> line from bf_switchd.
>
>
> But *command prompt doesn't appear*. Any suggestions?
>
>
> Thanks,
>
> Deval.
>
>
> *Logs*:
>
>
> bf_switchd: dev_id 0 initialized
>
> bf_switchd: initialized 1 devices
> Skip p4 lib init
> Skip mav diag lib init
> bf_switchd: spawning cli server thread
> bf_switchd: running in background; driver shell is disabled
> bf_switchd: server started - listening on port 9999
> E0517 18:08:29.853154     8 utils.cc:109]
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
> not found.
> E0517 18:08:29.853606     8 utils.cc:65] Return Error:
> ReadFileToString(filename, &text) failed with
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
> not found.
> E0517 18:08:29.853675     8 utils.cc:109]
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
> not found.
> E0517 18:08:29.853701     8 utils.cc:65] Return Error:
> ReadFileToString(filename, &text) failed with
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
> not found.
> E0517 18:08:29.854777685       8 server_chttp2.cc:40]
> {"created":"@1589738909.854734733","description":"Only 1 addresses added
> out of total 2
> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address
> family not supported by
> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
> family not supported by
> protocol","syscall":"socket","target_address":"[::1]:28000"}]}
> E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing services
> are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
> E0517 18:08:29.855722     8 hal.cc:365] StratumErrorSpace::ERR_INTERNAL:
> Failed to check in with procmon: failed to connect to all addresses
> E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with
> procmon: Failed to check in with procmon: failed to connect to all
> addresses.
>
>
>
>
> ------------------------------
> *From:* Yi Tseng <yi at opennetworking.org>
> *Sent:* Sunday, May 17, 2020 1:48:54 PM
> *To:* Deval Bhamare
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
> older version for stratum
>
> Hi Deval,
>
> Based on the email you send:
>
>> Hello Yi,
>>>
>>> Thank you for the reply. So I tried the steps below on *ONL *
>>> *3.16.64-OpenNetworkLinux*. I still get below error:
>>>
>>>
>>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>>> /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux
>>> --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p
>>> 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs
>>> stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux
>>>
>>
> We are no longer using "WITH_ONLP" variable and we expose additional TCP
> port 9339
>
> For SDE 8.9.0, we tested it several months ago and moved to version 8.9.2
> since Barefoot upgraded the version.
>
> Are you still getting the ONLP library issue when you are using the
> container image "stratumproject/stratum-bf:8.9.2" ?
> Can you try delete your local container image cache and pull it again?
>
> Yi
>
> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200518/f3fe703d/attachment.html>

From Deval.Bhamare at kau.se  Mon May 18 14:52:42 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Mon, 18 May 2020 14:52:42 +0000
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <010101722826bc09-6e951bd1-5fbc-4be4-a3a6-8928ef748b09-000000@us-west-2.amazonses.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
 <0101017223f1e6a4-8e14e916-4b59-4331-a2b6-7e15ca30d562-000000@us-west-2.amazonses.com>,
 <010101722826bc09-6e951bd1-5fbc-4be4-a3a6-8928ef748b09-000000@us-west-2.amazonses.com>
Message-ID: <aa0ccd7cf6ce4d6abdba46516d5aa36b@kau.se>

Hi Dani,


I am just a stratum user and not from the dev community, but just a suggestion.


Can you try update your start-stratum script with below command and then try with the command given after that.


Update start script:


curl -o start-stratum-container.sh https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh
chmod +x start-stratum-container.sh



Use command:



PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh


(Here, should be DOCKER_IMAGE_TAG and not SDE_VERSION)


It will try with Image stratumproject/stratum-bf:9.1.0, rather than stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux.


Can you let me know the output?


Thanks,


Deval.

________________________________
From: stratum-dev <stratum-dev-bounces at lists.stratumproject.org> on behalf of Daniel Velasco via stratum-dev <stratum-dev at lists.stratumproject.org>
Sent: Monday, May 18, 2020 5:18:46 PM
To: stratum-dev at lists.stratumproject.org
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi,

we are doing out first tests with stratum and we are getting same failure with 9.1.0, are we missing something?

root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0 SDE_VERSION=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
+ PLATFORM_ARGS=
+ '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
+ PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
+ CONFIG_DIR=/root/stratum-configs
+ LOG_DIR=/root/stratum-configs
+ SDE_VERSION=9.1.0
++ uname -r
+ KERNEL_VERSION=4.14.49-OpenNetworkLinux
+ DOCKER_IMAGE=stratumproject/stratum-bf
+ DOCKER_IMAGE_TAG=9.1.0-4.14.49-OpenNetworkLinux
++ uname -r
++ uname -r
+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v /root/stratum-configs:/etc/stratum -v /root/stratum-configs:/var/log/stratum stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
Unable to find image 'stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux' locally
9.1.0-4.14.49-OpenNetworkLinux: Pulling from stratumproject/stratum-bf
3401a574d84f: Pull complete
26b758f54741: Pull complete
97d203f02ea3: Pull complete
Digest: sha256:6c372f84b3ba56cd877afd2f049a80d7b97425b45c21358a6edf2396c5d11e19
Status: Downloaded newer image for stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
bf_kdrv_mod found! Unloading first...
loading bf_kdrv_mod...
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory
root at localhost:~/stratum-configs#

Thanks a lot!

BR / Dani

El dom., 17 may. 2020 a las 20:42, Deval Bhamare via stratum-dev (<stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>>) escribió:

Hello Yi,


I downloaded the image again and this time it looks like working. Below are the logs.


However, as you suggested, I modified stratum.flags  to remove "-bf_switchd_background=true" from stratum.flags file to use the command line from bf_switchd.


But command prompt doesn't appear. Any suggestions?


Thanks,

Deval.


Logs:


bf_switchd: dev_id 0 initialized

bf_switchd: initialized 1 devices
Skip p4 lib init
Skip mav diag lib init
bf_switchd: spawning cli server thread
bf_switchd: running in background; driver shell is disabled
bf_switchd: server started - listening on port 9999
E0517 18:08:29.853154     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853606     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853675     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.853701     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.854777685       8 server_chttp2.cc:40]        {"created":"@1589738909.854734733","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28000"}]}
E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000<http://0.0.0.0:28000>, 0.0.0.0:9339<http://0.0.0.0:9339>, localhost:28000...
E0517 18:08:29.855722     8 hal.cc:365] StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to connect to all addresses
E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with procmon: Failed to check in with procmon: failed to connect to all addresses.





________________________________
From: Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>
Sent: Sunday, May 17, 2020 1:48:54 PM
To: Deval Bhamare
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

Based on the email you send:

Hello Yi,

Thank you for the reply. So I tried the steps below on ONL 3.16.64-OpenNetworkLinux. I still get below error:


+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux

We are no longer using "WITH_ONLP" variable and we expose additional TCP port 9339

For SDE 8.9.0, we tested it several months ago and moved to version 8.9.2 since Barefoot upgraded the version.

Are you still getting the ONLP library issue when you are using the container image "stratumproject/stratum-bf:8.9.2" ?
Can you try delete your local container image cache and pull it again?

Yi

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200518/c7c89aaa/attachment-0001.html>

From Deval.Bhamare at kau.se  Mon May 18 15:21:07 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Mon, 18 May 2020 15:21:07 +0000
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <CACXs9cOGtyhzt9Xda-+4iRv-Qu-h7_ZNUjGoDDUzrUDgV9qWww@mail.gmail.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
 <0101017223f1e6a4-8e14e916-4b59-4331-a2b6-7e15ca30d562-000000@us-west-2.amazonses.com>
 <010101722826bc09-6e951bd1-5fbc-4be4-a3a6-8928ef748b09-000000@us-west-2.amazonses.com>
 <aa0ccd7cf6ce4d6abdba46516d5aa36b@kau.se>,
 <CACXs9cOGtyhzt9Xda-+4iRv-Qu-h7_ZNUjGoDDUzrUDgV9qWww@mail.gmail.com>
Message-ID: <8de00c9ae9944255b33debe2d3112c65@kau.se>

Hi Dani,


I guess you can ignore procmon error.


The message below says stratum is up.


E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000<http://0.0.0.0:28000/>, 0.0.0.0:9339<http://0.0.0.0:9339/>, localhost:28000...


The only thing I need to figure out is getting command line from bf_switchd.


If you hit enter in the end, do you get any bf_sw command prompt? At least I am not getting any.


Dev team: Is it because of the following error:


ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0518 15:17:17.704537     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.




Ideally  stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinu should work on ONL, but I am getting the same error as you got (libonlp.so.1: cannot open shared object file: No such file or directory) and hopefully we will get some response soon.


/Deval.


________________________________
From: Daniel Velasco <dvelben at gmail.com>
Sent: Monday, May 18, 2020 6:09:32 PM
To: Deval Bhamare
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

if I use that command (with DOCKER_IMAGE_TAG), it uses the container stratumproject/stratum-bf:9.1.0, instead of stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux, that was the one I thought it should be.

In any case, if I do as you ask, I get the following error:

root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
+ PLATFORM_ARGS=
+ '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
+ PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
+ CONFIG_DIR=/root/stratum-configs
+ LOG_DIR=/root/stratum-configs
+ SDE_VERSION=9.0.0
++ uname -r
+ KERNEL_VERSION=4.14.49-OpenNetworkLinux
+ DOCKER_IMAGE=stratumproject/stratum-bf
+ DOCKER_IMAGE_TAG=9.1.0
++ uname -r
++ uname -r
+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v /root/stratum-configs:/etc/stratum -v /root/stratum-configs:/var/log/stratum stratumproject/stratum-bf:9.1.0
Cannot find /usr/lib/modules/bf_kdrv.ko, skip installing the Kernel module.
bf_sysfs_fname /sys/class/bf/bf0/device/dev_add
Install dir: /usr (0x55a9d74ea020)
error copying zlog config file "cp /usr/share/bfsys/zlog-cfg zlog-cfg-cur"
bf_switchd: system services initialized
bf_switchd: loading conf_file /usr/share/stratum/tofino_skip_p4_no_bsp.conf...
bf_switchd: processing device configuration...

...

bf_switchd: dev_id 0 initialized

bf_switchd: initialized 1 devices
bf_switchd: Credo python server thread initialized..Skip p4 lib init
Skip mav diag lib init
bf_switchd: spawning cli server thread
credo_python_intf: listen socket created
credo_python_intf: bind done on port 9001, listening...
credo_python_intf: listening for incoming connections...
bf_switchd: spawning driver shell
bf_switchd: server started - listening on port 9999
Cannot read termcap database;
using dumb terminal settings.
bf-sde>
bf-sde>
bf-sde>
bf-sde>
bf-sde> E0518 23:08:32.875291     6 phal.cc:91] No phal_config_file specified and no switch configurator found! This is probably not what you want. Did you forget to specify any '--define phal_with_*=true' Bazel flags?
E0518 23:08:32.876373699       6 server_chttp2.cc:40]        {"created":"@1589843312.876328305","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843312.876323313","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28003"}]}
E0518 23:08:33.497541     6 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0518 23:08:33.497881     6 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0518 23:08:33.498277684       6 server_chttp2.cc:40]        {"created":"@1589843313.498234870","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843313.498230982","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28000"}]}
E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000<http://0.0.0.0:28000>, 0.0.0.0:9339<http://0.0.0.0:9339>, localhost:28000...
E0518 23:08:33.499231     6 hal.cc:365] StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to connect to all addresses
E0518 23:08:33.499338     6 hal.cc:233] Error when checking in with procmon: Failed to check in with procmon: failed to connect to all addresses.




El lun., 18 may. 2020 a las 16:52, Deval Bhamare (<Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>>) escribió:

Hi Dani,


I am just a stratum user and not from the dev community, but just a suggestion.


Can you try update your start-stratum script with below command and then try with the command given after that.


Update start script:


curl -o start-stratum-container.sh https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh
chmod +x start-stratum-container.sh



Use command:



PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh


(Here, should be DOCKER_IMAGE_TAG and not SDE_VERSION)


It will try with Image stratumproject/stratum-bf:9.1.0, rather than stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux.


Can you let me know the output?


Thanks,


Deval.

________________________________
From: stratum-dev <stratum-dev-bounces at lists.stratumproject.org<mailto:stratum-dev-bounces at lists.stratumproject.org>> on behalf of Daniel Velasco via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>>
Sent: Monday, May 18, 2020 5:18:46 PM
To: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi,

we are doing out first tests with stratum and we are getting same failure with 9.1.0, are we missing something?

root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0 SDE_VERSION=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
+ PLATFORM_ARGS=
+ '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
+ PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
+ CONFIG_DIR=/root/stratum-configs
+ LOG_DIR=/root/stratum-configs
+ SDE_VERSION=9.1.0
++ uname -r
+ KERNEL_VERSION=4.14.49-OpenNetworkLinux
+ DOCKER_IMAGE=stratumproject/stratum-bf
+ DOCKER_IMAGE_TAG=9.1.0-4.14.49-OpenNetworkLinux
++ uname -r
++ uname -r
+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v /root/stratum-configs:/etc/stratum -v /root/stratum-configs:/var/log/stratum stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
Unable to find image 'stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux' locally
9.1.0-4.14.49-OpenNetworkLinux: Pulling from stratumproject/stratum-bf
3401a574d84f: Pull complete
26b758f54741: Pull complete
97d203f02ea3: Pull complete
Digest: sha256:6c372f84b3ba56cd877afd2f049a80d7b97425b45c21358a6edf2396c5d11e19
Status: Downloaded newer image for stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
bf_kdrv_mod found! Unloading first...
loading bf_kdrv_mod...
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory
root at localhost:~/stratum-configs#

Thanks a lot!

BR / Dani

El dom., 17 may. 2020 a las 20:42, Deval Bhamare via stratum-dev (<stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>>) escribió:

Hello Yi,


I downloaded the image again and this time it looks like working. Below are the logs.


However, as you suggested, I modified stratum.flags  to remove "-bf_switchd_background=true" from stratum.flags file to use the command line from bf_switchd.


But command prompt doesn't appear. Any suggestions?


Thanks,

Deval.


Logs:


bf_switchd: dev_id 0 initialized

bf_switchd: initialized 1 devices
Skip p4 lib init
Skip mav diag lib init
bf_switchd: spawning cli server thread
bf_switchd: running in background; driver shell is disabled
bf_switchd: server started - listening on port 9999
E0517 18:08:29.853154     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853606     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853675     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.853701     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.854777685       8 server_chttp2.cc:40]        {"created":"@1589738909.854734733","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28000"}]}
E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000<http://0.0.0.0:28000>, 0.0.0.0:9339<http://0.0.0.0:9339>, localhost:28000...
E0517 18:08:29.855722     8 hal.cc:365] StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to connect to all addresses
E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with procmon: Failed to check in with procmon: failed to connect to all addresses.





________________________________
From: Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>
Sent: Sunday, May 17, 2020 1:48:54 PM
To: Deval Bhamare
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

Based on the email you send:

Hello Yi,

Thank you for the reply. So I tried the steps below on ONL 3.16.64-OpenNetworkLinux. I still get below error:


+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux

We are no longer using "WITH_ONLP" variable and we expose additional TCP port 9339

For SDE 8.9.0, we tested it several months ago and moved to version 8.9.2 since Barefoot upgraded the version.

Are you still getting the ONLP library issue when you are using the container image "stratumproject/stratum-bf:8.9.2" ?
Can you try delete your local container image cache and pull it again?

Yi

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200518/68d05c93/attachment-0001.html>

From max at opennetworking.org  Mon May 18 18:07:35 2020
From: max at opennetworking.org (Maximilian Pudelko)
Date: Mon, 18 May 2020 11:07:35 -0700
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <01010172285ffeeb-a748f3fb-a4da-481c-8bf2-245eee165df7-000000@us-west-2.amazonses.com>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
 <0101017223f1e6a4-8e14e916-4b59-4331-a2b6-7e15ca30d562-000000@us-west-2.amazonses.com>
 <010101722826bc09-6e951bd1-5fbc-4be4-a3a6-8928ef748b09-000000@us-west-2.amazonses.com>
 <aa0ccd7cf6ce4d6abdba46516d5aa36b@kau.se>
 <CACXs9cOGtyhzt9Xda-+4iRv-Qu-h7_ZNUjGoDDUzrUDgV9qWww@mail.gmail.com>
 <01010172285ffeeb-a748f3fb-a4da-481c-8bf2-245eee165df7-000000@us-west-2.amazonses.com>
Message-ID: <CAFh9Y_NhXfEOKa2U2jvUdrqvHeVRG9qKxah5zRySH70W=4pbmQ@mail.gmail.com>

Hi all,

I'll try to answer some of the questions:

> StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed
to connect to all addresses
You can ignore this, that error is a leftover from the Google codebase.

> ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
This means there was no ChassisConfig (Stratum's settings storage) found
under the path you gave with `-chassis_config_file=<path>`.
When you download a default one, like Yi described above, you'll likely
have to adjust the path so it's correct. Or just use the gnmi cli to push
it:
https://github.com/stratum/stratum/blob/9f5bd2b285badbef11e81eca6c31d4a3c4342843/tools/gnmi/README.md#L50

Max


On Mon, May 18, 2020 at 8:21 AM Deval Bhamare via stratum-dev <
stratum-dev at lists.stratumproject.org> wrote:

> Hi Dani,
>
>
> I guess you can ignore procmon error.
>
>
> The message below says stratum is up.
>
>
> E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services
> are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
>
>
> The only thing I need to figure out is getting command line from
> bf_switchd.
>
>
> If you hit enter in the end, do you get any bf_sw command prompt? At least
> I am not getting any.
>
>
> *Dev team*: Is it because of the following error:
>
>
> *ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.*
> E0518 15:17:17.704537     8 utils.cc:65] Return Error:
> ReadFileToString(filename, &text) failed with
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
> not found.
>
>
>
> Ideally  stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinu should
> work on ONL, but I am getting the same error as you got (libonlp.so.1:
> cannot open shared object file: No such file or directory) and hopefully
> we will get some response soon.
>
>
> /Deval.
>
>
> ------------------------------
> *From:* Daniel Velasco <dvelben at gmail.com>
> *Sent:* Monday, May 18, 2020 6:09:32 PM
> *To:* Deval Bhamare
> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
> older version for stratum
>
> Hi Deval,
>
> if I use that command (with DOCKER_IMAGE_TAG), it uses the
> container stratumproject/stratum-bf:9.1.0, instead of
> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux, that was the one
> I thought it should be.
>
> In any case, if I do as you ask, I get the following error:
>
>
> root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0
> DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD
> ./start-stratum-container.sh
> + PLATFORM_ARGS=
> + '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
> + PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
> + CONFIG_DIR=/root/stratum-configs
> + LOG_DIR=/root/stratum-configs
> + SDE_VERSION=9.0.0
> ++ uname -r
> + KERNEL_VERSION=4.14.49-OpenNetworkLinux
> + DOCKER_IMAGE=stratumproject/stratum-bf
> + DOCKER_IMAGE_TAG=9.1.0
> ++ uname -r
> ++ uname -r
> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
> /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux
> --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v
> /root/stratum-configs:/etc/stratum -v
> /root/stratum-configs:/var/log/stratum stratumproject/stratum-bf:9.1.0
> Cannot find /usr/lib/modules/bf_kdrv.ko, skip installing the Kernel module.
> bf_sysfs_fname /sys/class/bf/bf0/device/dev_add
> Install dir: /usr (0x55a9d74ea020)
> error copying zlog config file "cp /usr/share/bfsys/zlog-cfg zlog-cfg-cur"
> bf_switchd: system services initialized
> bf_switchd: loading conf_file
> /usr/share/stratum/tofino_skip_p4_no_bsp.conf...
> bf_switchd: processing device configuration...
>
> ...
>
>
> bf_switchd: dev_id 0 initialized
>
> bf_switchd: initialized 1 devices
> bf_switchd: Credo python server thread initialized..Skip p4 lib init
> Skip mav diag lib init
> bf_switchd: spawning cli server thread
> credo_python_intf: listen socket created
> credo_python_intf: bind done on port 9001, listening...
> credo_python_intf: listening for incoming connections...
> bf_switchd: spawning driver shell
> bf_switchd: server started - listening on port 9999
> Cannot read termcap database;
> using dumb terminal settings.
> bf-sde>
> bf-sde>
> bf-sde>
> bf-sde>
> bf-sde> E0518 23:08:32.875291     6 phal.cc:91] No phal_config_file
> specified and no switch configurator found! This is probably not what you
> want. Did you forget to specify any '--define phal_with_*=true' Bazel flags?
> E0518 23:08:32.876373699       6 server_chttp2.cc:40]
>  {"created":"@1589843312.876328305","description":"Only 1 addresses added
> out of total 2
> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843312.876323313","description":"Address
> family not supported by
> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
> family not supported by
> protocol","syscall":"socket","target_address":"[::1]:28003"}]}
> E0518 23:08:33.497541     6 utils.cc:109]
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
> not found.
> E0518 23:08:33.497881     6 utils.cc:65] Return Error:
> ReadFileToString(filename, &text) failed with
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
> not found.
> E0518 23:08:33.498277684       6 server_chttp2.cc:40]
>  {"created":"@1589843313.498234870","description":"Only 1 addresses added
> out of total 2
> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843313.498230982","description":"Address
> family not supported by
> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
> family not supported by
> protocol","syscall":"socket","target_address":"[::1]:28000"}]}
> E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services
> are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
> E0518 23:08:33.499231     6 hal.cc:365] StratumErrorSpace::ERR_INTERNAL:
> Failed to check in with procmon: failed to connect to all addresses
> E0518 23:08:33.499338     6 hal.cc:233] Error when checking in with
> procmon: Failed to check in with procmon: failed to connect to all
> addresses.
>
>
>
>
>
> El lun., 18 may. 2020 a las 16:52, Deval Bhamare (<Deval.Bhamare at kau.se>)
> escribió:
>
>> Hi Dani,
>>
>>
>> I am just a stratum user and not from the dev community, but just a
>> suggestion.
>>
>>
>> Can you try update your start-stratum script with below command and then
>> try with the command given after that.
>>
>>
>> *Update start script: *
>>
>>
>> *curl -o start-stratum-container.sh *
>> *https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh*
>> <https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh>
>> *chmod +x start-stratum-container.sh*
>>
>>
>>
>> *Use command: *
>>
>>
>>
>> PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0
>> CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
>>
>>
>> (Here, should be *DOCKER_IMAGE_TAG* and not *SDE_VERSION*)
>>
>>
>> It will try with Image stratumproject/stratum-bf:9.1.0, rather than
>> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux.
>>
>>
>> Can you let me know the output?
>>
>>
>> Thanks,
>>
>>
>> Deval.
>> ------------------------------
>> *From:* stratum-dev <stratum-dev-bounces at lists.stratumproject.org> on
>> behalf of Daniel Velasco via stratum-dev <
>> stratum-dev at lists.stratumproject.org>
>> *Sent:* Monday, May 18, 2020 5:18:46 PM
>> *To:* stratum-dev at lists.stratumproject.org
>> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
>> older version for stratum
>>
>> Hi,
>>
>> we are doing out first tests with stratum and we are getting same failure
>> with 9.1.0, are we missing something?
>>
>> root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0
>> SDE_VERSION=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
>> + PLATFORM_ARGS=
>> + '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
>> + PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
>> + CONFIG_DIR=/root/stratum-configs
>> + LOG_DIR=/root/stratum-configs
>> + SDE_VERSION=9.1.0
>> ++ uname -r
>> + KERNEL_VERSION=4.14.49-OpenNetworkLinux
>> + DOCKER_IMAGE=stratumproject/stratum-bf
>> + DOCKER_IMAGE_TAG=9.1.0-4.14.49-OpenNetworkLinux
>> ++ uname -r
>> ++ uname -r
>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>> /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux
>> --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v
>> /root/stratum-configs:/etc/stratum -v
>> /root/stratum-configs:/var/log/stratum
>> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
>> Unable to find image
>> 'stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux' locally
>> 9.1.0-4.14.49-OpenNetworkLinux: Pulling from stratumproject/stratum-bf
>> 3401a574d84f: Pull complete
>> 26b758f54741: Pull complete
>> 97d203f02ea3: Pull complete
>> Digest:
>> sha256:6c372f84b3ba56cd877afd2f049a80d7b97425b45c21358a6edf2396c5d11e19
>> Status: Downloaded newer image for
>> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
>> bf_kdrv_mod found! Unloading first...
>> loading bf_kdrv_mod...
>> /usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1:
>> cannot open shared object file: No such file or directory
>> root at localhost:~/stratum-configs#
>>
>> Thanks a lot!
>>
>> BR / Dani
>>
>> El dom., 17 may. 2020 a las 20:42, Deval Bhamare via stratum-dev (<
>> stratum-dev at lists.stratumproject.org>) escribió:
>>
>>> Hello Yi,
>>>
>>>
>>> I downloaded the image again and this time it looks like working. Below
>>> are the logs.
>>>
>>>
>>> However, as you suggested, I modified *stratum.flags  to r*emove
>>> "-bf_switchd_background=true" from stratum.flags file to use the command
>>> line from bf_switchd.
>>>
>>>
>>> But *command prompt doesn't appear*. Any suggestions?
>>>
>>>
>>> Thanks,
>>>
>>> Deval.
>>>
>>>
>>> *Logs*:
>>>
>>>
>>> bf_switchd: dev_id 0 initialized
>>>
>>> bf_switchd: initialized 1 devices
>>> Skip p4 lib init
>>> Skip mav diag lib init
>>> bf_switchd: spawning cli server thread
>>> bf_switchd: running in background; driver shell is disabled
>>> bf_switchd: server started - listening on port 9999
>>> E0517 18:08:29.853154     8 utils.cc:109]
>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
>>> not found.
>>> E0517 18:08:29.853606     8 utils.cc:65] Return Error:
>>> ReadFileToString(filename, &text) failed with
>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
>>> not found.
>>> E0517 18:08:29.853675     8 utils.cc:109]
>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
>>> not found.
>>> E0517 18:08:29.853701     8 utils.cc:65] Return Error:
>>> ReadFileToString(filename, &text) failed with
>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
>>> not found.
>>> E0517 18:08:29.854777685       8 server_chttp2.cc:40]
>>> {"created":"@1589738909.854734733","description":"Only 1 addresses added
>>> out of total 2
>>> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address
>>> family not supported by
>>> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
>>> family not supported by
>>> protocol","syscall":"socket","target_address":"[::1]:28000"}]}
>>> E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing services
>>> are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
>>> E0517 18:08:29.855722     8 hal.cc:365] StratumErrorSpace::ERR_INTERNAL:
>>> Failed to check in with procmon: failed to connect to all addresses
>>> E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with
>>> procmon: Failed to check in with procmon: failed to connect to all
>>> addresses.
>>>
>>>
>>>
>>>
>>> ------------------------------
>>> *From:* Yi Tseng <yi at opennetworking.org>
>>> *Sent:* Sunday, May 17, 2020 1:48:54 PM
>>> *To:* Deval Bhamare
>>> *Cc:* stratum-dev at lists.stratumproject.org
>>> *Subject:* Re: [stratum-dev] Docker image
>>> 8.9.2-3.16.56-OpenNetworkLinux older version for stratum
>>>
>>> Hi Deval,
>>>
>>> Based on the email you send:
>>>
>>>> Hello Yi,
>>>>>
>>>>> Thank you for the reply. So I tried the steps below on *ONL *
>>>>> *3.16.64-OpenNetworkLinux*. I still get below error:
>>>>>
>>>>>
>>>>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>>>>> /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux
>>>>> --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p
>>>>> 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs
>>>>> stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux
>>>>>
>>>>
>>> We are no longer using "WITH_ONLP" variable and we expose additional TCP
>>> port 9339
>>>
>>> For SDE 8.9.0, we tested it several months ago and moved to version
>>> 8.9.2 since Barefoot upgraded the version.
>>>
>>> Are you still getting the ONLP library issue when you are using the
>>> container image "stratumproject/stratum-bf:8.9.2" ?
>>> Can you try delete your local container image cache and pull it again?
>>>
>>> Yi
>>>
>>> _______________________________________________
>>> stratum-dev mailing list
>>> stratum-dev at lists.stratumproject.org
>>> https://lists.stratumproject.org/listinfo/stratum-dev
>>
>> _______________________________________________
> stratum-dev mailing list
> stratum-dev at lists.stratumproject.org
> https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200518/231d2bac/attachment-0001.html>

From yi at opennetworking.org  Tue May 19 00:07:22 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Tue, 19 May 2020 08:07:22 +0800
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <3a8c8fc202844552bebc28aac508e626@kau.se>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
 <3a8c8fc202844552bebc28aac508e626@kau.se>
Message-ID: <CAOyFVR3WrrdVxHba+7PHHpGx=At3S1fQuonspZLyjDB4BGTJ5w@mail.gmail.com>

Hi Deval,

Can you try hit *enter*? The prompt won't show automatically after Stratum
started.

Yi

On Mon, May 18, 2020 at 2:42 AM Deval Bhamare <Deval.Bhamare at kau.se> wrote:

> Hello Yi,
>
>
> I downloaded the image again and this time it looks like working. Below
> are the logs.
>
>
> However, as you suggested, I modified *stratum.flags  to r*emove
> "-bf_switchd_background=true" from stratum.flags file to use the command
> line from bf_switchd.
>
>
> But *command prompt doesn't appear*. Any suggestions?
>
>
> Thanks,
>
> Deval.
>
>
> *Logs*:
>
>
> bf_switchd: dev_id 0 initialized
>
> bf_switchd: initialized 1 devices
> Skip p4 lib init
> Skip mav diag lib init
> bf_switchd: spawning cli server thread
> bf_switchd: running in background; driver shell is disabled
> bf_switchd: server started - listening on port 9999
> E0517 18:08:29.853154     8 utils.cc:109]
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
> not found.
> E0517 18:08:29.853606     8 utils.cc:65] Return Error:
> ReadFileToString(filename, &text) failed with
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
> not found.
> E0517 18:08:29.853675     8 utils.cc:109]
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
> not found.
> E0517 18:08:29.853701     8 utils.cc:65] Return Error:
> ReadFileToString(filename, &text) failed with
> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
> not found.
> E0517 18:08:29.854777685       8 server_chttp2.cc:40]
> {"created":"@1589738909.854734733","description":"Only 1 addresses added
> out of total 2
> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address
> family not supported by
> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
> family not supported by
> protocol","syscall":"socket","target_address":"[::1]:28000"}]}
> E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing services
> are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
> E0517 18:08:29.855722     8 hal.cc:365] StratumErrorSpace::ERR_INTERNAL:
> Failed to check in with procmon: failed to connect to all addresses
> E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with
> procmon: Failed to check in with procmon: failed to connect to all
> addresses.
>
>
>
>
> ------------------------------
> *From:* Yi Tseng <yi at opennetworking.org>
> *Sent:* Sunday, May 17, 2020 1:48:54 PM
> *To:* Deval Bhamare
> *Cc:* stratum-dev at lists.stratumproject.org
> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
> older version for stratum
>
> Hi Deval,
>
> Based on the email you send:
>
>> Hello Yi,
>>>
>>> Thank you for the reply. So I tried the steps below on *ONL *
>>> *3.16.64-OpenNetworkLinux*. I still get below error:
>>>
>>>
>>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>>> /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux
>>> --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p
>>> 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs
>>> stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux
>>>
>>
> We are no longer using "WITH_ONLP" variable and we expose additional TCP
> port 9339
>
> For SDE 8.9.0, we tested it several months ago and moved to version 8.9.2
> since Barefoot upgraded the version.
>
> Are you still getting the ONLP library issue when you are using the
> container image "stratumproject/stratum-bf:8.9.2" ?
> Can you try delete your local container image cache and pull it again?
>
> Yi
>
>

-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200519/6b0cf251/attachment.html>

From Deval.Bhamare at kau.se  Sun May 24 19:23:47 2020
From: Deval.Bhamare at kau.se (Deval Bhamare)
Date: Sun, 24 May 2020 19:23:47 +0000
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <8bd86c73ebde4bbaa090d97a3f68ea5f@kau.se>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
 <0101017223f1e6a4-8e14e916-4b59-4331-a2b6-7e15ca30d562-000000@us-west-2.amazonses.com>
 <010101722826bc09-6e951bd1-5fbc-4be4-a3a6-8928ef748b09-000000@us-west-2.amazonses.com>
 <aa0ccd7cf6ce4d6abdba46516d5aa36b@kau.se>
 <CACXs9cOGtyhzt9Xda-+4iRv-Qu-h7_ZNUjGoDDUzrUDgV9qWww@mail.gmail.com>
 <01010172285ffeeb-a748f3fb-a4da-481c-8bf2-245eee165df7-000000@us-west-2.amazonses.com>
 <CAFh9Y_NhXfEOKa2U2jvUdrqvHeVRG9qKxah5zRySH70W=4pbmQ@mail.gmail.com>
 <85d6d85e2ae94d1fb838ad371918e40f@kau.se>
 <e0be5635f8ed447f9623d643b116da20@kau.se>,
 <CAFh9Y_M8oxdqtdwqQ3+h5JYRRRLeM3r9RkPsB5UFqFDrQmjXWQ@mail.gmail.com>,
 <8bd86c73ebde4bbaa090d97a3f68ea5f@kau.se>
Message-ID: <30858c5f86ec41fb979b92e94849f10e@kau.se>

Hello Team,


Thank you for your support so far. Stratum works with docker image 8.9.2 on my ONL.


However, it still gives the same error below when I try with 8.9.2-3.16.56-OpenNetworkLinux image.

Any idea about this?


loading bf_kdrv_mod...
insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko: Invalid module format
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory



Also, does it affect the switch performance if docker image with and without ONL support is used? Any insights on that part please?


thanks,


deval.

________________________________
From: Deval Bhamare
Sent: Wednesday, May 20, 2020 11:00:45 AM
To: Maximilian Pudelko; Yi Tseng
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum


Ok, thanks.


@YI, I tried hitting enter , and as mentioned below, I an getting the bf_sde prompt.


Thanks,

Deval.

________________________________
From: Maximilian Pudelko <max at opennetworking.org>
Sent: Tuesday, May 19, 2020 12:15:38 AM
To: Deval Bhamare
Cc: Daniel Velasco; Yi Tseng
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

That's normal on the first startup. Now you have to push your compiled P4 program to the switch via P4Runtime, e.g. with the p4runtime-shell<https://github.com/p4lang/p4runtime-shell>
There are also some scripts in the source tree that might help: https://github.com/stratum/stratum/blob/9f5bd2b285badbef11e81eca6c31d4a3c4342843/stratum/hal/bin/barefoot/update_config.py

Max

On Mon, May 18, 2020 at 1:28 PM Deval Bhamare <Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>> wrote:


Hi,

Sorry for the incomplete message. I downloaded chasis_config afresh and that error is gone, however, I still get below error:

E0518 20:04:16.774682     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.

E0518 20:04:16.776194     8 hal.cc:233] Error when checking in with procmon: Failed to check in with procmon: failed to connect to all addresses.



Where can I find pipeline_config.pb.txt?

However, now I get the bf_sde> prompt.


thanks,


Deval.

________________________________
From: Deval Bhamare
Sent: Monday, May 18, 2020 11:26:00 PM
To: Maximilian Pudelko
Cc: Daniel Velasco; Yi Tseng
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum


Hi,


I downloaded chasis_config afresh and that error is gone, however, I still get below error:


________________________________
From: Maximilian Pudelko <max at opennetworking.org<mailto:max at opennetworking.org>>
Sent: Monday, May 18, 2020 9:07:35 PM
To: Deval Bhamare
Cc: Daniel Velasco; stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi all,

I'll try to answer some of the questions:

> StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to connect to all addresses
You can ignore this, that error is a leftover from the Google codebase.

> ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
This means there was no ChassisConfig (Stratum's settings storage) found under the path you gave with `-chassis_config_file=<path>`.
When you download a default one, like Yi described above, you'll likely have to adjust the path so it's correct. Or just use the gnmi cli to push it: https://github.com/stratum/stratum/blob/9f5bd2b285badbef11e81eca6c31d4a3c4342843/tools/gnmi/README.md#L50

Max


On Mon, May 18, 2020 at 8:21 AM Deval Bhamare via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>> wrote:

Hi Dani,


I guess you can ignore procmon error.


The message below says stratum is up.


E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000<http://0.0.0.0:28000/>, 0.0.0.0:9339<http://0.0.0.0:9339/>, localhost:28000...


The only thing I need to figure out is getting command line from bf_switchd.


If you hit enter in the end, do you get any bf_sw command prompt? At least I am not getting any.


Dev team: Is it because of the following error:


ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0518 15:17:17.704537     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.




Ideally  stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinu should work on ONL, but I am getting the same error as you got (libonlp.so.1: cannot open shared object file: No such file or directory) and hopefully we will get some response soon.


/Deval.


________________________________
From: Daniel Velasco <dvelben at gmail.com<mailto:dvelben at gmail.com>>
Sent: Monday, May 18, 2020 6:09:32 PM
To: Deval Bhamare
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

if I use that command (with DOCKER_IMAGE_TAG), it uses the container stratumproject/stratum-bf:9.1.0, instead of stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux, that was the one I thought it should be.

In any case, if I do as you ask, I get the following error:

root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
+ PLATFORM_ARGS=
+ '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
+ PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
+ CONFIG_DIR=/root/stratum-configs
+ LOG_DIR=/root/stratum-configs
+ SDE_VERSION=9.0.0
++ uname -r
+ KERNEL_VERSION=4.14.49-OpenNetworkLinux
+ DOCKER_IMAGE=stratumproject/stratum-bf
+ DOCKER_IMAGE_TAG=9.1.0
++ uname -r
++ uname -r
+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v /root/stratum-configs:/etc/stratum -v /root/stratum-configs:/var/log/stratum stratumproject/stratum-bf:9.1.0
Cannot find /usr/lib/modules/bf_kdrv.ko, skip installing the Kernel module.
bf_sysfs_fname /sys/class/bf/bf0/device/dev_add
Install dir: /usr (0x55a9d74ea020)
error copying zlog config file "cp /usr/share/bfsys/zlog-cfg zlog-cfg-cur"
bf_switchd: system services initialized
bf_switchd: loading conf_file /usr/share/stratum/tofino_skip_p4_no_bsp.conf...
bf_switchd: processing device configuration...

...

bf_switchd: dev_id 0 initialized

bf_switchd: initialized 1 devices
bf_switchd: Credo python server thread initialized..Skip p4 lib init
Skip mav diag lib init
bf_switchd: spawning cli server thread
credo_python_intf: listen socket created
credo_python_intf: bind done on port 9001, listening...
credo_python_intf: listening for incoming connections...
bf_switchd: spawning driver shell
bf_switchd: server started - listening on port 9999
Cannot read termcap database;
using dumb terminal settings.
bf-sde>
bf-sde>
bf-sde>
bf-sde>
bf-sde> E0518 23:08:32.875291     6 phal.cc:91] No phal_config_file specified and no switch configurator found! This is probably not what you want. Did you forget to specify any '--define phal_with_*=true' Bazel flags?
E0518 23:08:32.876373699       6 server_chttp2.cc:40]        {"created":"@1589843312.876328305","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843312.876323313","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28003"}]}
E0518 23:08:33.497541     6 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0518 23:08:33.497881     6 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0518 23:08:33.498277684       6 server_chttp2.cc:40]        {"created":"@1589843313.498234870","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843313.498230982","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28000"}]}
E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000<http://0.0.0.0:28000>, 0.0.0.0:9339<http://0.0.0.0:9339>, localhost:28000...
E0518 23:08:33.499231     6 hal.cc:365] StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to connect to all addresses
E0518 23:08:33.499338     6 hal.cc:233] Error when checking in with procmon: Failed to check in with procmon: failed to connect to all addresses.




El lun., 18 may. 2020 a las 16:52, Deval Bhamare (<Deval.Bhamare at kau.se<mailto:Deval.Bhamare at kau.se>>) escribió:

Hi Dani,


I am just a stratum user and not from the dev community, but just a suggestion.


Can you try update your start-stratum script with below command and then try with the command given after that.


Update start script:


curl -o start-stratum-container.sh https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh
chmod +x start-stratum-container.sh



Use command:



PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh


(Here, should be DOCKER_IMAGE_TAG and not SDE_VERSION)


It will try with Image stratumproject/stratum-bf:9.1.0, rather than stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux.


Can you let me know the output?


Thanks,


Deval.

________________________________
From: stratum-dev <stratum-dev-bounces at lists.stratumproject.org<mailto:stratum-dev-bounces at lists.stratumproject.org>> on behalf of Daniel Velasco via stratum-dev <stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>>
Sent: Monday, May 18, 2020 5:18:46 PM
To: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi,

we are doing out first tests with stratum and we are getting same failure with 9.1.0, are we missing something?

root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0 SDE_VERSION=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
+ PLATFORM_ARGS=
+ '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
+ PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
+ CONFIG_DIR=/root/stratum-configs
+ LOG_DIR=/root/stratum-configs
+ SDE_VERSION=9.1.0
++ uname -r
+ KERNEL_VERSION=4.14.49-OpenNetworkLinux
+ DOCKER_IMAGE=stratumproject/stratum-bf
+ DOCKER_IMAGE_TAG=9.1.0-4.14.49-OpenNetworkLinux
++ uname -r
++ uname -r
+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v /root/stratum-configs:/etc/stratum -v /root/stratum-configs:/var/log/stratum stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
Unable to find image 'stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux' locally
9.1.0-4.14.49-OpenNetworkLinux: Pulling from stratumproject/stratum-bf
3401a574d84f: Pull complete
26b758f54741: Pull complete
97d203f02ea3: Pull complete
Digest: sha256:6c372f84b3ba56cd877afd2f049a80d7b97425b45c21358a6edf2396c5d11e19
Status: Downloaded newer image for stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
bf_kdrv_mod found! Unloading first...
loading bf_kdrv_mod...
/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1: cannot open shared object file: No such file or directory
root at localhost:~/stratum-configs#

Thanks a lot!

BR / Dani

El dom., 17 may. 2020 a las 20:42, Deval Bhamare via stratum-dev (<stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>>) escribió:

Hello Yi,


I downloaded the image again and this time it looks like working. Below are the logs.


However, as you suggested, I modified stratum.flags  to remove "-bf_switchd_background=true" from stratum.flags file to use the command line from bf_switchd.


But command prompt doesn't appear. Any suggestions?


Thanks,

Deval.


Logs:


bf_switchd: dev_id 0 initialized

bf_switchd: initialized 1 devices
Skip p4 lib init
Skip mav diag lib init
bf_switchd: spawning cli server thread
bf_switchd: running in background; driver shell is disabled
bf_switchd: server started - listening on port 9999
E0517 18:08:29.853154     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853606     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
E0517 18:08:29.853675     8 utils.cc:109] StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.853701     8 utils.cc:65] Return Error: ReadFileToString(filename, &text) failed with StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt not found.
E0517 18:08:29.854777685       8 server_chttp2.cc:40]        {"created":"@1589738909.854734733","description":"Only 1 addresses added out of total 2 resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address family not supported by protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address family not supported by protocol","syscall":"socket","target_address":"[::1]:28000"}]}
E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing services are listening to 0.0.0.0:28000<http://0.0.0.0:28000>, 0.0.0.0:9339<http://0.0.0.0:9339>, localhost:28000...
E0517 18:08:29.855722     8 hal.cc:365] StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to connect to all addresses
E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with procmon: Failed to check in with procmon: failed to connect to all addresses.





________________________________
From: Yi Tseng <yi at opennetworking.org<mailto:yi at opennetworking.org>>
Sent: Sunday, May 17, 2020 1:48:54 PM
To: Deval Bhamare
Cc: stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
Subject: Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older version for stratum

Hi Deval,

Based on the email you send:

Hello Yi,

Thank you for the reply. So I tried the steps below on ONL 3.16.64-OpenNetworkLinux. I still get below error:


+ docker run -it --privileged -v /dev:/dev -v /sys:/sys -v /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux

We are no longer using "WITH_ONLP" variable and we expose additional TCP port 9339

For SDE 8.9.0, we tested it several months ago and moved to version 8.9.2 since Barefoot upgraded the version.

Are you still getting the ONLP library issue when you are using the container image "stratumproject/stratum-bf:8.9.2" ?
Can you try delete your local container image cache and pull it again?

Yi

_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev
_______________________________________________
stratum-dev mailing list
stratum-dev at lists.stratumproject.org<mailto:stratum-dev at lists.stratumproject.org>
https://lists.stratumproject.org/listinfo/stratum-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200524/41e41006/attachment-0001.html>

From yi at opennetworking.org  Thu May 28 15:12:09 2020
From: yi at opennetworking.org (Yi Tseng)
Date: Thu, 28 May 2020 23:12:09 +0800
Subject: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux older
 version for stratum
In-Reply-To: <30858c5f86ec41fb979b92e94849f10e@kau.se>
References: <4e16102a93f24c1d9e1632d0cc0f83be@kau.se>
 <61d3dc537ed44747a8b89d88bede753f@kau.se>
 <0101017219a0d236-b0e0db0e-b32d-4ea8-85da-4d62b49ec861-000000@us-west-2.amazonses.com>
 <CAFh9Y_OZE5ct6qs39-bXx7YCdaatjj_AzdQ+qzeXeFKTcPCt7w@mail.gmail.com>
 <64baaef3c60c4555a8c58a6c61bb86da@kau.se>
 <CAFh9Y_M9U5BmLxNKgt5CdBA_sPaQP3-j7SsJ8mo62o=H2d_Vcw@mail.gmail.com>
 <12eb0ed15a914d348f903194774b19f9@kau.se>
 <CAOyFVR2wB+rC-1GtB4cHu2w3-271N3mEDuKFZPW0oCLm00sL_Q@mail.gmail.com>
 <0101017221853ba8-e5e5e765-4685-4ec5-a7fa-0c1e15ef5987-000000@us-west-2.amazonses.com>
 <79421450f31c44b48bc8ec4505e7c4ec@kau.se>
 <CAOyFVR3QJ-ZNjH5+QAne0URrdx0Nrso-i-sm88=xNiLTN6cU-Q@mail.gmail.com>
 <f46998c904f844ea8896623183b8d920@kau.se>
 <CAOyFVR17CWYHsoBEpBSui0pfYFhdg1XbnXaHOA2cQ7TKp8ahFA@mail.gmail.com>
 <0101017223f1e6a4-8e14e916-4b59-4331-a2b6-7e15ca30d562-000000@us-west-2.amazonses.com>
 <010101722826bc09-6e951bd1-5fbc-4be4-a3a6-8928ef748b09-000000@us-west-2.amazonses.com>
 <aa0ccd7cf6ce4d6abdba46516d5aa36b@kau.se>
 <CACXs9cOGtyhzt9Xda-+4iRv-Qu-h7_ZNUjGoDDUzrUDgV9qWww@mail.gmail.com>
 <01010172285ffeeb-a748f3fb-a4da-481c-8bf2-245eee165df7-000000@us-west-2.amazonses.com>
 <CAFh9Y_NhXfEOKa2U2jvUdrqvHeVRG9qKxah5zRySH70W=4pbmQ@mail.gmail.com>
 <85d6d85e2ae94d1fb838ad371918e40f@kau.se>
 <e0be5635f8ed447f9623d643b116da20@kau.se>
 <CAFh9Y_M8oxdqtdwqQ3+h5JYRRRLeM3r9RkPsB5UFqFDrQmjXWQ@mail.gmail.com>
 <8bd86c73ebde4bbaa090d97a3f68ea5f@kau.se>
 <30858c5f86ec41fb979b92e94849f10e@kau.se>
Message-ID: <CAOyFVR2rDJyFgjU2C4dZ+CPrbs2SBxHrDD=V9AKWhzgLKs1kVQ@mail.gmail.com>

Hi Deval,

*insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko:
Invalid module format*

You can find more details by using "*dmesg*" command. Usually, Linux shows
this message because the version of your host is different.

*/usr/bin/stratum_bf: error while loading shared libraries: libonlp.so.1:
cannot open shared object file: No such file or directory*

Please check if *libonlp.so.1* is mounted to the container.


Yi

On Mon, May 25, 2020 at 3:24 AM Deval Bhamare <Deval.Bhamare at kau.se> wrote:

> Hello Team,
>
>
> Thank you for your support so far. Stratum works with docker image 8.9.2
> on my ONL.
>
>
> However, it still gives the same error below when I try with 8.9.2-3.16.56-OpenNetworkLinux
> image.
>
> Any idea about this?
>
>
> loading bf_kdrv_mod...
> insmod: ERROR: could not insert module /usr/lib/modules/bf_kdrv.ko:
> Invalid module format
> /usr/bin/stratum_bf: error while loading shared libraries: *libonlp.so.1:
> cannot open shared object file: No such file or directory*
>
>
> Also, does it affect the switch performance if docker image with and
> without ONL support is used? Any insights on that part please?
>
>
> thanks,
>
>
> deval.
> ------------------------------
> *From:* Deval Bhamare
> *Sent:* Wednesday, May 20, 2020 11:00:45 AM
> *To:* Maximilian Pudelko; Yi Tseng
> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
> older version for stratum
>
>
> Ok, thanks.
>
>
> @YI, I tried hitting enter , and as mentioned below, I an getting the
> bf_sde prompt.
>
>
> Thanks,
>
> Deval.
> ------------------------------
> *From:* Maximilian Pudelko <max at opennetworking.org>
> *Sent:* Tuesday, May 19, 2020 12:15:38 AM
> *To:* Deval Bhamare
> *Cc:* Daniel Velasco; Yi Tseng
> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
> older version for stratum
>
> That's normal on the first startup. Now you have to push your compiled P4
> program to the switch via P4Runtime, e.g. with the p4runtime-shell
> <https://github.com/p4lang/p4runtime-shell>
> There are also some scripts in the source tree that might help:
> https://github.com/stratum/stratum/blob/9f5bd2b285badbef11e81eca6c31d4a3c4342843/stratum/hal/bin/barefoot/update_config.py
>
> Max
>
> On Mon, May 18, 2020 at 1:28 PM Deval Bhamare <Deval.Bhamare at kau.se>
> wrote:
>
>>
>> Hi,
>>
>> Sorry for the incomplete message. I downloaded chasis_config afresh and
>> that error is gone, however, I still get below error:
>>
>> E0518 20:04:16.774682     8 utils.cc:65] Return Error:
>> ReadFileToString(filename, &text) failed with
>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
>> not found.
>>
>> E0518 20:04:16.776194     8 hal.cc:233] Error when checking in with
>> procmon: Failed to check in with procmon: failed to connect to all
>> addresses.
>>
>>
>>
>> Where can I find *pipeline_config.pb.txt*?
>>
>> However, now I get the bf_sde> prompt.
>>
>> thanks,
>>
>>
>> Deval.
>> ------------------------------
>> *From:* Deval Bhamare
>> *Sent:* Monday, May 18, 2020 11:26:00 PM
>> *To:* Maximilian Pudelko
>> *Cc:* Daniel Velasco; Yi Tseng
>> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
>> older version for stratum
>>
>>
>> Hi,
>>
>>
>> I downloaded chasis_config afresh and that error is gone, however, I
>> still get below error:
>>
>>
>> ------------------------------
>> *From:* Maximilian Pudelko <max at opennetworking.org>
>> *Sent:* Monday, May 18, 2020 9:07:35 PM
>> *To:* Deval Bhamare
>> *Cc:* Daniel Velasco; stratum-dev at lists.stratumproject.org
>> *Subject:* Re: [stratum-dev] Docker image 8.9.2-3.16.56-OpenNetworkLinux
>> older version for stratum
>>
>> Hi all,
>>
>> I'll try to answer some of the questions:
>>
>> > StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon:
>> failed to connect to all addresses
>> You can ignore this, that error is a leftover from the Google codebase.
>>
>> > ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.
>> This means there was no ChassisConfig (Stratum's settings storage) found
>> under the path you gave with `-chassis_config_file=<path>`.
>> When you download a default one, like Yi described above, you'll likely
>> have to adjust the path so it's correct. Or just use the gnmi cli to push
>> it:
>> https://github.com/stratum/stratum/blob/9f5bd2b285badbef11e81eca6c31d4a3c4342843/tools/gnmi/README.md#L50
>>
>> Max
>>
>>
>> On Mon, May 18, 2020 at 8:21 AM Deval Bhamare via stratum-dev <
>> stratum-dev at lists.stratumproject.org> wrote:
>>
>>> Hi Dani,
>>>
>>>
>>> I guess you can ignore procmon error.
>>>
>>>
>>> The message below says stratum is up.
>>>
>>>
>>> E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services
>>> are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
>>>
>>>
>>> The only thing I need to figure out is getting command line from
>>> bf_switchd.
>>>
>>>
>>> If you hit enter in the end, do you get any bf_sw command prompt? At
>>> least I am not getting any.
>>>
>>>
>>> *Dev team*: Is it because of the following error:
>>>
>>>
>>> *ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt not found.*
>>> E0518 15:17:17.704537     8 utils.cc:65] Return Error:
>>> ReadFileToString(filename, &text) failed with
>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
>>> not found.
>>>
>>>
>>>
>>> Ideally  stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinu should
>>> work on ONL, but I am getting the same error as you got (libonlp.so.1:
>>> cannot open shared object file: No such file or directory)
>>> and hopefully we will get some response soon.
>>>
>>>
>>> /Deval.
>>>
>>>
>>> ------------------------------
>>> *From:* Daniel Velasco <dvelben at gmail.com>
>>> *Sent:* Monday, May 18, 2020 6:09:32 PM
>>> *To:* Deval Bhamare
>>> *Subject:* Re: [stratum-dev] Docker image
>>> 8.9.2-3.16.56-OpenNetworkLinux older version for stratum
>>>
>>> Hi Deval,
>>>
>>> if I use that command (with DOCKER_IMAGE_TAG), it uses the
>>> container stratumproject/stratum-bf:9.1.0, instead of
>>> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux, that was the one
>>> I thought it should be.
>>>
>>> In any case, if I do as you ask, I get the following error:
>>>
>>>
>>> root at localhost:~/stratum-configs# PLATFORM=x86-64-stordis-bf2556x-1t-r0
>>> DOCKER_IMAGE_TAG=9.1.0 CONFIG_DIR=$PWD LOG_DIR=$PWD
>>> ./start-stratum-container.sh
>>> + PLATFORM_ARGS=
>>> + '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
>>> + PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
>>> + CONFIG_DIR=/root/stratum-configs
>>> + LOG_DIR=/root/stratum-configs
>>> + SDE_VERSION=9.0.0
>>> ++ uname -r
>>> + KERNEL_VERSION=4.14.49-OpenNetworkLinux
>>> + DOCKER_IMAGE=stratumproject/stratum-bf
>>> + DOCKER_IMAGE_TAG=9.1.0
>>> ++ uname -r
>>> ++ uname -r
>>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>>> /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux
>>> --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v
>>> /root/stratum-configs:/etc/stratum -v
>>> /root/stratum-configs:/var/log/stratum stratumproject/stratum-bf:9.1.0
>>> Cannot find /usr/lib/modules/bf_kdrv.ko, skip installing the Kernel
>>> module.
>>> bf_sysfs_fname /sys/class/bf/bf0/device/dev_add
>>> Install dir: /usr (0x55a9d74ea020)
>>> error copying zlog config file "cp /usr/share/bfsys/zlog-cfg
>>> zlog-cfg-cur"
>>> bf_switchd: system services initialized
>>> bf_switchd: loading conf_file
>>> /usr/share/stratum/tofino_skip_p4_no_bsp.conf...
>>> bf_switchd: processing device configuration...
>>>
>>> ...
>>>
>>>
>>> bf_switchd: dev_id 0 initialized
>>>
>>> bf_switchd: initialized 1 devices
>>> bf_switchd: Credo python server thread initialized..Skip p4 lib init
>>> Skip mav diag lib init
>>> bf_switchd: spawning cli server thread
>>> credo_python_intf: listen socket created
>>> credo_python_intf: bind done on port 9001, listening...
>>> credo_python_intf: listening for incoming connections...
>>> bf_switchd: spawning driver shell
>>> bf_switchd: server started - listening on port 9999
>>> Cannot read termcap database;
>>> using dumb terminal settings.
>>> bf-sde>
>>> bf-sde>
>>> bf-sde>
>>> bf-sde>
>>> bf-sde> E0518 23:08:32.875291     6 phal.cc:91] No phal_config_file
>>> specified and no switch configurator found! This is probably not what you
>>> want. Did you forget to specify any '--define phal_with_*=true' Bazel flags?
>>> E0518 23:08:32.876373699       6 server_chttp2.cc:40]
>>>  {"created":"@1589843312.876328305","description":"Only 1 addresses added
>>> out of total 2
>>> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843312.876323313","description":"Address
>>> family not supported by
>>> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
>>> family not supported by
>>> protocol","syscall":"socket","target_address":"[::1]:28003"}]}
>>> E0518 23:08:33.497541     6 utils.cc:109]
>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
>>> not found.
>>> E0518 23:08:33.497881     6 utils.cc:65] Return Error:
>>> ReadFileToString(filename, &text) failed with
>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
>>> not found.
>>> E0518 23:08:33.498277684       6 server_chttp2.cc:40]
>>>  {"created":"@1589843313.498234870","description":"Only 1 addresses added
>>> out of total 2
>>> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589843313.498230982","description":"Address
>>> family not supported by
>>> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
>>> family not supported by
>>> protocol","syscall":"socket","target_address":"[::1]:28000"}]}
>>> E0518 23:08:33.498530     6 hal.cc:223] Stratum external facing services
>>> are listening to 0.0.0.0:28000, 0.0.0.0:9339, localhost:28000...
>>> E0518 23:08:33.499231     6 hal.cc:365] StratumErrorSpace::ERR_INTERNAL:
>>> Failed to check in with procmon: failed to connect to all addresses
>>> E0518 23:08:33.499338     6 hal.cc:233] Error when checking in with
>>> procmon: Failed to check in with procmon: failed to connect to all
>>> addresses.
>>>
>>>
>>>
>>>
>>>
>>> El lun., 18 may. 2020 a las 16:52, Deval Bhamare (<Deval.Bhamare at kau.se>)
>>> escribió:
>>>
>>>> Hi Dani,
>>>>
>>>>
>>>> I am just a stratum user and not from the dev community, but just a
>>>> suggestion.
>>>>
>>>>
>>>> Can you try update your start-stratum script with below command and
>>>> then try with the command given after that.
>>>>
>>>>
>>>> *Update start script: *
>>>>
>>>>
>>>> *curl -o start-stratum-container.sh *
>>>> *https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh*
>>>> <https://raw.githubusercontent.com/stratum/stratum/master/stratum/hal/bin/barefoot/docker/start-stratum-container.sh>
>>>> *chmod +x start-stratum-container.sh*
>>>>
>>>>
>>>>
>>>> *Use command: *
>>>>
>>>>
>>>>
>>>> PLATFORM=x86-64-stordis-bf2556x-1t-r0 DOCKER_IMAGE_TAG=9.1.0
>>>> CONFIG_DIR=$PWD LOG_DIR=$PWD ./start-stratum-container.sh
>>>>
>>>>
>>>> (Here, should be *DOCKER_IMAGE_TAG* and not *SDE_VERSION*)
>>>>
>>>>
>>>> It will try with Image stratumproject/stratum-bf:9.1.0, rather than
>>>> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux.
>>>>
>>>>
>>>> Can you let me know the output?
>>>>
>>>>
>>>> Thanks,
>>>>
>>>>
>>>> Deval.
>>>> ------------------------------
>>>> *From:* stratum-dev <stratum-dev-bounces at lists.stratumproject.org> on
>>>> behalf of Daniel Velasco via stratum-dev <
>>>> stratum-dev at lists.stratumproject.org>
>>>> *Sent:* Monday, May 18, 2020 5:18:46 PM
>>>> *To:* stratum-dev at lists.stratumproject.org
>>>> *Subject:* Re: [stratum-dev] Docker image
>>>> 8.9.2-3.16.56-OpenNetworkLinux older version for stratum
>>>>
>>>> Hi,
>>>>
>>>> we are doing out first tests with stratum and we are getting same
>>>> failure with 9.1.0, are we missing something?
>>>>
>>>> root at localhost:~/stratum-configs#
>>>> PLATFORM=x86-64-stordis-bf2556x-1t-r0 SDE_VERSION=9.1.0 CONFIG_DIR=$PWD
>>>> LOG_DIR=$PWD ./start-stratum-container.sh
>>>> + PLATFORM_ARGS=
>>>> + '[' -n x86-64-stordis-bf2556x-1t-r0 ']'
>>>> + PLATFORM_ARGS='--env PLATFORM=x86-64-stordis-bf2556x-1t-r0'
>>>> + CONFIG_DIR=/root/stratum-configs
>>>> + LOG_DIR=/root/stratum-configs
>>>> + SDE_VERSION=9.1.0
>>>> ++ uname -r
>>>> + KERNEL_VERSION=4.14.49-OpenNetworkLinux
>>>> + DOCKER_IMAGE=stratumproject/stratum-bf
>>>> + DOCKER_IMAGE_TAG=9.1.0-4.14.49-OpenNetworkLinux
>>>> ++ uname -r
>>>> ++ uname -r
>>>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>>>> /lib/modules/4.14.49-OpenNetworkLinux:/lib/modules/4.14.49-OpenNetworkLinux
>>>> --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p 28000:28000 -p 9339:9339 -v
>>>> /root/stratum-configs:/etc/stratum -v
>>>> /root/stratum-configs:/var/log/stratum
>>>> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
>>>> Unable to find image
>>>> 'stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux' locally
>>>> 9.1.0-4.14.49-OpenNetworkLinux: Pulling from stratumproject/stratum-bf
>>>> 3401a574d84f: Pull complete
>>>> 26b758f54741: Pull complete
>>>> 97d203f02ea3: Pull complete
>>>> Digest:
>>>> sha256:6c372f84b3ba56cd877afd2f049a80d7b97425b45c21358a6edf2396c5d11e19
>>>> Status: Downloaded newer image for
>>>> stratumproject/stratum-bf:9.1.0-4.14.49-OpenNetworkLinux
>>>> bf_kdrv_mod found! Unloading first...
>>>> loading bf_kdrv_mod...
>>>> /usr/bin/stratum_bf: error while loading shared libraries:
>>>> libonlp.so.1: cannot open shared object file: No such file or directory
>>>> root at localhost:~/stratum-configs#
>>>>
>>>> Thanks a lot!
>>>>
>>>> BR / Dani
>>>>
>>>> El dom., 17 may. 2020 a las 20:42, Deval Bhamare via stratum-dev (<
>>>> stratum-dev at lists.stratumproject.org>) escribió:
>>>>
>>>>> Hello Yi,
>>>>>
>>>>>
>>>>> I downloaded the image again and this time it looks like working.
>>>>> Below are the logs.
>>>>>
>>>>>
>>>>> However, as you suggested, I modified *stratum.flags  to r*emove
>>>>> "-bf_switchd_background=true" from stratum.flags file to use the command
>>>>> line from bf_switchd.
>>>>>
>>>>>
>>>>> But *command prompt doesn't appear*. Any suggestions?
>>>>>
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Deval.
>>>>>
>>>>>
>>>>> *Logs*:
>>>>>
>>>>>
>>>>> bf_switchd: dev_id 0 initialized
>>>>>
>>>>> bf_switchd: initialized 1 devices
>>>>> Skip p4 lib init
>>>>> Skip mav diag lib init
>>>>> bf_switchd: spawning cli server thread
>>>>> bf_switchd: running in background; driver shell is disabled
>>>>> bf_switchd: server started - listening on port 9999
>>>>> E0517 18:08:29.853154     8 utils.cc:109]
>>>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
>>>>> not found.
>>>>> E0517 18:08:29.853606     8 utils.cc:65] Return Error:
>>>>> ReadFileToString(filename, &text) failed with
>>>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/chassis_config.pb.txt
>>>>> not found.
>>>>> E0517 18:08:29.853675     8 utils.cc:109]
>>>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
>>>>> not found.
>>>>> E0517 18:08:29.853701     8 utils.cc:65] Return Error:
>>>>> ReadFileToString(filename, &text) failed with
>>>>> StratumErrorSpace::ERR_FILE_NOT_FOUND: /etc/stratum/pipeline_config.pb.txt
>>>>> not found.
>>>>> E0517 18:08:29.854777685       8 server_chttp2.cc:40]
>>>>> {"created":"@1589738909.854734733","description":"Only 1 addresses added
>>>>> out of total 2
>>>>> resolved","file":"external/com_github_grpc_grpc/src/core/ext/transport/chttp2/server/chttp2_server.cc","file_line":406,"referenced_errors":[{"created":"@1589738909.854731483","description":"Address
>>>>> family not supported by
>>>>> protocol","errno":97,"file":"external/com_github_grpc_grpc/src/core/lib/iomgr/socket_utils_common_posix.cc","file_line":420,"os_error":"Address
>>>>> family not supported by
>>>>> protocol","syscall":"socket","target_address":"[::1]:28000"}]}
>>>>> E0517 18:08:29.854998     8 hal.cc:223] Stratum external facing
>>>>> services are listening to 0.0.0.0:28000, 0.0.0.0:9339,
>>>>> localhost:28000...
>>>>> E0517 18:08:29.855722     8 hal.cc:365]
>>>>> StratumErrorSpace::ERR_INTERNAL: Failed to check in with procmon: failed to
>>>>> connect to all addresses
>>>>> E0517 18:08:29.855825     8 hal.cc:233] Error when checking in with
>>>>> procmon: Failed to check in with procmon: failed to connect to all
>>>>> addresses.
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ------------------------------
>>>>> *From:* Yi Tseng <yi at opennetworking.org>
>>>>> *Sent:* Sunday, May 17, 2020 1:48:54 PM
>>>>> *To:* Deval Bhamare
>>>>> *Cc:* stratum-dev at lists.stratumproject.org
>>>>> *Subject:* Re: [stratum-dev] Docker image
>>>>> 8.9.2-3.16.56-OpenNetworkLinux older version for stratum
>>>>>
>>>>> Hi Deval,
>>>>>
>>>>> Based on the email you send:
>>>>>
>>>>>> Hello Yi,
>>>>>>>
>>>>>>> Thank you for the reply. So I tried the steps below on *ONL *
>>>>>>> *3.16.64-OpenNetworkLinux*. I still get below error:
>>>>>>>
>>>>>>>
>>>>>>> + docker run -it --privileged -v /dev:/dev -v /sys:/sys -v
>>>>>>> /lib/modules/3.16.64-OpenNetworkLinux:/lib/modules/3.16.64-OpenNetworkLinux
>>>>>>> --env WITH_ONLP=false --env PLATFORM=x86-64-stordis-bf2556x-1t-r0 -p
>>>>>>> 28000:28000 -v /root:/stratum_configs -v /var/log:/stratum_logs
>>>>>>> stratumproject/stratum-bf:8.9.2-3.16.56-OpenNetworkLinux
>>>>>>>
>>>>>>
>>>>> We are no longer using "WITH_ONLP" variable and we expose additional
>>>>> TCP port 9339
>>>>>
>>>>> For SDE 8.9.0, we tested it several months ago and moved to version
>>>>> 8.9.2 since Barefoot upgraded the version.
>>>>>
>>>>> Are you still getting the ONLP library issue when you are using the
>>>>> container image "stratumproject/stratum-bf:8.9.2" ?
>>>>> Can you try delete your local container image cache and pull it again?
>>>>>
>>>>> Yi
>>>>>
>>>>> _______________________________________________
>>>>> stratum-dev mailing list
>>>>> stratum-dev at lists.stratumproject.org
>>>>> https://lists.stratumproject.org/listinfo/stratum-dev
>>>>
>>>> _______________________________________________
>>> stratum-dev mailing list
>>> stratum-dev at lists.stratumproject.org
>>> https://lists.stratumproject.org/listinfo/stratum-dev
>>
>>

-- 
Yi Tseng
Member of Technical Staff
Open Networking Foundation
https://www.opennetworking.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.stratumproject.org/archives/stratum-dev/attachments/20200528/4990baa0/attachment-0001.html>

